<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é²è¿…çš„äººæƒ…ç½—ç½‘ - ç¤¾äº¤å…³ç³»ç½‘ç»œå›¾</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Microsoft YaHei', 'å¾®è½¯é›…é»‘', 'SimSun', 'å®‹ä½“', 'Arial Unicode MS', 'DejaVu Sans', sans-serif;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            text-rendering: optimizeLegibility;
            background: linear-gradient(135deg, #FFFCF8 0%, #F5F1E8 50%, #F9F5ED 100%);
            overflow: hidden;
            position: relative;
            /* èƒŒæ™¯çº¹ç†ï¼Œä¸ä¸»å›¾ä¿æŒä¸€è‡´ */
            background-image: 
                /* ç»†è…»å™ªç‚¹çº¹ç† */
                radial-gradient(circle at 20px 30px, rgba(0,0,0,0.03) 1px, transparent 2px),
                radial-gradient(circle at 80px 90px, rgba(139,125,107,0.02) 1px, transparent 2px);
            background-repeat: repeat, repeat;
            background-position: 0 0, 0 0;
            background-size: 140px 140px, 140px 140px;
            background-attachment: scroll, scroll;
            background-blend-mode: normal, normal;
            background-color: #F5F1E8;
        }

        /* å®£çº¸çº¹ç†èƒŒæ™¯ï¼ˆç®€åŒ–ï¼Œä¸ä¸»å›¾ä¸€è‡´ï¼‰ */
        .paper-texture {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 1;
        }

        /* ä¸»å®¹å™¨ */
        .main-container {
            position: relative;
            width: 100vw;
            height: 100vh;
            display: flex;
            flex-direction: column;
        }

        /* é¡¶éƒ¨æ ‡é¢˜åŒº - ä¸ä¸»å›¾é£æ ¼ä¸€è‡´ */
        .header {
            position: absolute;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 10;
            text-align: center;
            background: rgba(245, 241, 232, 0.92);
            padding: 15px 30px;
            border-radius: 8px;
            border: 2px solid #C9A961;
            box-shadow: 5px 5px 10px rgba(0,0,0,0.15);
        }

        .main-title {
            font-family: 'SimSun', 'å®‹ä½“', serif;
            font-size: 28px;
            font-weight: 700;
            color: #5D4E37;
            letter-spacing: 2px;
            margin: 0;
        }

        .subtitle {
            font-family: 'Kaiti', 'æ¥·ä½“', serif;
            font-size: 13px;
            color: #8B7D6B;
            margin-top: 5px;
        }
        
        .back-btn {
            position: absolute;
            top: 15px;
            right: 15px;
            background: #C9A961;
            color: #FFFCF8;
            border: none;
            padding: 8px 12px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
            font-family: 'SimSun', 'å®‹ä½“', serif;
            transition: all 0.3s ease;
            text-decoration: none;
        }
        
        .back-btn:hover {
            background: #B8945A;
            transform: translateY(-1px);
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }

        /* å·¦ä¾§ç­›é€‰å™¨ - ä¸ä¸»å›¾é£æ ¼ä¸€è‡´ */
        .filter-panel {
            position: absolute;
            left: 20px;
            top: 100px;
            width: 280px;
            background: rgba(245, 241, 232, 0.96);
            border-radius: 8px;
            padding: 20px;
            box-shadow: 5px 5px 10px rgba(0,0,0,0.15);
            z-index: 10;
            border: 2px solid #C9A961;
            max-height: 80vh;
            overflow-y: auto;
        }

        .filter-title {
            font-family: 'SimSun', 'å®‹ä½“', serif;
            font-size: 15px;
            font-weight: 600;
            color: #5D4E37;
            margin-bottom: 15px;
            padding: 8px 10px;
            background: transparent;
            border-bottom: 1px dashed #C9A961;
            border-radius: 0;
        }

        .filter-btn {
            display: block;
            width: 100%;
            padding: 10px 15px;
            margin: 8px 0;
            background: #F5F1E8;
            border: 1px solid #C9A961;
            border-radius: 4px;
            cursor: pointer;
            font-size: 13px;
            color: #5D4E37;
            transition: all 0.3s ease;
            text-align: center;
            font-family: 'SimSun', 'å®‹ä½“', serif;
        }

        .filter-btn:hover {
            background: rgba(201, 169, 97, 0.08);
            border-color: #C9A961;
            color: #C9A961;
            transform: translateY(-1px);
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .filter-btn.active {
            background: #C9A961;
            color: #FFFCF8;
            font-weight: bold;
        }

        /* æœç´¢æ¡† - ä¸ä¸»å›¾é£æ ¼ä¸€è‡´ */
        .search-box {
            margin-top: 20px;
            position: relative;
        }

        .search-input {
            width: 100%;
            padding: 12px;
            border: 2px solid #ecf0f1;
            border-radius: 8px;
            font-size: 14px;
            background: rgba(255,255,255,0.9);
            color: #5D4E37;
            font-family: 'SimSun', 'å®‹ä½“', serif;
            transition: border-color 0.3s ease;
        }

        .search-input:focus {
            outline: none;
            border-color: #C9A961;
        }

        .search-btn {
            position: absolute;
            right: 5px;
            top: 50%;
            transform: translateY(-50%);
            background: #C9A961;
            border: none;
            border-radius: 4px;
            width: 30px;
            height: 30px;
            cursor: pointer;
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }

        .search-btn:hover {
            background: #B8945A;
        }

        /* ä¸­å¤®ç”»å¸ƒ */
        .network-canvas {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 5;
        }

        #networkSvg {
            width: 100%;
            height: 100%;
        }

        /* åº•éƒ¨æ—¶é—´è½´ - ä¸ä¸»å›¾é£æ ¼ä¸€è‡´ */
        .timeline-container {
            position: absolute;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%);
            width: 80%;
            max-width: 800px;
            background: rgba(245, 241, 232, 0.96);
            border-radius: 8px;
            padding: 20px 30px;
            box-shadow: 5px 5px 10px rgba(0,0,0,0.15);
            z-index: 10;
            border: 2px solid #C9A961;
        }

        .timeline-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .year-display {
            font-family: 'SimSun', 'å®‹ä½“', serif;
            font-size: 32px;
            color: #C9A961;
            font-weight: 600;
        }

        .play-btn {
            background: #C9A961;
            border: none;
            border-radius: 4px;
            width: 40px;
            height: 40px;
            cursor: pointer;
            color: white;
            font-size: 18px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }

        .play-btn:hover {
            background: #B8945A;
            transform: scale(1.05);
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }

        .timeline-slider {
            position: relative;
            height: 60px;
            background: linear-gradient(90deg, #f8c471, #f9e79f, #ff6b35);
            border-radius: 30px;
            padding: 10px 20px;
        }

        .slider-track {
            position: relative;
            height: 8px;
            background: rgba(255,255,255,0.6);
            border-radius: 4px;
            margin: 20px 0;
        }

        .slider-progress {
            position: absolute;
            left: 0;
            top: 0;
            height: 100%;
            background: #ff6b35;
            border-radius: 4px;
            transition: width 0.3s ease;
        }

        .slider-handle {
            position: absolute;
            top: 50%;
            transform: translate(-50%, -50%);
            width: 24px;
            height: 24px;
            background: #ff6b35;
            border: 3px solid white;
            border-radius: 50%;
            cursor: grab;
            box-shadow: 0 2px 10px rgba(0,0,0,0.2);
            transition: all 0.2s ease;
        }

        .slider-handle:active {
            cursor: grabbing;
            transform: translate(-50%, -50%) scale(1.2);
        }

        .year-markers {
            display: flex;
            justify-content: space-between;
            margin-top: 10px;
            font-size: 12px;
            color: #666;
        }

        /* å³ä¾§äººç‰©å¡ç‰‡ - ä¸ä¸»å›¾é£æ ¼ä¸€è‡´ */
        .bio-sidebar {
            position: absolute;
            right: -400px;
            top: 80px;
            width: 350px;
            background: rgba(245, 241, 232, 0.96);
            border-radius: 8px;
            padding: 20px;
            box-shadow: 5px 5px 10px rgba(0,0,0,0.15);
            z-index: 15;
            transition: right 0.4s cubic-bezier(0.68, -0.55, 0.265, 1.55);
            border: 2px solid #C9A961;
            max-height: 70vh;
            overflow-y: auto;
        }

        .bio-sidebar.active {
            right: 20px;
        }

        .bio-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px dashed #C9A961;
        }

        .bio-name {
            font-family: 'SimSun', 'å®‹ä½“', serif;
            font-size: 26px;
            color: #5D4E37;
            font-weight: 600;
        }

        .bio-close {
            background: none;
            border: none;
            font-size: 28px;
            cursor: pointer;
            color: #8B7D6B;
            transition: all 0.3s ease;
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
        }

        .bio-close:hover {
            color: #C9A961;
            background: rgba(201, 169, 97, 0.1);
            transform: scale(1.1);
        }

        .bio-info {
            margin-bottom: 20px;
        }

        .bio-label {
            font-size: 14px;
            color: #8B7D6B;
            margin-bottom: 5px;
            font-family: 'SimSun', 'å®‹ä½“', serif;
        }

        .bio-value {
            font-size: 16px;
            color: #5D4E37;
            font-weight: bold;
            margin-bottom: 15px;
            font-family: 'SimSun', 'å®‹ä½“', serif;
        }

        .bio-events {
            margin-top: 20px;
        }

        .bio-events-title {
            font-family: 'SimSun', 'å®‹ä½“', serif;
            font-size: 15px;
            font-weight: bold;
            color: #5D4E37;
            margin-bottom: 15px;
            padding-bottom: 8px;
            border-bottom: 1px dashed #C9A961;
        }
        
        .bio-actions {
            margin-top: 15px;
            padding-top: 10px;
            border-top: 1px dashed #C9A961;
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }
        
        .bio-action-btn {
            background: #C9A961;
            color: #FFFCF8;
            border: none;
            padding: 8px 12px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
            font-family: 'SimSun', 'å®‹ä½“', serif;
            transition: all 0.3s ease;
            flex: 1;
            min-width: 100px;
        }
        
        .bio-action-btn:hover {
            background: #B8945A;
            transform: translateY(-1px);
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }

        .event-item {
            background: rgba(255, 248, 240, 0.8);
            border-radius: 4px;
            padding: 8px 12px;
            margin-bottom: 8px;
            border-left: 3px solid #C9A961;
        }

        .event-year {
            font-weight: bold;
            color: #C9A961;
            margin-bottom: 4px;
            font-size: 12px;
        }

        .event-desc {
            color: #5D4E37;
            font-size: 12px;
            line-height: 1.4;
            font-family: 'SimSun', 'å®‹ä½“', serif;
        }

        /* å›¾ä¾‹ - ä¸ä¸»å›¾é£æ ¼ä¸€è‡´ */
        .legend {
            position: absolute;
            left: 20px;
            bottom: 150px;
            background: rgba(245, 241, 232, 0.96);
            border-radius: 8px;
            padding: 15px;
            box-shadow: 5px 5px 10px rgba(0,0,0,0.15);
            z-index: 10;
            border: 2px solid #C9A961;
            max-width: 220px;
        }

        .legend-title {
            font-family: 'SimSun', 'å®‹ä½“', serif;
            font-size: 12px;
            font-weight: bold;
            color: #5D4E37;
            margin-bottom: 8px;
            border-bottom: 1px solid #C9A961;
            padding-bottom: 6px;
        }

        .legend-item {
            display: flex;
            align-items: center;
            margin: 8px 0;
            padding: 4px 6px;
            border-radius: 2px;
            cursor: pointer;
            transition: all 0.2s ease;
            user-select: none;
        }

        .legend-item:hover {
            background: rgba(201, 169, 97, 0.1);
        }

        .legend-color {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 8px;
            border: 1px solid #fff;
            box-shadow: 0 1px 2px rgba(0,0,0,0.1);
            flex-shrink: 0;
        }

        .legend-text {
            font-size: 12px;
            color: #5D4E37;
            font-family: 'SimSun', 'å®‹ä½“', serif;
        }

        /* èŠ‚ç‚¹æ ·å¼ - ä¸ä¸»å›¾é£æ ¼ä¸€è‡´ */
        .node {
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .node:hover {
            filter: brightness(1.1);
        }

        .node-label {
            font-family: 'SimSun', 'å®‹ä½“', serif;
            font-size: 12px;
            fill: #5D4E37;
            pointer-events: none;
            text-anchor: middle;
        }

        .link {
            fill: none;
            stroke: #999;
            stroke-opacity: 0.6;
            transition: all 0.3s ease;
        }

        .link:hover {
            stroke-opacity: 1;
            stroke-width: 3px;
        }

        .link.broken {
            stroke-dasharray: 5,5;
            stroke-opacity: 0.3;
        }

        /* å“åº”å¼ */
        @media (max-width: 768px) {
            .main-title {
                font-size: 28px;
            }
            
            .filter-panel {
                width: 160px;
                left: 10px;
                top: 80px;
            }
            
            .bio-sidebar {
                width: 280px;
                right: -300px;
            }
            
            .timeline-container {
                width: 90%;
                bottom: 20px;
            }
        }
    </style>
</head>
<body>
    <div class="paper-texture"></div>
    
    <div class="main-container">
        <!-- é¡¶éƒ¨æ ‡é¢˜ -->
        <div class="header">
            <h1 class="main-title">é²è¿…çš„äººæƒ…ç½—ç½‘</h1>
            <p class="subtitle">ç¤¾äº¤å…³ç³»ç½‘ç»œå›¾ Â· æ—¶ç©ºæ¼”å˜</p>
            <button class="back-btn" onclick="window.location.href='ä¸»å›¾.html'" title="è¿”å›ä¸»å›¾">
                â† è¿”å›ä¸»å›¾
            </button>
        </div>

        <!-- å·¦ä¾§ç­›é€‰å™¨ -->
        <div class="filter-panel">
            <h3 class="filter-title">å…³ç³»ç­›é€‰</h3>
            <button class="filter-btn active" data-filter="all">å…¨éƒ¨å…³ç³»</button>
            <button class="filter-btn" data-filter="äº²å±">äº²å±</button>
            <button class="filter-btn" data-filter="å­¦ç”Ÿ">å­¦ç”Ÿ</button>
            <button class="filter-btn" data-filter="åŒäº‹">åŒäº‹</button>
            <button class="filter-btn" data-filter="åŒä¹¡">åŒä¹¡</button>
            <button class="filter-btn" data-filter="å‹äºº">å‹äºº</button>
            <button class="filter-btn" data-filter="å…¶ä»–">å…¶ä»–</button>
            
            <div class="search-box">
                <input type="text" class="search-input" placeholder="æœç´¢äººç‰©..." id="searchInput">
                <button class="search-btn">ğŸ”</button>
            </div>
        </div>

        <!-- ä¸­å¤®ç”»å¸ƒ -->
        <div class="network-canvas">
            <svg id="networkSvg"></svg>
        </div>

        <!-- å›¾ä¾‹ -->
        <div class="legend">
            <h4 class="legend-title">å…³ç³»å›¾ä¾‹</h4>
            <div class="legend-item" data-filter="all" onclick="filterByCategory('all')">
                <div class="legend-color" style="background: linear-gradient(45deg, #e74c3c, #3498db, #f39c12, #2ecc71, #9b59b6, #34495e);"></div>
                <span class="legend-text">å…¨éƒ¨å…³ç³»</span>
            </div>
            <div class="legend-item" data-filter="äº²å±" onclick="filterByCategory('äº²å±')">
                <div class="legend-color" style="background: #e74c3c;"></div>
                <span class="legend-text">äº²å±</span>
            </div>
            <div class="legend-item" data-filter="å­¦ç”Ÿ" onclick="filterByCategory('å­¦ç”Ÿ')">
                <div class="legend-color" style="background: #3498db;"></div>
                <span class="legend-text">å­¦ç”Ÿ</span>
            </div>
            <div class="legend-item" data-filter="åŒäº‹" onclick="filterByCategory('åŒäº‹')">
                <div class="legend-color" style="background: #f39c12;"></div>
                <span class="legend-text">åŒäº‹</span>
            </div>
            <div class="legend-item" data-filter="åŒä¹¡" onclick="filterByCategory('åŒä¹¡')">
                <div class="legend-color" style="background: #2ecc71;"></div>
                <span class="legend-text">åŒä¹¡</span>
            </div>
            <div class="legend-item" data-filter="å‹äºº" onclick="filterByCategory('å‹äºº')">
                <div class="legend-color" style="background: #9b59b6;"></div>
                <span class="legend-text">å‹äºº</span>
            </div>
            <div class="legend-item" data-filter="å…¶ä»–" onclick="filterByCategory('å…¶ä»–')">
                <div class="legend-color" style="background: #34495e;"></div>
                <span class="legend-text">å…¶ä»–</span>
            </div>
        </div>

        <!-- åº•éƒ¨æ—¶é—´è½´ -->
        <div class="timeline-container">
            <div class="timeline-header">
                <div class="year-display" id="yearDisplay">1912</div>
                <button class="play-btn" id="playBtn">â–¶</button>
            </div>
            <div class="timeline-slider">
                <div class="slider-track">
                    <div class="slider-progress" id="sliderProgress"></div>
                    <div class="slider-handle" id="sliderHandle" style="left: 0%"></div>
                </div>
                <div class="year-markers">
                    <span>1912</span>
                    <span>1916</span>
                    <span>1920</span>
                    <span>1924</span>
                    <span>1926</span>
                </div>
            </div>
        </div>

        <!-- å³ä¾§äººç‰©å¡ç‰‡ -->
        <div class="bio-sidebar" id="bioSidebar">
            <div class="bio-header">
                <h2 class="bio-name" id="bioName">äººç‰©å§“å</h2>
                <button class="bio-close" id="bioClose">âœ•</button>
            </div>
            <div class="bio-info">
                <div class="bio-label">å…³ç³»ç±»å‹</div>
                <div class="bio-value" id="bioRelation">-</div>
                
                <div class="bio-label">ç›¸è¯†æ—¶é—´</div>
                <div class="bio-value" id="bioTime">-</div>
                
                <div class="bio-label">èƒŒæ™¯ä¿¡æ¯</div>
                <div class="bio-value" id="bioBackground">-</div>
            </div>
            <div class="bio-events">
                <h3 class="bio-events-title">é‡è¦äº‹ä»¶</h3>
                <div id="bioEventsList"></div>
            </div>
            <div class="bio-actions" id="bioActions" style="display: none;">
                <button class="bio-action-btn" onclick="goToMainMap()" title="åœ¨ä¸»å›¾ä¸­æŸ¥çœ‹æ­¤äººç›¸å…³åœ°ç‚¹">
                    ğŸ“ æŸ¥çœ‹ç›¸å…³åœ°ç‚¹
                </button>
                <button class="bio-action-btn" onclick="sharePerson()" title="åˆ†äº«æ­¤äººç‰©ä¿¡æ¯">
                    ğŸ“¤ åˆ†äº«äººç‰©
                </button>
            </div>
        </div>
    </div>

    <script src="https://d3js.org/d3.v7.min.js"></script>
    <script>
        // çœŸå®æ•°æ® - åŸºäºCSVæ–‡ä»¶ä¸­çš„é²è¿…ç¤¾äº¤å…³ç³»æ•°æ®
        const networkData = {
            nodes: [
                // ä¸­å¿ƒèŠ‚ç‚¹
                {id: "luxun", name: "é²è¿…", category: "center", radius: 30, color: "#ff6b35", year: 1912},
                
                // äº²å±å…³ç³»
                {id: "zhouzuoren", name: "å‘¨ä½œäºº", category: "äº²å±", radius: 20, color: "#e74c3c", year: 1885, brokenYear: 1923},
                {id: "zhoujianren", name: "å‘¨å»ºäºº", category: "äº²å±", radius: 18, color: "#e74c3c", year: 1888},
                {id: "xuguangping", name: "è®¸å¹¿å¹³", category: "äº²å±", radius: 20, color: "#e74c3c", year: 1925},
                {id: "lurui", name: "é²ç‘", category: "äº²å±", radius: 18, color: "#e74c3c", year: 1881},
                {id: "zhuan", name: "æœ±å®‰", category: "äº²å±", radius: 18, color: "#e74c3c", year: 1906},
                {id: "yuxinzi", name: "ç¾½å¤ªä¿¡å­", category: "äº²å±", radius: 16, color: "#e74c3c", year: 1909},
                {id: "ruhesun", name: "é˜®å’Œå­™", category: "äº²å±", radius: 16, color: "#e74c3c", year: 1885},
                {id: "zhoufengyi", name: "å‘¨ä¸°ä¸€", category: "äº²å±", radius: 15, color: "#e74c3c", year: 1912},
                {id: "zhuoming", name: "æœ±å¯é“­", category: "äº²å±", radius: 15, color: "#e74c3c", year: 1920},
                
                // åŒä¹¡å…³ç³»
                {id: "xushoushang", name: "è®¸å¯¿è£³", category: "åŒä¹¡", radius: 20, color: "#2ecc71", year: 1909},
                {id: "qianxuantong", name: "é’±ç„åŒ", category: "åŒä¹¡", radius: 18, color: "#2ecc71", year: 1917},
                {id: "caiyuanpei", name: "è”¡å…ƒåŸ¹", category: "åŒä¹¡", radius: 18, color: "#2ecc71", year: 1912},
                {id: "shenyinmo", name: "æ²ˆå°¹é»˜", category: "åŒä¹¡", radius: 17, color: "#2ecc71", year: 1913},
                {id: "mayouyu", name: "é©¬å¹¼æ¸”", category: "åŒä¹¡", radius: 17, color: "#2ecc71", year: 1908},
                {id: "shenjianshi", name: "æ²ˆå…¼å£«", category: "åŒä¹¡", radius: 17, color: "#2ecc71", year: 1918},
                {id: "xumianbo", name: "è®¸ç¾¡è‹", category: "åŒä¹¡", radius: 16, color: "#2ecc71", year: 1920},
                {id: "shenyantong", name: "æ²ˆé›å†°", category: "åŒä¹¡", radius: 18, color: "#2ecc71", year: 1921},
                {id: "yudafu", name: "éƒè¾¾å¤«", category: "åŒä¹¡", radius: 17, color: "#2ecc71", year: 1923},
                {id: "jiangyiji", name: "è’‹æŠ‘å®", category: "åŒä¹¡", radius: 16, color: "#2ecc71", year: 1902},
                {id: "songzipai", name: "å®‹ç´«ä½©", category: "åŒä¹¡", radius: 16, color: "#2ecc71", year: 1913},
                {id: "zhuxizu", name: "æœ±å¸Œç¥–", category: "åŒä¹¡", radius: 16, color: "#2ecc71", year: 1908},
                {id: "xumingbo", name: "è®¸é“­ä¼¯", category: "åŒä¹¡", radius: 15, color: "#2ecc71", year: 1912},
                {id: "xushichen", name: "è®¸è¯—èƒ", category: "åŒä¹¡", radius: 15, color: "#2ecc71", year: 1912},
                
                // åŒäº‹å…³ç³»
                {id: "qishoushan", name: "é½å¯¿å±±", category: "åŒäº‹", radius: 17, color: "#f39c12", year: 1912},
                {id: "zhangxiehou", name: "ç« å£«é’Š", category: "åŒäº‹", radius: 16, color: "#f39c12", year: 1924},
                {id: "xujishang", name: "è®¸å­£ä¸Š", category: "åŒäº‹", radius: 16, color: "#f39c12", year: 1912},
                {id: "chenqingyuan", name: "é™ˆå¸ˆæ›¾", category: "åŒäº‹", radius: 16, color: "#f39c12", year: 1913},
                {id: "xujixuan", name: "å¾å‰è½©", category: "åŒäº‹", radius: 15, color: "#f39c12", year: 1912},
                {id: "qiushanyuan", name: "è£˜å–„å…ƒ", category: "åŒäº‹", radius: 15, color: "#f39c12", year: 1912},
                {id: "qiansuna", name: "é’±ç¨»å­™", category: "åŒäº‹", radius: 15, color: "#f39c12", year: 1912},
                {id: "dailie", name: "æˆ´èºèˆ²", category: "åŒäº‹", radius: 15, color: "#f39c12", year: 1912},
                
                // å­¦ç”Ÿå…³ç³»
                {id: "liubannong", name: "åˆ˜åŠå†œ", category: "å­¦ç”Ÿ", radius: 17, color: "#3498db", year: 1918},
                {id: "liuhezhen", name: "åˆ˜å’Œç", category: "å­¦ç”Ÿ", radius: 16, color: "#3498db", year: 1925},
                {id: "sunfuyuan", name: "å­™ä¼å›­", category: "å­¦ç”Ÿ", radius: 17, color: "#3498db", year: 1919},
                {id: "huyuzhi", name: "èƒ¡æ„ˆä¹‹", category: "å­¦ç”Ÿ", radius: 16, color: "#3498db", year: 1921},
                {id: "xuqinwen", name: "è®¸é’¦æ–‡", category: "å­¦ç”Ÿ", radius: 16, color: "#3498db", year: 1920},
                {id: "taijingnong", name: "å°é™å†œ", category: "å­¦ç”Ÿ", radius: 16, color: "#3498db", year: 1925},
                {id: "weisuyuan", name: "éŸ¦ç´ å›­", category: "å­¦ç”Ÿ", radius: 16, color: "#3498db", year: 1925},
                {id: "liyexia", name: "æéœé‡", category: "å­¦ç”Ÿ", radius: 15, color: "#3498db", year: 1925},
                {id: "caojinghua", name: "æ›¹é–å", category: "å­¦ç”Ÿ", radius: 15, color: "#3498db", year: 1922},
                {id: "jingyoulin", name: "è†æœ‰éºŸ", category: "å­¦ç”Ÿ", radius: 15, color: "#3498db", year: 1924},
                {id: "changweijun", name: "å¸¸ç»´é’§", category: "å­¦ç”Ÿ", radius: 15, color: "#3498db", year: 1923},
                {id: "xiangpeliang", name: "å‘åŸ¹è‰¯", category: "å­¦ç”Ÿ", radius: 15, color: "#3498db", year: 1924},
                
                // å‹äººåŠå…¶ä»–
                {id: "hushi", name: "èƒ¡é€‚", category: "å‹äºº", radius: 18, color: "#9b59b6", year: 1918},
                {id: "linda", name: "æå¤§é’Š", category: "å‹äºº", radius: 17, color: "#9b59b6", year: 1918},
                {id: "chenduxiu", name: "é™ˆç‹¬ç§€", category: "å‹äºº", radius: 17, color: "#9b59b6", year: 1920},
                {id: "zhengzhenduo", name: "éƒ‘æŒ¯é“", category: "å‹äºº", radius: 16, color: "#9b59b6", year: 1921},
                {id: "lingyutang", name: "æ—è¯­å ‚", category: "å‹äºº", radius: 16, color: "#9b59b6", year: 1924},
                {id: "lixiaofeng", name: "æå°å³°", category: "å‹äºº", radius: 15, color: "#9b59b6", year: 1923},
                {id: "zhangfengju", name: "å¼ å‡¤ä¸¾", category: "å‹äºº", radius: 15, color: "#9b59b6", year: 1921},
                {id: "gaohanghong", name: "é«˜é•¿è™¹", category: "å‹äºº", radius: 15, color: "#9b59b6", year: 1924}
            ],
            links: [
                // äº²å±å…³ç³»é“¾æ¥
                {source: "luxun", target: "zhouzuoren", strength: 5, events: [
                    {year: 1885, desc: "ç»“è¯†ï¼ˆå…„å¼Ÿï¼‰"},
                    {year: 1917, desc: "éšé²è¿…åˆ°åŒ—äº¬"},
                    {year: 1912, desc: "äº’é€šä¿¡ä»¶900é€š"},
                    {year: 1923, desc: "å…„å¼Ÿå…³ç³»ç ´è£‚ï¼Œé²è¿…æ¬å‡ºå…«é“æ¹¾"}
                ]},
                {source: "luxun", target: "zhoujianren", strength: 3, events: [
                    {year: 1888, desc: "ç»“è¯†ï¼ˆå…„å¼Ÿï¼‰"}
                ]},
                {source: "luxun", target: "xuguangping", strength: 4, events: [
                    {year: 1925, desc: "é¦–æ¬¡å†™ä¿¡ç»™é²è¿…ï¼ˆå­¦ç”Ÿï¼‰"},
                    {year: 1926, desc: "ä¸é²è¿…åŒæ—¶ç¦»äº¬å—ä¸‹"},
                    {year: 1927, desc: "ä¸é²è¿…åŒèµ´ä¸Šæµ·å®šå±…ï¼ˆå¤«äººï¼‰"}
                ]},
                {source: "luxun", target: "lurui", strength: 4, events: [
                    {year: 1881, desc: "ç»“è¯†ï¼ˆæ¯äº²ï¼‰"},
                    {year: 1919, desc: "éšé²è¿…è¿è‡³åŒ—äº¬å…«é“æ¹¾"},
                    {year: 1924, desc: "éšé²è¿…è¿è‡³è¥¿ä¸‰æ¡21å·é™¢"},
                    {year: 1936, desc: "é²è¿…å¸¸ç»™æ¯äº²å†™ä¿¡"}
                ]},
                {source: "luxun", target: "zhuan", strength: 3, events: [
                    {year: 1906, desc: "ç»“å©š"},
                    {year: 1919, desc: "éšé²è¿…å…¨å®¶è¿åˆ°å…«é“æ¹¾"},
                    {year: 1924, desc: "éšé²è¿…è¿è‡³ç –å¡”èƒ¡åŒã€è¥¿ä¸‰æ¡21å·"},
                    {year: 1926, desc: "é²è¿…å—ä¸‹åé™ªä¼´é²è¿…æ¯äº²"}
                ]},
                {source: "luxun", target: "yuxinzi", strength: 2, events: [
                    {year: 1909, desc: "ç»“è¯†ï¼ˆå¼Ÿåª³ï¼‰"}
                ]},
                {source: "luxun", target: "zhoufengyi", strength: 2, events: [
                    {year: 1912, desc: "å‡ºç”Ÿï¼ˆä¾„å„¿ï¼‰"},
                    {year: 1919, desc: "è¿è‡³åŒ—äº¬ï¼Œé²è¿…å¸¸ä¹°é£Ÿå“å’Œç©å…·"},
                    {year: 1923, desc: "é²è¿…å…„å¼Ÿå¤±å’Œåä¸å†æ¥å¾€"}
                ]},

                // åŒä¹¡å…³ç³»é“¾æ¥
                {source: "luxun", target: "xushoushang", strength: 5, events: [
                    {year: 1909, desc: "ç»“è¯†ï¼ˆåŒçª—ï¼Œæœ€äº²å¯†æœ‹å‹ï¼‰"},
                    {year: 1912, desc: "å‘è”¡å…ƒåŸ¹æ¨èé²è¿…åˆ°æ•™è‚²éƒ¨å·¥ä½œ"},
                    {year: 1925, desc: "é²è¿…è¢«å…èŒï¼Œå…¶æ„¤è€Œè¾èŒ"}
                ]},
                {source: "luxun", target: "qianxuantong", strength: 4, events: [
                    {year: 1917, desc: "åŠ å…¥ã€Šæ–°é’å¹´ã€‹ï¼Œä¸é²è¿…å…³ç³»å¯†åˆ‡"},
                    {year: 1920, desc: "ã€Šæ–°é’å¹´ã€‹ç¼–å§”ä¼šåˆ†åŒ–ï¼Œå…³ç³»æ¸æ¸ç–è¿œ"}
                ]},
                {source: "luxun", target: "caiyuanpei", strength: 4, events: [
                    {year: 1912, desc: "è˜è¯·é²è¿…åˆ°æ•™è‚²éƒ¨ä»»èŒ"},
                    {year: 1920, desc: "è˜è¯·é²è¿…ä¸ºåŒ—äº¬å¤§å­¦è®²å¸ˆ"},
                    {year: 1927, desc: "è˜è¯·é²è¿…ä¸ºç‰¹çº¦æ’°è¿°å‘˜"}
                ]},
                {source: "luxun", target: "shenyinmo", strength: 3, events: [
                    {year: 1918, desc: "å‚ä¸ç¼–è¾‘ã€Šæ–°é’å¹´ã€‹"},
                    {year: 1925, desc: "ä¸é²è¿…ç­‰è”åå‘è¡¨ã€Šå…³äºåŒ—äº¬å¥³å­å¸ˆèŒƒå¤§å­¦é£æ½®å®£è¨€ã€‹"}
                ]},
                {source: "luxun", target: "mayouyu", strength: 3, events: [
                    {year: 1908, desc: "ç»“è¯†ï¼ˆåŒå­¦ï¼‰"},
                    {year: 1920, desc: "è˜è¯·é²è¿…åˆ°åŒ—äº¬å¤§å­¦è®²æˆä¸­å›½å°è¯´å²"}
                ]},
                {source: "luxun", target: "shenjianshi", strength: 3, events: [
                    {year: 1918, desc: "ç»“è¯†"},
                    {year: 1925, desc: "åŒé²è¿…ç­‰å‘è¡¨ã€Šå¯¹äºåŒ—äº¬å¥³å­å¸ˆèŒƒå¤§å­¦é£æ½®å®£è¨€ã€‹"},
                    {year: 1926, desc: "éšé²è¿…èµ´å¦é—¨å¤§å­¦å›½æ–‡ç³»ä»»æ•™"}
                ]},
                {source: "luxun", target: "xumianbo", strength: 3, events: [
                    {year: 1920, desc: "åˆ°åŒ—äº¬æŠ•è€ƒï¼Œæš‚ä½å…«é“æ¹¾å‘¨å®…"},
                    {year: 1921, desc: "æŠ¥è€ƒåŒ—äº¬å¥³å¸ˆï¼Œé²è¿…ä½œä¿"},
                    {year: 1924, desc: "è‡ªåŒ—äº¬å¥³å­é«˜ç­‰å¸ˆèŒƒå­¦æ ¡æ¯•ä¸š"},
                    {year: 1926, desc: "é²è¿…å—ä¸‹åï¼Œå¸®é²è¿…æ¯äº²æ–™ç†å®¶åŠ¡"}
                ]},
                {source: "luxun", target: "shenyantong", strength: 4, events: [
                    {year: 1921, desc: "ä¸é²è¿…å¼€å§‹é€šä¿¡"},
                    {year: 1926, desc: "ä¸é²è¿…é¦–æ¬¡è§é¢ï¼ˆåœ¨ä¸Šæµ·ï¼‰"}
                ]},
                {source: "luxun", target: "yudafu", strength: 3, events: [
                    {year: 1923, desc: "ä¸é²è¿…åŒåœ¨åŒ—äº¬å¤§å­¦ä»»æ•™ï¼Œæ¥å¾€å¯†åˆ‡"},
                    {year: 1925, desc: "å›äº¬åº¦å‡æ—¶æ‹œè®¿é²è¿…"},
                    {year: 1926, desc: "å›äº¬åº¦å‡æ—¶æ‹œè®¿é²è¿…"}
                ]},
                {source: "luxun", target: "jiangyiji", strength: 2, events: [
                    {year: 1902, desc: "åŒæœŸåˆ°æ—¥æœ¬ç•™å­¦"},
                    {year: 1909, desc: "èµ„åŠ©å‡ºç‰ˆã€ŠåŸŸå¤–å°è¯´é›†ã€‹"}
                ]},
                {source: "luxun", target: "songzipai", strength: 3, events: [
                    {year: 1913, desc: "åˆ°åŒ—äº¬ä¸é²è¿…åŒä½ç»å…´ä¼šé¦†"},
                    {year: 1926, desc: "é²è¿…æ‰˜å…¶ç…§é¡¾å®¶äºº"}
                ]},

                // åŒäº‹å…³ç³»é“¾æ¥
                {source: "luxun", target: "qishoushan", strength: 4, events: [
                    {year: 1912, desc: "ç»“è¯†ï¼ˆåŒäº‹ï¼Œå¯†åˆ‡æœ‹å‹ï¼‰"},
                    {year: 1917, desc: "å¼ å‹‹å¤è¾Ÿæ—¶åŠ©é²è¿…é¿éš¾"},
                    {year: 1924, desc: "é²è¿…è´­æˆ¿æ—¶èµ„é‡‘ä¸Šå¸®å¿™"},
                    {year: 1925, desc: "é²è¿…è¢«å…èŒï¼Œå…¶è¾èŒæŠ—è®®"}
                ]},
                {source: "luxun", target: "zhangxiehou", strength: 3, events: [
                    {year: 1924, desc: "ç»“è¯†ï¼ˆåŒäº‹ï¼Œä¸Šå¸ï¼‰"},
                    {year: 1925, desc: "é²è¿…å› æ”¯æŒå¥³å¸ˆå¤§å­¦ç”Ÿè¿åŠ¨è¢«ä»–é©èŒï¼Œé²è¿…ä¸ºæ­¤å‘å¹³æ”¿é™¢æå‡ºæ§å‘Š"}
                ]},
                {source: "luxun", target: "xujishang", strength: 3, events: [
                    {year: 1912, desc: "ç»“è¯†ï¼ˆåŒäº‹ï¼Œäº¤å¾€ç”šå¯†ï¼‰"},
                    {year: 1914, desc: "ä¿ƒæˆé²è¿…å‡ºèµ„åˆ»å°ã€Šç™¾å–»ç»ã€‹"}
                ]},
                {source: "luxun", target: "chenqingyuan", strength: 3, events: [
                    {year: 1913, desc: "åˆ°åŒ—äº¬ä»äº‹ç¾æœ¯æ•™è‚²å·¥ä½œï¼Œä¸é²è¿…å‹è°Šé¢‡æ·±"},
                    {year: 1915, desc: "ç»å¸¸ä¸€èµ·åƒé¥­ã€ç•…è°ˆï¼Œé€›ç‰ç’ƒå‚ã€å°å¸‚"}
                ]},
                {source: "luxun", target: "xujixuan", strength: 3, events: [
                    {year: 1912, desc: "ç»“è¯†ï¼ˆåŒäº‹ï¼Œå¥½å‹ï¼‰"},
                    {year: 1925, desc: "æ¥å¾€å¯†åˆ‡ï¼Œå¸¸åœ¨ä¸€èµ·é€›å°å¸‚ã€ä¹°ä¹¦ç±äº’èµ æ‹“ç‰‡"}
                ]},

                // å­¦ç”Ÿå…³ç³»é“¾æ¥
                {source: "luxun", target: "liubannong", strength: 3, events: [
                    {year: 1918, desc: "ã€Šæ–°é’å¹´ã€‹åŒäºº"},
                    {year: 1920, desc: "åŒ—äº¬å¤§å­¦å…±äº‹"}
                ]},
                {source: "luxun", target: "liuhezhen", strength: 2, events: [
                    {year: 1925, desc: "å¥³å¸ˆå¤§é£æ½®"},
                    {year: 1926, desc: "ä¸‰ä¸€å…«æƒ¨æ¡ˆï¼Œåˆ˜å’Œçç‰ºç‰²ï¼Œé²è¿…å†™ä¸‹ã€Šçºªå¿µåˆ˜å’Œçå›ã€‹"}
                ]},
                {source: "luxun", target: "sunfuyuan", strength: 3, events: [
                    {year: 1919, desc: "å…¼ä»»åŒ—äº¬ã€Šå›½æ°‘å…¬æŠ¥Â·å‰¯åˆŠã€‹ç¼–è¾‘"},
                    {year: 1920, desc: "å…¼ä»»ã€Šæ™¨æŠ¥ã€‹ç¼–è¾‘"}
                ]},
                {source: "luxun", target: "huyuzhi", strength: 2, events: [
                    {year: 1921, desc: "å› ä»‹ç»çˆ±ç½—å…ˆç‚åˆ°åŒ—äº¬å¤§å­¦ä»»æ•™ä¸é²è¿…å¼€å§‹ä¹¦ä¿¡å¾€æ¥"},
                    {year: 1926, desc: "é²è¿…æŠµè¾¾ä¸Šæµ·çš„ç¬¬äºŒå¤©ï¼Œä¸é²è¿…é¦–æ¬¡è§é¢"}
                ]},
                {source: "luxun", target: "xuqinwen", strength: 3, events: [
                    {year: 1923, desc: "ç»å­™ä¼å›­ä»‹ç»ç»“è¯†é²è¿…"},
                    {year: 1926, desc: "çŸ­ç¯‡å°è¯´é›†ã€Šæ•…ä¹¡ã€‹ç”±é²è¿…ç¼–é€‰å‡ºç‰ˆï¼Œåˆ—å…¥ã€Šä¹Œåˆä»ä¹¦ã€‹"}
                ]},
                {source: "luxun", target: "taijingnong", strength: 3, events: [
                    {year: 1925, desc: "åå‚åŠ é²è¿…å‘èµ·æˆç«‹çš„æœªåç¤¾"},
                    {year: 1936, desc: "ä»–ä»¬ç»å¸¸äº’è®¿ï¼Œé²è¿…ä¹¦ä¿¡ä¸­æœ‰è‡´å°é™å†œä¹¦ä¿¡ä¹åé€š"}
                ]},
                {source: "luxun", target: "weisuyuan", strength: 3, events: [
                    {year: 1925, desc: "åœ¨é²è¿…å‘èµ·å’Œæ”¯æŒä¸‹ï¼Œä¸éŸ¦ç´ å›­ã€å°é™å†œç­‰ç»„ç»‡æœªåç¤¾"},
                    {year: 1929, desc: "é²è¿…å›åŒ—äº¬æ¢äº²æ—¶æ›¾ä¸“ç¨‹çœ‹æœ›ä»–ã€‚ä»–å»ä¸–åé²è¿…ä¸ºä»–ä¹¦å†™äº†ç¢‘è®°ï¼Œå¹¶ä½œã€Šå¿†éŸ¦ç´ å›­å›ã€‹ä¸€æ–‡"}
                ]},
                {source: "luxun", target: "liyexia", strength: 3, events: [
                    {year: 1925, desc: "å¼€å§‹è®¤è¯†å¹¶å†™ä¿¡ç»™é²è¿…"},
                    {year: 1936, desc: "ã€Šé²è¿…æ—¥è®°ã€‹ä¸­æåŠæéœé‡æœ‰247å¤„ï¼Œè‡´ä»–çš„ä¹¦ä¿¡ä¹Ÿæœ‰äºŒç™¾å¤šé€š"}
                ]},

                // å‹äººå…³ç³»é“¾æ¥
                {source: "luxun", target: "hushi", strength: 3, events: [
                    {year: 1918, desc: "å…±åŒå‚ä¸ã€Šæ–°é’å¹´ã€‹ç¼–è¾‘å·¥ä½œ"},
                    {year: 1924, desc: "å¾€æ¥ç ”ç©¶å°è¯´å²"}
                ]},
                {source: "luxun", target: "linda", strength: 2, events: [
                    {year: 1918, desc: "åœ¨ã€Šæ–°é’å¹´ã€‹ç¼–è¾‘ä¼šä¸Šç›¸è¯†å¹¶äº¤å¾€"}
                ]},
                {source: "luxun", target: "chenduxiu", strength: 2, events: [
                    {year: 1920, desc: "é²è¿…ç»å¸¸å¯„ç¨¿ä»¶ç»™ä»–å¹¶æœ‰ä¹¦ä¿¡å¾€æ¥"}
                ]},
                {source: "luxun", target: "zhengzhenduo", strength: 2, events: [
                    {year: 1921, desc: "å¼€å§‹é€šä¿¡"},
                    {year: 1926, desc: "åœ¨ä¸Šæµ·é¦–æ¬¡è§é¢"}
                ]},
                {source: "luxun", target: "lingyutang", strength: 2, events: [
                    {year: 1924, desc: "ä¸ºã€Šè¯­ä¸ã€‹ã€ã€Šè½åŸã€‹ç­‰æ’°ç¨¿"},
                    {year: 1926, desc: "åŒå¸­äºåˆ˜åŠå†œå®¶å®´"}
                ]},
                {source: "luxun", target: "lixiaofeng", strength: 2, events: [
                    {year: 1923, desc: "é¦–æ¬¡åœ¨ä¸­å¤®å…¬å›­è§é¢"},
                    {year: 1924, desc: "å…±åŒåˆ›åŠã€Šè¯­ä¸ã€‹å‘¨åˆŠ"},
                    {year: 1925, desc: "åœ¨é²è¿…æ”¯æŒä¸‹åˆ›ç«‹åŒ—æ–°ä¹¦å±€"}
                ]},
                {source: "luxun", target: "zhangfengju", strength: 2, events: [
                    {year: 1925, desc: "ä¸é²è¿…è½®æµç¼–è¾‘ã€Šå›½æ°‘æ–°æŠ¥Â·å‰¯åˆŠã€‹"},
                    {year: 1929, desc: "äº’èµ ä¹¦ç±ã€æ‹“ç‰‡åŠèšé¤"}
                ]},
                {source: "luxun", target: "gaohanghong", strength: 2, events: [
                    {year: 1924, desc: "åˆæ¬¡æ™¤è§é²è¿…"},
                    {year: 1925, desc: "ä¸é²è¿…ç­‰åˆåŠã€Šè½åŸã€‹"}
                ]}
            ]
        };

        // å…¨å±€å˜é‡
        let currentYear = 1912;
        let isPlaying = false;
        let selectedFilter = 'all';
        let simulation, svg, g, link, node, label;
        let width, height;

        // é¢œè‰²æ˜ å°„
        const categoryColors = {
            'center': '#ff6b35',
            'äº²å±': '#e74c3c',
            'å­¦ç”Ÿ': '#3498db',
            'åŒäº‹': '#f39c12',
            'åŒä¹¡': '#2ecc71',
            'å‹äºº': '#9b59b6',
            'å…¶ä»–': '#34495e'
        };

        // åˆå§‹åŒ–
        function init() {
            setupCanvas();
            setupTimeline();
            setupFilters();
            setupSearch();
            setupBioSidebar();
            createNetwork();
            updateNetwork(currentYear);
        }

        // è®¾ç½®ç”»å¸ƒ
        function setupCanvas() {
            width = window.innerWidth;
            height = window.innerHeight;

            svg = d3.select("#networkSvg")
                .attr("width", width)
                .attr("height", height);

            // æ·»åŠ ç¼©æ”¾è¡Œä¸º
            const zoom = d3.zoom()
                .scaleExtent([0.5, 3])
                .on("zoom", (event) => {
                    g.attr("transform", event.transform);
                });

            svg.call(zoom);

            g = svg.append("g");
        }

        // åˆ›å»ºç½‘ç»œå›¾
        function createNetwork() {
            // åˆ›å»ºåŠ›å¯¼å‘æ¨¡æ‹Ÿ
            simulation = d3.forceSimulation(networkData.nodes)
                .force("link", d3.forceLink(networkData.links)
                    .id(d => d.id)
                    .distance(d => 150 - d.strength * 20))
                .force("charge", d3.forceManyBody().strength(-800))
                .force("center", d3.forceCenter(width / 2, height / 2))
                .force("collision", d3.forceCollide().radius(d => d.radius + 5));

            // åˆ›å»ºè¿çº¿
            link = g.append("g")
                .selectAll("line")
                .data(networkData.links)
                .enter().append("line")
                .attr("class", "link")
                .attr("stroke-width", d => Math.sqrt(d.strength) * 2)
                .on("mouseover", function(event, d) {
                    showLinkTooltip(event, d);
                })
                .on("mouseout", hideTooltip);

            // åˆ›å»ºèŠ‚ç‚¹ç»„
            const nodeGroup = g.append("g")
                .selectAll("g")
                .data(networkData.nodes)
                .enter().append("g")
                .attr("class", "node")
                .call(d3.drag()
                    .on("start", dragStarted)
                    .on("drag", dragged)
                    .on("end", dragEnded));

            // æ·»åŠ èŠ‚ç‚¹åœ†åœˆ
            node = nodeGroup.append("circle")
                .attr("r", d => d.radius)
                .attr("fill", d => d.color)
                .attr("stroke", "#fff")
                .attr("stroke-width", 3)
                .style("filter", "drop-shadow(0 4px 8px rgba(0,0,0,0.2))")
                .on("click", handleNodeClick);

            // æ·»åŠ èŠ‚ç‚¹æ ‡ç­¾
            label = nodeGroup.append("text")
                .attr("class", "node-label")
                .attr("dy", d => d.radius + 20)
                .text(d => d.name);

            // æ›´æ–°æ¨¡æ‹Ÿ
            simulation.on("tick", () => {
                link
                    .attr("x1", d => d.source.x)
                    .attr("y1", d => d.source.y)
                    .attr("x2", d => d.target.x)
                    .attr("y2", d => d.target.y);

                nodeGroup
                    .attr("transform", d => `translate(${d.x},${d.y})`);
            });
        }

        // æ›´æ–°ç½‘ç»œå›¾ï¼ˆæ ¹æ®å¹´ä»½ï¼‰
        function updateNetwork(year) {
            currentYear = year;
            
            // è¿‡æ»¤èŠ‚ç‚¹
            const visibleNodes = networkData.nodes.filter(d => d.year <= year);
            const visibleNodeIds = new Set(visibleNodes.map(d => d.id));
            
            // è¿‡æ»¤è¿çº¿
            const visibleLinks = networkData.links.filter(d => 
                visibleNodeIds.has(d.source.id || d.source) && 
                visibleNodeIds.has(d.target.id || d.target)
            );

            // æ›´æ–°è¿çº¿
            link = link.data(visibleLinks, d => `${d.source.id || d.source}-${d.target.id || d.target}`);
            
            link.exit()
                .transition()
                .duration(500)
                .style("opacity", 0)
                .remove();

            const linkEnter = link.enter()
                .append("line")
                .attr("class", "link")
                .attr("stroke-width", d => Math.sqrt(d.strength) * 2)
                .style("opacity", 0);

            link = linkEnter.merge(link);

            // æ£€æŸ¥æ–­è£‚å…³ç³»
            link.classed("broken", d => {
                if (d.source.id === "luxun" && d.target.id === "zhouzuoren" && year >= 1923) {
                    return true;
                }
                return false;
            });

            link.transition()
                .duration(500)
                .style("opacity", d => {
                    if (d.source.id === "luxun" && d.target.id === "zhouzuoren" && year >= 1923) {
                        return 0.3;
                    }
                    return 0.6;
                });

            // æ›´æ–°èŠ‚ç‚¹
            const nodeGroup = g.select("g").selectAll(".node");
            
            nodeGroup.style("opacity", d => d.year <= year ? 1 : 0.1);

            // é‡æ–°è¿è¡Œæ¨¡æ‹Ÿ
            simulation.nodes(visibleNodes);
            simulation.force("link").links(visibleLinks);
            simulation.alpha(0.3).restart();

            // æ›´æ–°å¹´ä»½æ˜¾ç¤º
            document.getElementById('yearDisplay').textContent = year;
        }

        // è®¾ç½®æ—¶é—´è½´
        function setupTimeline() {
            const sliderHandle = document.getElementById('sliderHandle');
            const sliderTrack = document.querySelector('.slider-track');
            const playBtn = document.getElementById('playBtn');
            
            let isDragging = false;
            let playInterval;

            // æ‹–åŠ¨åŠŸèƒ½
            sliderHandle.addEventListener('mousedown', startDragging);
            document.addEventListener('mousemove', drag);
            document.addEventListener('mouseup', stopDragging);

            function startDragging(e) {
                isDragging = true;
                sliderHandle.style.cursor = 'grabbing';
            }

            function drag(e) {
                if (!isDragging) return;
                
                const rect = sliderTrack.getBoundingClientRect();
                const percent = Math.max(0, Math.min(1, (e.clientX - rect.left) / rect.width));
                const year = 1912 + Math.round(percent * 14);
                
                updateSliderPosition(percent);
                updateNetwork(year);
            }

            function stopDragging() {
                isDragging = false;
                sliderHandle.style.cursor = 'grab';
            }

            // ç‚¹å‡»è½¨é“
            sliderTrack.addEventListener('click', (e) => {
                if (e.target === sliderHandle) return;
                
                const rect = sliderTrack.getBoundingClientRect();
                const percent = (e.clientX - rect.left) / rect.width;
                const year = 1912 + Math.round(percent * 14);
                
                updateSliderPosition(percent);
                updateNetwork(year);
            });

            // æ’­æ”¾åŠŸèƒ½
            playBtn.addEventListener('click', () => {
                if (isPlaying) {
                    stopPlaying();
                } else {
                    startPlaying();
                }
            });

            function startPlaying() {
                isPlaying = true;
                playBtn.textContent = 'â¸';
                
                let year = currentYear;
                playInterval = setInterval(() => {
                    if (year >= 1926) {
                        stopPlaying();
                        return;
                    }
                    
                    year++;
                    const percent = (year - 1912) / 14;
                    updateSliderPosition(percent);
                    updateNetwork(year);
                }, 800);
            }

            function stopPlaying() {
                isPlaying = false;
                playBtn.textContent = 'â–¶';
                if (playInterval) {
                    clearInterval(playInterval);
                }
            }

            function updateSliderPosition(percent) {
                sliderHandle.style.left = `${percent * 100}%`;
                document.getElementById('sliderProgress').style.width = `${percent * 100}%`;
            }
        }

        // è®¾ç½®ç­›é€‰å™¨
        function setupFilters() {
            const filterBtns = document.querySelectorAll('.filter-btn');
            
            filterBtns.forEach(btn => {
                btn.addEventListener('click', () => {
                    filterByCategory(btn.dataset.filter);
                });
            });
        }

        // åº”ç”¨ç­›é€‰
        function applyFilter() {
            const nodeGroups = g.select("g").selectAll(".node");
            const linkGroups = g.selectAll(".link");
            
            // ç­›é€‰èŠ‚ç‚¹
            nodeGroups.style("opacity", d => {
                if (selectedFilter === 'all') return 1;
                if (d.id === 'luxun') return 1;
                return d.category === selectedFilter ? 1 : 0.1;
            });
            
            // ç­›é€‰è¿çº¿
            linkGroups.style("opacity", d => {
                if (selectedFilter === 'all') return 0.6;
                
                // è·å–æºå’Œç›®æ ‡èŠ‚ç‚¹
                const sourceNode = typeof d.source === 'object' ? d.source : networkData.nodes.find(n => n.id === d.source);
                const targetNode = typeof d.target === 'object' ? d.target : networkData.nodes.find(n => n.id === d.target);
                
                // å¦‚æœä¸¤ç«¯éƒ½æ˜¯ä¸­å¿ƒèŠ‚ç‚¹æˆ–éƒ½å±äºç­›é€‰ç±»åˆ«ï¼Œåˆ™æ˜¾ç¤º
                if (sourceNode.id === 'luxun' || targetNode.id === 'luxun') {
                    const otherNode = sourceNode.id === 'luxun' ? targetNode : sourceNode;
                    if (otherNode.category === selectedFilter || selectedFilter === 'all') {
                        return 0.6;
                    }
                }
                
                return 0.05; // å…¶ä»–è¿çº¿é€æ˜åº¦å¾ˆä½
            });
            
            // æ›´æ–°ç»Ÿè®¡ä¿¡æ¯
            updateFilterStats();
        }
        
        // æ›´æ–°ç­›é€‰ç»Ÿè®¡ä¿¡æ¯
        function updateFilterStats() {
            const visibleNodes = networkData.nodes.filter(d => {
                if (selectedFilter === 'all') return true;
                if (d.id === 'luxun') return true;
                return d.category === selectedFilter;
            });
            
            const statsElement = document.querySelector('.year-display');
            if (statsElement && selectedFilter !== 'all') {
                statsElement.innerHTML = `${currentYear}å¹´<br><small style="font-size: 14px; opacity: 0.7;">(${selectedFilter}: ${visibleNodes.length}äºº)</small>`;
            } else if (statsElement) {
                statsElement.innerHTML = `${currentYear}å¹´`;
            }
        }

        // è®¾ç½®æœç´¢
        function setupSearch() {
            const searchInput = document.getElementById('searchInput');
            const searchBtn = document.querySelector('.search-btn');
            
            const performSearch = () => {
                const searchTerm = searchInput.value.trim();
                if (!searchTerm) return;
                
                const foundNode = networkData.nodes.find(n => 
                    n.name.includes(searchTerm)
                );
                
                if (foundNode) {
                    // ç¼©æ”¾åˆ°èŠ‚ç‚¹
                    const transform = d3.zoomIdentity
                        .translate(width / 2 - foundNode.x, height / 2 - foundNode.y)
                        .scale(2);
                    
                    svg.transition()
                        .duration(750)
                        .call(d3.zoom().transform, transform);
                    
                    // é«˜äº®èŠ‚ç‚¹
                    g.selectAll(".node circle")
                        .style("opacity", d => d.id === foundNode.id ? 1 : 0.3);
                    
                    // æ˜¾ç¤ºäººç‰©å¡ç‰‡
                    showBioSidebar(foundNode);
                }
            };
            
            searchBtn.addEventListener('click', performSearch);
            searchInput.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') performSearch();
            });
        }

        // è®¾ç½®äººç‰©å¡ç‰‡
        function setupBioSidebar() {
            const closeBtn = document.getElementById('bioClose');
            closeBtn.addEventListener('click', hideBioSidebar);
        }

        // å¤„ç†èŠ‚ç‚¹ç‚¹å‡»
        function handleNodeClick(event, d) {
            showBioSidebar(d);
        }

        // æ˜¾ç¤ºäººç‰©å¡ç‰‡
        function showBioSidebar(person) {
            const sidebar = document.getElementById('bioSidebar');
            
            document.getElementById('bioName').textContent = person.name;
            document.getElementById('bioRelation').textContent = person.category;
            document.getElementById('bioTime').textContent = `${person.year}å¹´`;
            
            // æ ¹æ®äººç‰©è®¾ç½®èƒŒæ™¯
            const backgrounds = {
                // äº²å±
                'zhouzuoren': 'å‘¨ä½œäººï¼Œé²è¿…çš„äºŒå¼Ÿï¼Œè‘—åä½œå®¶ï¼Œ1923å¹´ä¸é²è¿…å…³ç³»ç ´è£‚ï¼Œäº’é€šä¿¡ä»¶900é€š',
                'zhoujianren': 'å‘¨å»ºäººï¼Œé²è¿…çš„ä¸‰å¼Ÿï¼Œç”Ÿç‰©å­¦å®¶ï¼Œé²è¿…æ”¯æŒå…¶å­¦ä¸š',
                'xuguangping': 'è®¸å¹¿å¹³ï¼Œé²è¿…çš„å­¦ç”Ÿï¼Œåæˆä¸ºå¦»å­ï¼Œä¸­å±±å¤§å­¦å­¦ç”Ÿï¼Œ1925å¹´å¼€å§‹ä¸é²è¿…é€šä¿¡',
                'lurui': 'é²ç‘ï¼Œé²è¿…çš„æ¯äº²ï¼Œä¸€ç›´ç”±é²è¿…èµ¡å…»ï¼Œ1936å¹´åé²è¿…å¸¸ç»™æ¯äº²å†™ä¿¡',
                'zhuan': 'æœ±å®‰ï¼Œé²è¿…çš„åŒ…åŠå©šå§»å¦»å­ï¼Œé²è¿…å—ä¸‹åé™ªä¼´é²è¿…æ¯äº²',
                'yuxinzi': 'ç¾½å¤ªä¿¡å­ï¼Œå‘¨ä½œäººçš„å¦»å­ï¼Œé²è¿…çš„å¼Ÿåª³',
                'ruhesun': 'é˜®å’Œå­™ï¼Œé²è¿…çš„è¡¨å…„ï¼Œ1936å¹´ä¿æŒä¹¦ä¿¡å¾€æ¥',
                'zhoufengyi': 'å‘¨ä¸°ä¸€ï¼Œé²è¿…çš„ä¾„å„¿ï¼Œ1919å¹´è¿è‡³åŒ—äº¬ï¼Œé²è¿…å¸¸ä¹°é£Ÿå“å’Œç©å…·',
                'zhuoming': 'æœ±å¯é“­ï¼Œé²è¿…çš„å…„é•¿ï¼Œ1920-1921å¹´å¤šæ¬¡æ‹œè®¿é²è¿…',
                
                // åŒä¹¡
                'xushoushang': 'è®¸å¯¿è£³ï¼Œé²è¿…çš„æŒšå‹ï¼Œæ•™è‚²å®¶ï¼Œé²è¿…ç•™å­¦æ—¥æœ¬æ—¶çš„åŒå­¦ï¼Œæœ€äº²å¯†æœ‹å‹',
                'qianxuantong': 'é’±ç„åŒï¼Œè‘—åå­¦è€…ï¼Œæ–°æ–‡åŒ–è¿åŠ¨é‡è¦äººç‰©ï¼Œã€Šæ–°é’å¹´ã€‹ç¼–å§”',
                'caiyuanpei': 'è”¡å…ƒåŸ¹ï¼Œæ•™è‚²å®¶ï¼ŒåŒ—äº¬å¤§å­¦æ ¡é•¿ï¼Œè˜è¯·é²è¿…åˆ°æ•™è‚²éƒ¨å’ŒåŒ—å¤§ä»»èŒ',
                'shenyinmo': 'æ²ˆå°¹é»˜ï¼Œè‘—åå­¦è€…ã€ä¹¦æ³•å®¶ï¼Œå‚ä¸ç¼–è¾‘ã€Šæ–°é’å¹´ã€‹',
                'mayouyu': 'é©¬å¹¼æ¸”ï¼ŒåŒ—äº¬å¤§å­¦æ•™æˆï¼Œè˜è¯·é²è¿…è®²æˆä¸­å›½å°è¯´å²',
                'shenjianshi': 'æ²ˆå…¼å£«ï¼Œè‘—åå­¦è€…ï¼Œéšé²è¿…èµ´å¦é—¨å¤§å­¦å›½æ–‡ç³»ä»»æ•™',
                'xumianbo': 'è®¸ç¾¡è‹ï¼Œé²è¿…çš„å­¦ç”Ÿï¼Œ1920å¹´åˆ°åŒ—äº¬æŠ•è€ƒï¼Œæš‚ä½å…«é“æ¹¾å‘¨å®…',
                'shenyantong': 'æ²ˆé›å†°ï¼ˆèŒ…ç›¾ï¼‰ï¼Œè‘—åä½œå®¶ï¼Œ1921å¹´å¼€å§‹ä¸é²è¿…é€šä¿¡',
                'yudafu': 'éƒè¾¾å¤«ï¼Œè‘—åä½œå®¶ï¼Œåˆ›é€ ç¤¾æˆå‘˜ï¼Œä¸é²è¿…åŒåœ¨åŒ—äº¬å¤§å­¦ä»»æ•™',
                'jiangyiji': 'è’‹æŠ‘å®ï¼Œé²è¿…çš„ç•™æ—¥åŒå­¦ï¼Œèµ„åŠ©å‡ºç‰ˆã€ŠåŸŸå¤–å°è¯´é›†ã€‹',
                'songzipai': 'å®‹ç´«ä½©ï¼Œé²è¿…çš„åŒä¹¡ã€å­¦ç”Ÿã€åŒäº‹ï¼Œ1913å¹´åˆ°åŒ—äº¬ä¸é²è¿…åŒä½ç»å…´ä¼šé¦†',
                'zhuxizu': 'æœ±å¸Œç¥–ï¼Œè‘—åå²å­¦å®¶ï¼Œé²è¿…çš„ç•™æ—¥åŒå­¦ï¼Œç»å¸¸èšé¤é¥®é…’',
                'xumingbo': 'è®¸é“­ä¼¯ï¼Œè®¸å¯¿è£³çš„å…„é•¿ï¼Œ1912å¹´é²è¿…åˆåˆ°åŒ—äº¬å½“æ™šæ‹œè®¿',
                'xushichen': 'è®¸è¯—èƒï¼Œ1912å¹´ä¸é²è¿…åŒèˆ¹åˆ°åŒ—äº¬ï¼Œ1913å¹´é²è¿…å‡ºå¸­å…¶è®¢å©šå®´',
                
                // åŒäº‹
                'qishoushan': 'é½å¯¿å±±ï¼Œé²è¿…çš„åŒä¹¡ï¼Œæ•™è‚²éƒ¨åŒäº‹ï¼Œå¯†åˆ‡æœ‹å‹ï¼Œå¼ å‹‹å¤è¾Ÿæ—¶åŠ©é²è¿…é¿éš¾',
                'zhangxiehou': 'ç« å£«é’Šï¼Œæ•™è‚²æ€»é•¿ï¼Œé²è¿…å› æ”¯æŒå¥³å¸ˆå¤§å­¦ç”Ÿè¿åŠ¨è¢«ä»–é©èŒ',
                'xujishang': 'è®¸å­£ä¸Šï¼Œæ•™è‚²éƒ¨åŒäº‹ï¼Œäº¤å¾€ç”šå¯†ï¼Œä¿ƒæˆé²è¿…å‡ºèµ„åˆ»å°ã€Šç™¾å–»ç»ã€‹',
                'chenqingyuan': 'é™ˆå¸ˆæ›¾ï¼Œè‘—åç”»å®¶ï¼Œé²è¿…çš„ç•™æ—¥åŒå­¦ï¼Œå‹è°Šé¢‡æ·±',
                'xujixuan': 'å¾å‰è½©ï¼Œæ•™è‚²éƒ¨åŒäº‹ï¼Œå¥½å‹ï¼Œæ¥å¾€å¯†åˆ‡ï¼Œå¸¸ä¸€èµ·é€›å°å¸‚ä¹°ä¹¦ç±',
                'qiushanyuan': 'è£˜å–„å…ƒï¼Œæ•™è‚²éƒ¨åŒäº‹ï¼Œå¥½å‹ï¼Œå¸¸æ‰¾é²è¿…èŠå¤©ï¼Œ"å¤œè£˜å­å…ƒæ¥ï¼Œè‡³å¤œæ–¹å»"',
                'qiansuna': 'é’±ç¨»å­™ï¼Œæ•™è‚²éƒ¨åŒäº‹ï¼Œå…³ç³»è¿‘ï¼Œä¸é²è¿…ã€è®¸å¯¿è£³è®¾è®¡å›½å¾½å›¾æ¡ˆ',
                'dailie': 'æˆ´èºèˆ²ï¼Œæ•™è‚²éƒ¨åŒäº‹ï¼Œæœ‹å‹ï¼Œäº¤å¾€è®°å½•ç™¾ä½™å¤„ï¼Œå…³ç³»äº²è¿‘',
                
                // å­¦ç”Ÿ
                'liubannong': 'åˆ˜åŠå†œï¼Œè¯—äººã€è¯­è¨€å­¦å®¶ï¼ŒåŒ—äº¬å¤§å­¦æ•™æˆï¼Œã€Šæ–°é’å¹´ã€‹åŒäºº',
                'liuhezhen': 'åˆ˜å’Œçï¼ŒåŒ—äº¬å¥³å­å¸ˆèŒƒå¤§å­¦å­¦ç”Ÿï¼Œä¸‰ä¸€å…«æƒ¨æ¡ˆç‰ºç‰²è€…',
                'sunfuyuan': 'å­™ä¼å›­ï¼Œä½œå®¶ï¼Œç¼–è¾‘ï¼Œå…¼ä»»åŒ—äº¬ã€Šå›½æ°‘å…¬æŠ¥Â·å‰¯åˆŠã€‹å’Œã€Šæ™¨æŠ¥ã€‹ç¼–è¾‘',
                'huyuzhi': 'èƒ¡æ„ˆä¹‹ï¼Œè‘—åå‡ºç‰ˆå®¶ã€ç¿»è¯‘å®¶ï¼Œ1921å¹´å› ä»‹ç»çˆ±ç½—å…ˆç‚ä¸é²è¿…å¼€å§‹é€šä¿¡',
                'xuqinwen': 'è®¸é’¦æ–‡ï¼Œä½œå®¶ï¼Œç»å­™ä¼å›­ä»‹ç»ç»“è¯†é²è¿…ï¼ŒçŸ­ç¯‡å°è¯´é›†ã€Šæ•…ä¹¡ã€‹ç”±é²è¿…ç¼–é€‰å‡ºç‰ˆ',
                'taijingnong': 'å°é™å†œï¼Œä½œå®¶ï¼Œæœªåç¤¾æˆå‘˜ï¼Œä»–ä»¬ç»å¸¸äº’è®¿ï¼Œé²è¿…ä¹¦ä¿¡ä¸­æœ‰è‡´å°é™å†œä¹¦ä¿¡ä¹åé€š',
                'weisuyuan': 'éŸ¦ç´ å›­ï¼Œä½œå®¶ï¼Œæœªåç¤¾æˆå‘˜ï¼Œé²è¿…ä¸ä»–äº¤å¾€å¯†åˆ‡ï¼Œç»å¸¸äº’è®¿ï¼Œè®¨è®ºç¨¿ä»¶',
                'liyexia': 'æéœé‡ï¼Œç¿»è¯‘å®¶ï¼Œæœªåç¤¾æˆå‘˜ï¼Œã€Šé²è¿…æ—¥è®°ã€‹ä¸­æåŠæéœé‡æœ‰247å¤„',
                'caojinghua': 'æ›¹é–åï¼Œç¿»è¯‘å®¶ï¼Œæœªåç¤¾æˆå‘˜ï¼Œå› ç‹å¸Œç¤¼ä¿„è¯‘ã€Šé˜¿Qæ­£ä¼ ã€‹äº‹ä¸é²è¿…é€šä¿¡',
                'jingyoulin': 'è†æœ‰éºŸï¼Œä½œå®¶ï¼Œã€Šè½åŸã€‹æ’°ç¨¿äººï¼Œå­¦æ ¡åœåŠåé²è¿…ä»‹ç»å…¶ä»»äº¬æŠ¥é¦†æ ¡å¯¹',
                'changweijun': 'ä½œå®¶ï¼Œæœªåç¤¾æˆå‘˜ï¼Œç»å¸¸æ‹œè®¿é²è¿…ï¼Œå’Œé²è¿…äº’æœ‰èµ ä¹¦',
                'xiangpeliang': 'å‘åŸ¹è‰¯ï¼Œä½œå®¶ï¼Œã€Šè½åŸã€‹æ’°ç¨¿äººï¼Œ1924å¹´ä¸é²è¿…äº¤å¾€é¢‘ç¹',
                
                // å‹äººåŠå…¶ä»–
                'hushi': 'èƒ¡é€‚ï¼Œå­¦è€…ï¼Œæ–°æ–‡åŒ–è¿åŠ¨é¢†è¢–ï¼Œå…±åŒå‚ä¸ã€Šæ–°é’å¹´ã€‹ç¼–è¾‘å·¥ä½œ',
                'linda': 'æå¤§é’Šï¼Œé©å‘½å®¶ï¼Œä¸­å›½å…±äº§å…šåˆ›å§‹äººï¼Œåœ¨ã€Šæ–°é’å¹´ã€‹ç¼–è¾‘ä¼šä¸Šç›¸è¯†å¹¶äº¤å¾€',
                'chenduxiu': 'é™ˆç‹¬ç§€ï¼Œé©å‘½å®¶ï¼Œä¸­å›½å…±äº§å…šåˆ›å§‹äººï¼Œ1920å¹´è‡³1921å¹´é²è¿…ç»å¸¸å¯„ç¨¿ä»¶ç»™ä»–',
                'zhengzhenduo': 'éƒ‘æŒ¯é“ï¼Œä½œå®¶ã€å­¦è€…ï¼Œ1921å¹´å¼€å§‹é€šä¿¡ï¼Œ1926å¹´åœ¨ä¸Šæµ·é¦–æ¬¡è§é¢',
                'lingyutang': 'æ—è¯­å ‚ï¼Œä½œå®¶ã€å­¦è€…ï¼Œä¸ºã€Šè¯­ä¸ã€‹ã€ã€Šè½åŸã€‹ç­‰æ’°ç¨¿',
                'lixiaofeng': 'æå°å³°ï¼Œå‡ºç‰ˆå®¶ï¼Œå…±åŒåˆ›åŠã€Šè¯­ä¸ã€‹å‘¨åˆŠï¼Œåœ¨é²è¿…æ”¯æŒä¸‹åˆ›ç«‹åŒ—æ–°ä¹¦å±€',
                'zhangfengju': 'å¼ å‡¤ä¸¾ï¼Œä½œå®¶ã€å­¦è€…ï¼Œä¸é²è¿…è½®æµç¼–è¾‘ã€Šå›½æ°‘æ–°æŠ¥Â·å‰¯åˆŠã€‹ï¼Œäº’èµ ä¹¦ç±',
                'gaohanghong': 'é«˜é•¿è™¹ï¼Œä½œå®¶ï¼Œ1924å¹´åˆæ¬¡æ™¤è§é²è¿…ï¼Œä¸é²è¿…ç­‰åˆåŠã€Šè½åŸã€‹'
            };
            
            document.getElementById('bioBackground').textContent = 
                backgrounds[person.id] || 'é²è¿…çš„é‡è¦å…³ç³»äººç‰©';
            
            // æ˜¾ç¤ºç›¸å…³äº‹ä»¶
            const eventsList = document.getElementById('bioEventsList');
            eventsList.innerHTML = '';
            
            const relatedLinks = networkData.links.filter(l => 
                (l.source.id === person.id || l.source === person.id) || 
                (l.target.id === person.id || l.target === person.id)
            );
            
            relatedLinks.forEach(link => {
                if (link.events) {
                    link.events.forEach(event => {
                        const eventDiv = document.createElement('div');
                        eventDiv.className = 'event-item';
                        eventDiv.innerHTML = `
                            <div class="event-year">${event.year}å¹´</div>
                            <div class="event-desc">${event.desc}</div>
                        `;
                        eventsList.appendChild(eventDiv);
                    });
                }
            });
            
            // æ˜¾ç¤ºæ“ä½œæŒ‰é’®
            const bioActions = document.getElementById('bioActions');
            if (bioActions) {
                bioActions.style.display = 'flex';
            }
            
            sidebar.classList.add('active');
        }

        // éšè—äººç‰©å¡ç‰‡
        function hideBioSidebar() {
            document.getElementById('bioSidebar').classList.remove('active');
        }

        // è·³è½¬åˆ°ä¸»å›¾æŸ¥çœ‹ç›¸å…³åœ°ç‚¹
        function goToMainMap() {
            const bioName = document.getElementById('bioName').textContent;
            if (bioName && bioName !== 'äººç‰©å§“å') {
                // æ„é€ URLï¼Œä¼ é€’äººç‰©åç§°å‚æ•°
                const mainMapUrl = `ä¸»å›¾.html?search=${encodeURIComponent(bioName)}`;
                window.open(mainMapUrl, '_blank');
            }
        }

        // åˆ†äº«äººç‰©ä¿¡æ¯
        function sharePerson() {
            const bioName = document.getElementById('bioName').textContent;
            const bioRelation = document.getElementById('bioRelation').textContent;
            const bioBackground = document.getElementById('bioBackground').textContent;
            
            if (bioName && bioName !== 'äººç‰©å§“å') {
                const shareText = `ğŸ“š ${bioName}\nğŸ·ï¸ å…³ç³»ï¼š${bioRelation}\nğŸ“ ç®€ä»‹ï¼š${bioBackground}\nğŸ”— æ¥è‡ªï¼šé²è¿…çš„äººæƒ…ç½—ç½‘`;
                
                // å°è¯•ä½¿ç”¨Web Share API
                if (navigator.share) {
                    navigator.share({
                        title: `${bioName} - é²è¿…çš„äººæƒ…ç½—ç½‘`,
                        text: shareText
                    }).catch(err => {
                        console.log('åˆ†äº«å¤±è´¥ï¼Œä½¿ç”¨å¤‡ç”¨æ–¹æ³•:', err);
                        fallbackShare(shareText);
                    });
                } else {
                    fallbackShare(shareText);
                }
            }
        }

        // å¤‡ç”¨åˆ†äº«æ–¹æ³•
        function fallbackShare(text) {
            // å¤åˆ¶åˆ°å‰ªè´´æ¿
            if (navigator.clipboard) {
                navigator.clipboard.writeText(text).then(() => {
                    alert('âœ… äººç‰©ä¿¡æ¯å·²å¤åˆ¶åˆ°å‰ªè´´æ¿ï¼Œå¯ä»¥ç²˜è´´åˆ†äº«äº†ï¼');
                }).catch(err => {
                    console.error('å¤åˆ¶å¤±è´¥:', err);
                });
            } else {
                // ä¼ ç»Ÿæ–¹æ³•ï¼šåˆ›å»ºä¸´æ—¶æ–‡æœ¬åŒºåŸŸ
                const textArea = document.createElement('textarea');
                textArea.value = text;
                document.body.appendChild(textArea);
                textArea.select();
                try {
                    document.execCommand('copy');
                    alert('âœ… äººç‰©ä¿¡æ¯å·²å¤åˆ¶åˆ°å‰ªè´´æ¿ï¼Œå¯ä»¥ç²˜è´´åˆ†äº«äº†ï¼');
                } catch (err) {
                    console.error('å¤åˆ¶å¤±è´¥:', err);
                }
                document.body.removeChild(textArea);
            }
        }

        // æ›´æ–°å›¾ä¾‹çŠ¶æ€
        function updateLegendState() {
            const legendItems = document.querySelectorAll('.legend-item');
            legendItems.forEach(item => {
                const filter = item.dataset.filter;
                if (filter === selectedFilter) {
                    item.classList.add('active');
                } else {
                    item.classList.remove('active');
                }
            });
        }

        // é€šè¿‡å›¾ä¾‹ç­›é€‰ç±»åˆ«
        function filterByCategory(category) {
            selectedFilter = category;
            
            // æ›´æ–°æŒ‰é’®çŠ¶æ€
            document.querySelectorAll('.filter-btn').forEach(btn => {
                btn.classList.remove('active');
                if (btn.dataset.filter === category) {
                    btn.classList.add('active');
                }
            });
            
            // æ›´æ–°å›¾ä¾‹é¡¹çŠ¶æ€
            document.querySelectorAll('.legend-item').forEach(item => {
                item.classList.remove('active');
                if (item.dataset.filter === category) {
                    item.classList.add('active');
                }
            });
            
            // åº”ç”¨ç­›é€‰
            applyFilter();
        }

        // æ˜¾ç¤ºè¿çº¿æç¤º
        function showLinkTooltip(event, linkData) {
            // è¿™é‡Œå¯ä»¥æ·»åŠ æ›´å¤æ‚çš„æç¤ºæ¡†
            console.log('Link data:', linkData);
        }

        function hideTooltip() {
            // éšè—æç¤ºæ¡†
        }

        // æ‹–æ‹½åŠŸèƒ½
        function dragStarted(event, d) {
            if (!event.active) simulation.alphaTarget(0.3).restart();
            d.fx = d.x;
            d.fy = d.y;
        }

        function dragged(event, d) {
            d.fx = event.x;
            d.fy = event.y;
        }

        function dragEnded(event, d) {
            if (!event.active) simulation.alphaTarget(0);
            d.fx = null;
            d.fy = null;
        }

        // çª—å£å¤§å°è°ƒæ•´
        window.addEventListener('resize', () => {
            width = window.innerWidth;
            height = window.innerHeight;
            
            svg.attr("width", width).attr("height", height);
            simulation.force("center", d3.forceCenter(width / 2, height / 2));
            simulation.alpha(0.3).restart();
        });

        // URLå‚æ•°è§£æåŠŸèƒ½
        function getUrlParameter(name) {
            const urlParams = new URLSearchParams(window.location.search);
            return urlParams.get(name);
        }
        
        // æ ¹æ®URLå‚æ•°è‡ªåŠ¨æœç´¢å¹¶é«˜äº®æŒ‡å®šäººç‰©
        function highlightPersonFromUrl() {
            const personName = getUrlParameter('person');
            if (personName) {
                console.log(`ğŸ” æŸ¥æ‰¾äººç‰©: ${decodeURIComponent(personName)}`);
                
                // å»¶è¿Ÿæ‰§è¡Œï¼Œç¡®ä¿ç½‘ç»œå›¾å·²ç»æ¸²æŸ“å®Œæˆ
                setTimeout(() => {
                    const decodedPerson = decodeURIComponent(personName);
                    const foundNode = networkData.nodes.find(n => 
                        n.name === decodedPerson || n.name.includes(decodedPerson)
                    );
                    
                    if (foundNode) {
                        console.log(`âœ… æ‰¾åˆ°äººç‰©: ${foundNode.name}`);
                        
                        // ç¼©æ”¾åˆ°èŠ‚ç‚¹
                        const transform = d3.zoomIdentity
                            .translate(width / 2 - foundNode.x, height / 2 - foundNode.y)
                            .scale(2.5);
                        
                        svg.transition()
                            .duration(750)
                            .call(d3.zoom().transform, transform);
                        
                        // é«˜äº®èŠ‚ç‚¹
                        g.selectAll(".node circle")
                            .style("opacity", d => d.id === foundNode.id ? 1 : 0.2)
                            .style("stroke-width", d => d.id === foundNode.id ? 5 : 2);
                        
                        g.selectAll(".node text")
                            .style("opacity", d => d.id === foundNode.id ? 1 : 0.2);
                        
                        g.selectAll(".link")
                            .style("opacity", 0.1);
                        
                        // æ˜¾ç¤ºäººç‰©å¡ç‰‡
                        showBioSidebar(foundNode);
                        
                        // æ›´æ–°é¡µé¢æ ‡é¢˜
                        document.querySelector('.main-title').textContent = `é²è¿…çš„äººæƒ…ç½—ç½‘ - ${foundNode.name}`;
                        document.querySelector('.subtitle').textContent = `ä»ä¸»å›¾è·³è½¬æŸ¥çœ‹ ${foundNode.name} çš„ç¤¾äº¤å…³ç³»`;
                        
                    } else {
                        console.warn(`âš ï¸ æœªæ‰¾åˆ°äººç‰©: ${decodedPerson}`);
                        // æ˜¾ç¤ºæç¤ºä¿¡æ¯
                        const alertDiv = document.createElement('div');
                        alertDiv.style.cssText = `
                            position: fixed;
                            top: 80px;
                            left: 50%;
                            transform: translateX(-50%);
                            background: rgba(245, 241, 232, 0.96);
                            border: 2px solid #e74c3c;
                            border-radius: 8px;
                            padding: 15px 20px;
                            box-shadow: 0 4px 15px rgba(0,0,0,0.15);
                            z-index: 1000;
                            color: #5D4E37;
                            font-family: 'SimSun', serif;
                            max-width: 400px;
                            text-align: center;
                        `;
                        alertDiv.innerHTML = `
                            <strong style="color: #e74c3c;">æœªæ‰¾åˆ°äººç‰©</strong><br>
                            æœªåœ¨å…³ç³»ç½‘ç»œä¸­æ‰¾åˆ°"${decodedPerson}"ï¼Œè¯·æ£€æŸ¥äººç‰©åç§°æ˜¯å¦æ­£ç¡®ã€‚
                            <br><br>
                            <small>æç¤ºï¼šéƒ¨åˆ†äººç‰©å¯èƒ½æœ‰åˆ«åæˆ–ä¸åŒç§°è°“ã€‚</small>
                        `;
                        document.body.appendChild(alertDiv);
                        
                        // 3ç§’åè‡ªåŠ¨ç§»é™¤æç¤º
                        setTimeout(() => {
                            if (alertDiv.parentNode) {
                                alertDiv.parentNode.removeChild(alertDiv);
                            }
                        }, 5000);
                    }
                }, 1000);
            }
        }

        // å¯åŠ¨åº”ç”¨
        init();
        
        // é¡µé¢åŠ è½½å®Œæˆåæ£€æŸ¥URLå‚æ•°
        highlightPersonFromUrl();
        
        // åˆå§‹åŒ–å›¾ä¾‹ç‚¹å‡»çŠ¶æ€
        updateLegendState();
        
        // æ·»åŠ è¿”å›ä¸»å›¾çš„é“¾æ¥åŠŸèƒ½
        window.addEventListener('keydown', function(event) {
            if (event.key === 'Escape') {
                // ESCé”®è¿”å›ä¸»å›¾
                window.close(); // å¦‚æœæ˜¯å¼¹çª—
                // æˆ–è€…è·³è½¬å›ä¸»å›¾
                // window.location.href = 'ä¸»å›¾.html';
            }
        });
    </script>
</body>
</html>