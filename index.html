<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é²è¿…åœ¨åŒ—äº¬ - 1920å¹´ä»£åŒ—äº¬å†å²åœ°ç‚¹äº¤äº’å¼åœ°å›¾</title>
    <link rel="icon" href="./background.jpg" type="image/jpeg">
    
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <script src="https://d3js.org/d3.v7.min.js"></script>
  <script src="./network-module.js" defer></script>

    <style>
        * {
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Microsoft YaHei', 'å¾®è½¯é›…é»‘', 'SimSun', 'å®‹ä½“', 'Arial Unicode MS', 'DejaVu Sans', sans-serif;
            margin: 0;
            padding: 0;
            min-height: 100vh;
            /* å¼ºåˆ¶ä¸­æ–‡å­—ä½“æ¸²æŸ“ */
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            text-rendering: optimizeLegibility;

            /* ä¼˜å…ˆæ˜¾ç¤ºç”¨æˆ·æä¾›çš„èƒŒæ™¯å›¾ç‰‡ï¼Œä½¿ç”¨ç›¸å¯¹è·¯å¾„å¹¶æ”¾åœ¨æœ€ä¸Šå±‚ä»¥ä¿è¯å¯è§æ€§ */
            background-image: 
                /* å®é™…èƒŒæ™¯å›¾ï¼šè€åŒ—äº¬ä¹¦å·æ„è±¡ï¼ˆæ”¾åœ¨æœ€ä¸Šå±‚ï¼‰ */
                url("./background.jpg"),
                /* è½»å¾®çº¸å¼ é«˜å…‰ä¸æš—è§’å åŠ å±‚ */
                linear-gradient(180deg, rgba(255,253,248,0.12), rgba(0,0,0,0.04)),
                /* ç»†è…»å™ªç‚¹çº¹ç†ï¼Œå¢å¼ºçº¸å¼ è´¨æ„Ÿï¼ˆçº¯CSSï¼Œæ— å¤–éƒ¨å›¾ç‰‡ï¼‰ */
                radial-gradient(circle at 20px 30px, rgba(0,0,0,0.03) 1px, transparent 2px),
                radial-gradient(circle at 80px 90px, rgba(139,125,107,0.02) 1px, transparent 2px);
            /* æ¯å±‚çš„é‡å¤ä¸å°ºå¯¸è®¾ç½®ï¼ˆå¯¹åº”ä¸Šé¢çš„å›¾å±‚é¡ºåºï¼‰ */
            background-repeat: no-repeat, no-repeat, repeat, repeat;
            background-position: center top, center top, 0 0, 0 0;
            background-size: cover, cover, 140px 140px, 140px 140px;
            background-attachment: fixed, fixed, scroll, scroll;
            background-blend-mode: normal, overlay, normal, normal;

            /* å…¼å®¹æ€§å›é€€è‰² */
            background-color: #C2B68D;
        }

        .header {
            background: transparent;
            padding: 24px 20px;
            text-align: center;
            box-shadow: none;
            backdrop-filter: none;
            border-bottom: 2px solid #8B7D6B;
        }

        .header h1 {
            margin: 0;
            color: #5D4E37;
            font-size: 28px;
            font-weight: 600;
            font-family: 'SimSun', 'å®‹ä½“', serif;
        }

        .header p {
            margin: 10px 0 0 0;
            color: #8B7D6B;
            font-size: 14px;
            font-family: 'Kaiti', 'æ¥·ä½“', serif;
        }

        .container {
            display: flex;
            max-width: 1400px;
            margin: 20px auto;
            gap: 20px;
            padding: 0 20px;
            background: transparent;
        }

        .sidebar {
            width: 280px;
            background: rgba(245, 241, 232, 0.96);
            border-radius: 8px;
            padding: 20px;
            box-shadow: 5px 5px 10px rgba(0, 0, 0, 0.15);
            backdrop-filter: blur(8px);
            max-height: 80vh;
            overflow-y: auto;
            transition: all 0.3s ease;
            border: 1px solid rgba(139, 125, 107, 0.2);
        }

        .sidebar.collapsed {
            width: 0;
            padding: 0;
            overflow: hidden;
        }

        .toggle-btn {
            position: absolute;
            left: 20px;
            top: 50%;
            transform: translateY(-50%);
            background: #3498db;
            color: white;
            border: none;
            padding: 10px;
            border-radius: 0 8px 8px 0;
            cursor: pointer;
            z-index: 1000;
            transition: all 0.3s ease;
        }

        .toggle-btn:hover {
            background: #2980b9;
        }

        .toggle-btn.collapsed {
            left: 300px;
        }

        .category-section {
            margin-bottom: 25px;
        }

        .category-title {
            font-size: 15px;
            font-weight: 600;
            color: #5D4E37;
            margin-bottom: 10px;
            padding: 8px 10px;
            background: transparent;
            border-bottom: 1px dashed #C9A961;
            border-radius: 0;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-family: 'SimSun', serif;
        }

        .category-title:hover {
            background: rgba(201, 169, 97, 0.08);
            border-bottom-color: #C9A961;
        }

        .category-title.active {
            background: transparent;
            color: #C9A961;
            border-left: 3px solid #C9A961;
            padding-left: 12px;
            border-bottom: none;
        }

        .category-count {
            background: rgba(255, 255, 255, 0.3);
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 12px;
        }

        .location-list {
            list-style: none;
            padding: 0;
            margin: 0;
            max-height: 300px;
            overflow-y: auto;
        }

        .location-item {
            padding: 8px 10px;
            margin: 4px 0;
            background: transparent;
            border-left: none;
            border-radius: 0;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 13px;
            border-left: 3px solid transparent;
            color: #5D4E37;
            font-family: 'SimSun', serif;
        }

        .location-item:hover {
            background: rgba(201, 169, 97, 0.08);
            border-left-color: #C9A961;
            color: #C9A961;
        }

        .location-item.active {
            background: transparent;
            color: #C9A961;
            border-left-color: #C9A961;
            font-weight: bold;
        }

        .map-container {
            flex: 1;
            background: linear-gradient(135deg, #F5F1E8 0%, #F9F5ED 100%);
            border-radius: 4px;
            overflow: hidden;
            box-shadow: inset 0 1px 0 rgba(255,255,255,0.5), 8px 8px 16px rgba(0,0,0,0.15), 0 0 0 1px rgba(139,125,107,0.4);
            position: relative;
            border: 3px solid #8B7D6B;
            background-image: 
                linear-gradient(45deg, transparent 48%, rgba(139,125,107,0.02) 49%, rgba(139,125,107,0.02) 51%, transparent 52%),
                linear-gradient(-45deg, transparent 48%, rgba(139,125,107,0.02) 49%, rgba(139,125,107,0.02) 51%, transparent 52%);
            background-size: 30px 30px;
            background-position: 0 0, 15px 15px;
        }

        .map-container::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            border: 8px solid transparent;
            border-image: linear-gradient(45deg, #8B7D6B 0%, #C9A961 25%, #8B7D6B 50%, #C9A961 75%, #8B7D6B 100%) 1;
            pointer-events: none;
            z-index: 1;
        }

        .map-container::after {
            content: '';
            position: absolute;
            top: 12px;
            left: 12px;
            right: 12px;
            bottom: 12px;
            border: 1px dashed rgba(201,169,97,0.3);
            pointer-events: none;
            z-index: 3;
        }

        #map {
            width: 100%;
            height: 80vh;
            position: relative;
            z-index: 0;
        }

        .stats {
            position: absolute;
            top: 20px;
            right: 20px;
            background: rgba(245, 241, 232, 0.96);
            padding: 14px 16px;
            border-radius: 2px;
            box-shadow: 5px 5px 10px rgba(0,0,0,0.12), inset 0 1px 0 rgba(255,255,255,0.6);
            z-index: 1000;
            backdrop-filter: blur(8px);
            border: 2px solid #8B7D6B;
            font-family: 'SimSun', '\u5b8b\u4f53', serif;
        }

        .stats h4 {
            margin: 0 0 8px 0;
            color: #5D4E37;
            font-size: 13px;
            font-weight: bold;
            border-bottom: 1px solid #C9A961;
            padding-bottom: 6px;
        }

        .stats-item {
            display: flex;
            justify-content: space-between;
            margin: 6px 0;
            font-size: 12px;
        }

        .stats-label {
            color: #8B7D6B;
        }

        .stats-value {
            font-weight: 600;
            color: #C9A961;
        }

        /* å¼¹çª— (Modal) æ ·å¼ */
        .modal {
            display: none;
            position: fixed;
            z-index: 10000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(10px);
        }

        .modal-content {
            background-color: #fefefe;
            margin: 3% auto;
            padding: 25px;
            border: none;
            width: 95%;
            max-width: 800px;
            max-height: 90vh;
            border-radius: 16px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            animation: slideUp 0.3s ease-out;
            position: relative;
            overflow-y: auto;
        }

        @keyframes slideUp {
            from { opacity: 0; transform: translateY(50px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .close {
            position: sticky;
            right: 20px;
            top: 20px;
            color: #95a5a6;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
            transition: color 0.3s ease;
            z-index: 10;
            background: rgba(255, 255, 255, 0.9);
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        .close:hover {
            color: #e74c3c;
            background: white;
        }

        .modal-header {
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #ecf0f1;
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            padding: 20px;
            margin: -25px -25px 20px -25px;
            border-radius: 16px 16px 0 0;
        }

        .modal-title {
            margin: 0;
            color: #5D4E37;
            font-size: 26px;
            font-weight: 600;
            font-family: 'SimSun', 'å®‹ä½“', serif;
        }

        .modal-category {
            display: inline-block;
            background: transparent;
            color: #C9A961;
            padding: 4px 10px;
            border-radius: 0;
            border: 1px solid #C9A961;
            font-size: 12px;
            margin-top: 10px;
            font-weight: 500;
        }

        .detail-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .detail-item {
            margin-bottom: 15px;
            padding: 12px;
            background: rgba(255, 255, 255, 0.8);
            border-radius: 4px;
            border-left: none;
            border: none;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .detail-item:hover {
            transform: none;
            box-shadow: none;
            background: #ffffff;
        }

        .detail-item.primary {
            border-left-color: transparent;
            background: rgba(255, 255, 255, 0.8);
        }

        .detail-item.secondary {
            border-left-color: transparent;
            background: rgba(255, 255, 255, 0.8);
        }

        .detail-item strong {
            display: block;
            color: #C9A961;
            font-family: 'Kaiti', 'æ¥·ä½“', serif;
            font-size: 15px;
            margin-bottom: 6px;
            text-transform: none;
            letter-spacing: normal;
            font-weight: 600;
        }

        .detail-item p {
            margin: 0;
            color: #333;
            line-height: 1.8;
            font-size: 14px;
            word-wrap: break-word;
            font-family: 'SimSun', 'å®‹ä½“', serif;
        }
        
        .person-link {
            color: #C9A961;
            text-decoration: none;
            border-bottom: 1px dashed #C9A961;
            transition: all 0.3s ease;
            cursor: pointer;
            background: rgba(201, 169, 97, 0.05);
            padding: 2px 4px;
            border-radius: 3px;
            margin: 0 2px;
        }
        
        .person-link:hover {
            color: #8B7D6B;
            background: rgba(201, 169, 97, 0.15);
            border-bottom-color: #8B7D6B;
            transform: translateY(-1px);
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .detail-item .coordinate-info {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .detail-item .coordinate-info span {
            background: rgba(201, 169, 97, 0.08);
            padding: 4px 8px;
            border-radius: 2px;
            border: 1px solid #C9A961;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            color: #5D4E37;
        }

        /* è‡ªå®šä¹‰Markerå›¾æ ‡æ ·å¼ï¼ˆæ°‘å›½æ—§ç‰©ï¼‰ */
        .custom-marker {
            background-color: #C9A961;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            border: 2px solid #fff;
            box-shadow: 4px 4px 0 rgba(0,0,0,0.12);
            cursor: pointer;
            transition: all 0.3s ease;
            opacity: 0.85;
            mix-blend-mode: multiply;
        }

        .custom-marker:hover {
            transform: scale(1.3);
            background-color: #B8945A;
            opacity: 1;
        }

        .custom-marker.active {
            background-color: #8B7D6B;
            box-shadow: 4px 4px 0 rgba(0,0,0,0.18);
        }

        .category-marker-å±…ä½åœ° { background-color: #B44C43; } /* æœ±çº¢ */
        .category-marker-å·¥ä½œåœ° { background-color: #4A5D75; } /* é›è“ */
        .category-marker-æ•™ä¹¦åœ° { background-color: #5F7156; } /* ç«¹é’ */
        .category-marker-é¤é¥®åœ° { background-color: #D9A033; } /* è—¤é»„ */
        .category-marker-è´­ç‰©åœ° { background-color: #9B5F90; } /* ç´«æª€ */
        .category-marker-é£æ™¯åèƒœ { background-color: #7DAE8A; } /* æ¾çŸ³ */
        .category-marker-ä¼šé¦† { background-color: #6B5746; } /* å¤æœ¨ */
        .category-marker-åŒ»é™¢ { background-color: #C56A2A; } /* å¤é“œ */
        .category-marker-é¿éš¾æ‰€ { background-color: #8B7D6B; } /* çŸ³å¢¨ç° */
        .category-marker-æ‚å¿—ç¤¾ { background-color: #A57C52; } /* æ—§é‡‘ */
        .category-marker-å½±å‰§é™¢ { background-color: #8E44AD; } /* æš—ç´« */

        .legend {
            position: absolute;
            bottom: 20px;
            left: 20px;
            background: rgba(245, 241, 232, 0.96);
            padding: 12px 14px;
            border-radius: 2px;
            box-shadow: 5px 5px 10px rgba(0,0,0,0.12), inset 0 1px 0 rgba(255,255,255,0.6);
            z-index: 1000;
            backdrop-filter: blur(8px);
            font-size: 12px;
            border: 2px solid #8B7D6B;
            font-family: 'SimSun', 'å®‹ä½“', serif;
            color: #5D4E37;
            max-width: 220px;
            max-height: 320px;
            overflow-y: auto;
        }

        .legend h4 {
            margin: 0 0 8px 0;
            font-size: 12px;
            font-weight: bold;
            border-bottom: 1px solid #C9A961;
            padding-bottom: 6px;
            color: #5D4E37;
        }

        .legend-item {
            display: flex;
            align-items: center;
            margin: 6px 0;
            padding: 4px 6px;
            border-radius: 2px;
            cursor: pointer;
            transition: all 0.2s ease;
            user-select: none;
        }

        .legend-item:hover {
            background: rgba(201, 169, 97, 0.1);
        }

        .legend-item.disabled {
            opacity: 0.4;
        }

        .legend-marker {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 8px;
            border: 1px solid #fff;
            box-shadow: 1px 1px 2px rgba(0,0,0,0.1);
            flex-shrink: 0;
        }

        .search-box {
            width: 100%;
            padding: 12px;
            border: 2px solid #ecf0f1;
            border-radius: 8px;
            font-size: 14px;
            margin-bottom: 20px;
            transition: border-color 0.3s ease;
        }

        .search-box:focus {
            outline: none;
            border-color: #3498db;
        }

        .loading {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 200px;
            font-size: 16px;
            color: #7f8c8d;
        }

        @media (max-width: 768px) {
            .container {
                flex-direction: column;
                padding: 10px;
            }
            
            .sidebar {
                width: 100%;
                max-height: none;
            }
            
            .toggle-btn {
                display: none;
            }
            
            .stats {
                position: static;
                margin-bottom: 10px;
            }
            
            .modal-content {
                width: 98%;
                margin: 2% auto;
                padding: 20px;
                max-height: 95vh;
            }
            
            .modal-title {
                font-size: 20px;
            }
            
            .modal-header {
                padding: 15px;
                margin: -20px -20px 15px -20px;
            }
            
            .close {
                right: 15px;
                top: 15px;
                width: 35px;
                height: 35px;
                font-size: 24px;
            }
            
            .detail-grid {
                grid-template-columns: 1fr;
                gap: 12px;
            }
            
            .detail-item {
                padding: 15px;
                margin-bottom: 12px;
            }
            
            .detail-item strong {
                font-size: 13px;
            }
            
            .detail-item p {
                font-size: 13px;
            }
            
            .detail-item .coordinate-info {
                flex-direction: column;
                gap: 8px;
            }
            
            .modal-category {
                font-size: 11px;
                padding: 4px 10px;
            }
        }

        @media (max-width: 480px) {
            .modal-content {
                padding: 15px;
                margin: 1% auto;
                border-radius: 12px;
            }
            
            .modal-header {
                padding: 12px;
                margin: -15px -15px 12px -15px;
            }
            
            .modal-title {
                font-size: 18px;
            }
            
            .detail-item {
                padding: 12px;
                margin-bottom: 10px;
            }
            
            .close {
                width: 30px;
                height: 30px;
                font-size: 20px;
                right: 10px;
                top: 10px;
            }
        }

        @media (max-width: 320px) {
            .modal-title {
                font-size: 16px;
            }
            
            .detail-item strong {
                font-size: 12px;
            }
            
            .detail-item p {
                font-size: 12px;
            }
        }

        /* -------------------------
           æ°‘å›½æ—§ç‰©é…è‰²ï¼ˆåœŸè¤+ç±³ç™½ï¼‰
           ------------------------- */
        :root{
            --bg: #A89968;         /* åœŸè¤æ¸å˜ */
            --card: #F5F1E8;       /* ç±³ç™½è‰² */
            --text-main: #5D4E37;  /* æ£•å¢¨ */
            --text-sub: #8B7D6B;   /* æ£•ç° */
            --accent: #C9A961;     /* é»„è¤èµ·é¦™ */
            --surface: #F9F5ED;    /* çº¸å¼ æµ…è‰² */
            --round: 4px;
            --shadow: 5px 5px 0 rgba(0,0,0,0.08);
        }

        .header{
            background: rgba(245, 241, 232, 0.92);
            padding:24px 22px;
            border-bottom:2px solid #8B7D6B;
            box-shadow: 0 3px 8px rgba(0, 0, 0, 0.12);
        }

        .header h1{ 
            margin:0; 
            font-size:28px; 
            font-weight:700; 
            color:#5D4E37;
            font-family: 'SimSun', 'å®‹ä½“', serif;
            letter-spacing: 2px;
        }

        .header p{ 
            margin:10px 0 0; 
            color:#8B7D6B; 
            font-size:13px;
            font-family: 'Kaiti', 'æ¥·ä½“', serif;
        }

        .container{
            display:flex;
            max-width:1200px;
            margin:18px auto;
            gap:18px;
            padding:0 14px;
        }

        /* ä¾§è¾¹æ  */
        .sidebar{
            background: rgba(245, 241, 232, 0.96);
            border-radius: 8px;
            padding:14px;
            box-shadow: 5px 5px 10px rgba(0,0,0,0.15);
            border: 1px solid rgba(139, 125, 107, 0.2);
            width: 300px;
            height: calc(100vh - 140px);
            overflow:auto;
            flex-shrink: 0;
        }

        .category-title{
            display:flex;
            justify-content:space-between;
            align-items:center;
            padding:8px 10px;
            border-bottom: 1px dashed #C9A961;
            border-radius:0;
            cursor:pointer;
            transition:all .18s ease;
            margin-bottom:8px;
            background:transparent;
            color: #5D4E37;
            font-family: 'SimSun', 'å®‹ä½“', serif;
            font-weight: 600;
        }

        .category-title:hover{ background: rgba(201, 169, 97, 0.08); }
        .category-title.active{ background:transparent; color:var(--accent); border-left:3px solid var(--accent); border-bottom: none; padding-left:12px; }

        .location-list{ margin:8px 0 16px 0; padding-left:0; }
        .location-item{ padding:6px 8px; border-radius:0; cursor:pointer; font-size:13px; color:#5D4E37; border-left:3px solid transparent; transition: all 0.3s ease; }
        .location-item:hover{ background: rgba(201, 169, 97, 0.08); border-left-color:var(--accent); color:var(--accent); }
        .location-item.active{ color:var(--accent); border-left-color:var(--accent); font-weight:bold; }

        /* åœ°å›¾å®¹å™¨ */
        #map{ 
            border-radius:4px;
            overflow:hidden;
            min-height:720px;
            box-shadow:var(--shadow);
            border:1px solid rgba(139, 125, 107, 0.2);
        }

        /* å›¾ä¾‹ & æ§ä»¶ */
        #legend{ background:var(--card); padding:12px; border-radius:4px; box-shadow: var(--shadow); border:1px solid rgba(139,125,107,0.2); }
        .legend-item{ display:flex; gap:8px; align-items:center; padding:6px 0; font-family:'SimSun', serif; color:#5D4E37; }
        .legend-marker{ width:14px; height:14px; border-radius:50%; box-shadow: 0 1px 2px rgba(0,0,0,0.06); }

        /* æŒ‰é’®æ ·å¼ç»Ÿä¸€ */
        .btn{ background:var(--accent); color:#fff; padding:8px 12px; border-radius:4px; border:none; cursor:pointer; font-weight:600; }

        /* æ¨¡æ€æ¡†ä¼˜åŒ– */
        .modal{ max-width:900px; border-radius:4px; overflow:hidden; box-shadow: 10px 10px 0 rgba(0,0,0,0.2); }
        .modal-content{ background: #FDFBF7; background-image: linear-gradient(#E8E8E8 1px, transparent 1px); background-size: 100% 30px; border:2px solid #5D4E37; padding:20px; position:relative; }
        .modal-title{ color:#5D4E37; font-weight:700; font-size:26px; font-family:'SimSun', serif; }
        .detail-grid{ display:grid; grid-template-columns: 1fr 1fr; gap:12px; }
        .detail-item{ background: rgba(255,255,255,0.86); padding:10px; border-radius:4px; }
        .detail-item strong{ color:var(--accent); font-family:'Kaiti', serif; font-size:15px; }

        /* ä¿¡ç¬ºä¸Šçš„å°ç«  */
        .modal-stamp{
            position:absolute;
            right:18px;
            top:18px;
            width:72px;
            height:72px;
            border-radius:50%;
            background: radial-gradient(circle at 30% 30%, rgba(201,169,97,0.95), rgba(201,169,97,0.85));
            color: #5D4E37;
            display:flex;
            align-items:center;
            justify-content:center;
            font-family: 'SimSun', serif;
            font-size:13px;
            font-weight:600;
            box-shadow: 5px 5px 8px rgba(0,0,0,0.15);
            opacity:0.9;
            transform: rotate(-8deg);
        }

        /* å›¾ç‰‡æ ·å¼ */
        .modal-image{
            width:100%;
            max-height:320px;
            object-fit:cover;
            border:1px solid #8B7D6B;
            display:block;
            margin:8px 0 12px 0;
            box-shadow: 4px 4px 0 rgba(0,0,0,0.08);
            border-radius: 2px;
        }

        /* ç­¾åæ ·å¼ */
        .modal-signature{
            display:block;
            text-align:right;
            font-family:'Kaiti', serif;
            color:var(--accent);
            margin-top:12px;
            font-size:15px;
        }
        .detail-item p{ font-family:'SimSun', serif; font-size:14px; color:#333; line-height:1.8; }

        /* è°ƒæ•´å°å±æ ·å¼ */
        @media (max-width: 900px){
            .container{ flex-direction:column; }
            #map{ min-height:520px; }
            .sidebar{ width:100%; height:auto; }
            .detail-grid{ grid-template-columns:1fr; }
        }

        /* åœ°ç‚¹æ ‡ç­¾æ ·å¼ï¼ˆç”¨äº Leaflet tooltipï¼‰ */
        .location-label {
            background-color: rgba(245, 241, 232, 0.98);
            border: 1px solid rgba(139, 125, 107, 0.3);
            border-radius: 4px;
            padding: 6px 10px;
            font-size: 12px;
            font-weight: 600;
            color: #5D4E37;
            white-space: nowrap;
            box-shadow: 5px 5px 0 rgba(0,0,0,0.08);
            font-family: 'SimSun', 'å®‹ä½“', serif;
        }

        .location-label::before{ display:none; }

        /* ===== ç¤¾äº¤ç½‘ç»œå…³ç³»å›¾æ ·å¼ ===== */
        .network-modal {
            display: none;
            position: fixed;
            z-index: 10001;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(4px);
        }

        .network-modal.show {
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .network-container {
            background: linear-gradient(135deg, #FFFCF8, #F5F1E8);
            border-radius: 4px;
            width: 92%;
            max-width: 1400px;
            height: 85vh;
            box-shadow: 0 20px 60px rgba(93, 78, 55, 0.3), inset 0 1px 0 rgba(255,255,255,0.6);
            display: grid;
            grid-template-columns: 1fr 320px;
            grid-template-rows: 60px 1fr;
            position: relative;
            border: 2px solid #C9A961;
            overflow: hidden;
        }

        .network-header {
            grid-column: 1 / -1;
            padding: 12px 24px;
            border-bottom: 2px dashed #C9A961;
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: linear-gradient(to right, #FFFCF8, #F5F1E8);
            z-index: 10;
            box-shadow: 0 2px 4px rgba(0,0,0,0.06);
        }

        .network-header h2 {
            margin: 0;
            color: #5D4E37;
            font-size: 20px;
            font-family: 'KaiTi', 'æ¥·ä½“', serif;
            font-weight: bold;
        }

        .network-close {
            background: none;
            border: none;
            color: #5D4E37;
            font-size: 28px;
            cursor: pointer;
            padding: 0;
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .network-close:hover {
            color: #C9A961;
        }

        #network-graph {
            grid-column: 1;
            grid-row: 2;
            background: linear-gradient(135deg, rgba(255,253,248,0.9), rgba(245,241,232,0.8));
            position: relative;
            overflow: hidden;
            border-right: 2px solid #E0E0E0;
            margin-top: 100px;
        }

        /* ç½‘ç»œæ§åˆ¶é¢æ¿ï¼ˆå¹´ä»½+åˆ†ç±»ï¼‰ */
        .network-controls {
            grid-column: 1;
            grid-row: 2;
            position: absolute;
            top: 60px;
            left: 0;
            right: 320px;
            height: auto;
            background: linear-gradient(to bottom, rgba(245,241,232,0.95), transparent);
            padding: 12px 16px;
            border-bottom: 1px solid #E0E0E0;
            z-index: 5;
        }

        .controls-row {
            display: flex;
            gap: 20px;
            align-items: flex-start;
        }

        .filter-box, .timeline-box {
            font-size: 13px;
        }

        .filter-box h4, .timeline-box h4 {
            margin: 0 0 8px 0;
            color: #5D4E37;
            font-weight: bold;
            font-size: 13px;
        }

        .filter-buttons {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
        }

        .filter-btn {
            padding: 6px 12px;
            background: #F5F1E8;
            border: 1px solid #C9A961;
            color: #5D4E37;
            border-radius: 3px;
            cursor: pointer;
            font-size: 12px;
            transition: all 0.2s;
        }

        .filter-btn.active {
            background: #C9A961;
            color: #FFFCF8;
            font-weight: bold;
        }

        .filter-btn:hover {
            background: #D4AF7A;
        }

        .year-slider {
            width: 200px;
            height: 6px;
            accent-color: #C9A961;
        }

        .year-label {
            color: #C9A961;
            font-weight: bold;
        }

        /* å³ä¾§äººç‰©ä¾§è¾¹æ  */
        .network-sidebar {
            grid-column: 2;
            grid-row: 2;
            background: linear-gradient(to bottom, #FFFCF8, #F9F5ED);
            border-left: 2px solid #E0E0E0;
            overflow-y: auto;
            padding: 16px 12px;
            font-size: 13px;
            box-shadow: inset 2px 0 4px rgba(0,0,0,0.03);
        }

        .sidebar-empty {
            display: flex;
            align-items: center;
            justify-content: center;
            height: 100%;
            color: #999;
            text-align: center;
            font-size: 12px;
        }

        .sidebar-title {
            font-size: 15px;
            font-weight: bold;
            color: #5D4E37;
            margin-bottom: 10px;
            padding-bottom: 8px;
            border-bottom: 2px solid #C9A961;
            word-wrap: break-word;
        }

        .sidebar-meta {
            background: #F5F1E8;
            padding: 8px;
            border-radius: 3px;
            margin-bottom: 12px;
            font-size: 12px;
            color: #5D4E37;
        }

        .sidebar-meta p {
            margin: 4px 0;
        }

        .sidebar-section {
            margin-top: 12px;
        }

        .sidebar-section h4 {
            margin: 0 0 8px 0;
            color: #5D4E37;
            font-size: 12px;
            font-weight: bold;
        }

        .event-record {
            background: #FFF8F0;
            padding: 6px;
            border-left: 2px solid #C9A961;
            margin-bottom: 6px;
            border-radius: 2px;
            font-size: 11px;
        }

        .event-time {
            color: #C9A961;
            font-weight: bold;
            font-size: 10px;
        }

        .event-desc {
            color: #5D4E37;
            margin-top: 2px;
            line-height: 1.3;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .legend-color {
            width: 14px;
            height: 14px;
            border-radius: 50%;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .network-close {
            background: none;
            border: none;
            font-size: 28px;
            color: #5D4E37;
            cursor: pointer;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }

        .network-close:hover {
            color: #e74c3c;
            transform: scale(1.1);
        }

        .network-legend {
            padding: 10px 20px;
            border-top: 1px solid #e0e0e0;
            font-size: 12px;
            background: #F9F5ED;
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
            color: #5D4E37;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .legend-color {
            width: 12px;
            height: 12px;
            border-radius: 50%;
        }

        /* D3ç½‘ç»œå›¾èŠ‚ç‚¹å’Œé“¾æ¥æ ·å¼ */
        .node {
            cursor: pointer;
            stroke: #fff;
            stroke-width: 2px;
        }

        .node:hover {
            stroke: #C9A961;
            stroke-width: 3px;
        }

        .link {
            stroke: #999;
            stroke-opacity: 0.6;
            stroke-width: 1.5px;
        }

        .node-label {
            font-size: 11px;
            font-family: 'SimSun', 'å®‹ä½“', serif;
            text-anchor: middle;
            fill: #333;
            pointer-events: none;
        }

        .tooltip-network {
            position: absolute;
            background: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 8px 12px;
            border-radius: 4px;
            font-size: 12px;
            font-family: 'SimSun', 'å®‹ä½“', serif;
            pointer-events: none;
            z-index: 10002;
            max-width: 200px;
            word-wrap: break-word;
            display: none;
        }

        .btn-network {
            background: #C9A961;
            color: #fff;
            padding: 8px 16px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 13px;
            font-family: 'SimSun', 'å®‹ä½“', serif;
            transition: all 0.3s ease;
            margin-top: 10px;
        }

        .btn-network:hover {
            background: #B8934D;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }

        /* å†…è”ç½‘ç»œå›¾æ ·å¼ */
        .inline-network-container {
            background: linear-gradient(135deg, #F5F1E8 0%, #F9F5ED 100%);
            border: 2px solid #8B7D6B;
            border-radius: 6px;
            padding: 15px;
            margin: 10px 0;
            position: relative;
            min-height: 400px;
        }

        .network-info-panel {
            background: white;
            border: 1px solid #E0E0E0;
            border-radius: 4px;
            padding: 12px;
            margin: 10px 0;
            max-height: 150px;
            overflow-y: auto;
            display: none;
            position: absolute;
            z-index: 100;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }

        .network-info-panel.show {
            display: block;
        }

        .network-info-title {
            font-weight: bold;
            color: #C9A961;
            font-size: 14px;
            margin-bottom: 8px;
        }

        .network-info-content {
            font-size: 12px;
            color: #5D4E37;
            line-height: 1.6;
        }

        .network-info-content p {
            margin: 4px 0;
        }

        .inline-legend {
            display: flex;
            gap: 12px;
            flex-wrap: wrap;
            margin: 10px 0;
            justify-content: center;
        }

        .legend-btn {
            padding: 6px 12px;
            border: 2px solid;
            border-radius: 20px;
            cursor: pointer;
            font-size: 12px;
            font-family: 'SimSun', 'å®‹ä½“', serif;
            transition: all 0.3s ease;
            background: white;
        }

        .legend-btn.active {
            opacity: 1;
            font-weight: bold;
            transform: scale(1.05);
        }

        .legend-btn:not(.active) {
            opacity: 0.6;
        }

        .legend-btn:hover {
            opacity: 1;
        }

        .relation-label {
            font-size: 11px;
            text-anchor: middle;
            fill: white;
            pointer-events: none;
            font-weight: bold;
            font-family: 'SimSun', 'å®‹ä½“', serif;
        }

        .node-tooltip-inline {
            position: absolute;
            background: rgba(0, 0, 0, 0.9);
            color: white;
            padding: 10px;
            border-radius: 4px;
            font-size: 11px;
            font-family: 'SimSun', 'å®‹ä½“', serif;
            z-index: 200;
            pointer-events: none;
            max-width: 250px;
            word-wrap: break-word;
            display: none;
        }

        .node-tooltip-inline.show {
            display: block;
        }
    </style>
</head>
<body>

    <div class="header">
        <h1>ğŸ—ºï¸ é²è¿…åœ¨åŒ—äº¬ - 1920å¹´ä»£åŒ—äº¬å†å²åœ°ç‚¹äº¤äº’å¼åœ°å›¾</h1>
        <p>æ¢ç´¢é²è¿…åœ¨åŒ—äº¬çš„ç”Ÿæ´»è½¨è¿¹ï¼Œæ„Ÿå—å†å²æ–‡åŒ–çš„æ·±åšåº•è•´</p>
        <div id="serverAlert" style="background: #fff3cd; color: #856404; padding: 8px 12px; border-radius: 4px; margin: 10px 0; display: none; font-size: 14px;">
            âš ï¸ å½“å‰ä½¿ç”¨æ–‡ä»¶åè®®è¿è¡Œï¼Œå»ºè®®ä½¿ç”¨HTTPæœåŠ¡å™¨ä»¥è·å¾—å®Œæ•´åŠŸèƒ½
        </div>
    </div>

    <div class="container">
        <button class="toggle-btn" id="toggleSidebar">â˜°</button>
        
        <div class="sidebar" id="sidebar">
            <input type="text" class="search-box" id="searchBox" placeholder="ğŸ” æœç´¢åœ°ç‚¹...">
            
            <div id="categoryMenu"></div>
        </div>

        <div class="map-container">
            <div class="stats" id="stats">
                <h4>ğŸ“Š ç»Ÿè®¡ä¿¡æ¯</h4>
                <div class="stats-item">
                    <span class="stats-label">æ€»åœ°ç‚¹æ•°ï¼š</span>
                    <span class="stats-value" id="totalLocations">0</span>
                </div>
                <div class="stats-item">
                    <span class="stats-label">å·²æ ‡æ³¨ï¼š</span>
                    <span class="stats-value" id="markedLocations">0</span>
                </div>
                <div class="stats-item">
                    <span class="stats-label">å½“å‰åˆ†ç±»ï¼š</span>
                    <span class="stats-value" id="currentCategory">å…¨éƒ¨</span>
                </div>
            </div>
            
            <div id="map"></div>
            
            <div class="legend" id="legend"></div>
        </div>
    </div>

    <div id="locationModal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <div class="modal-header">
                <h2 class="modal-title" id="modalTitle"></h2>
                <span class="modal-category" id="modalCategory"></span>
            </div>
            <div id="modal-body" class="modal-body"></div>
        </div>
    </div>

    <!-- ç¤¾äº¤ç½‘ç»œå…³ç³»å›¾æ¨¡æ€æ¡†ï¼ˆæ–° Force Layout + ä¾§è¾¹æ è®¾è®¡ï¼‰ -->
    <div id="networkModal" class="network-modal">
        <div class="network-container">
            <div class="network-header">
                <h2 id="networkTitle">é²è¿…çš„äººæƒ…ç½—ç½‘</h2>
                <button class="network-close" onclick="closeNetworkModal()">&times;</button>
            </div>
            <!-- æ§åˆ¶é¢æ¿ï¼ˆå¹´ä»½æ»‘å—+åˆ†ç±»ç­›é€‰ï¼‰ä¼šåŠ¨æ€æ’å…¥è¿™é‡Œ -->
            <div id="networkControls"></div>
            <svg id="network-graph"></svg>
            <!-- å³ä¾§äººç‰©è¯¦æƒ…ä¾§è¾¹æ  -->
            <div class="network-sidebar" id="sidebarPersonal">
                <div class="sidebar-empty">ç‚¹å‡»äººç‰©æˆ–è¿çº¿æŸ¥çœ‹è¯¦æƒ…</div>
            </div>
            <!-- ç½‘ç»œå›¾ä¾‹ -->
            <div class="network-legend" id="networkLegend"></div>
        </div>
    </div>

   <script>
    // å…¨å±€å˜é‡
    let map;
    let locationData = [];
    let markers = [];
    let currentFilter = 'å…¨éƒ¨';
    let imageBounds;

    const IMAGE_URL = 'map_pekin1920_full.jpg';

    // ç±»åˆ«é¢œè‰²é…ç½®
    const CATEGORY_COLORS = {
        'å±…ä½åœ°': '#e74c3c',
        'å·¥ä½œåœ°': '#3498db',
        'æ•™ä¹¦åœ°': '#2ecc71',
        'é¤é¥®åœ°': '#f39c12',
        'è´­ç‰©åœ°': '#9b59b6',
        'é£æ™¯åèƒœ': '#1abc9c',
        'ä¼šé¦†': '#34495e',
        'åŒ»é™¢': '#e67e22',
        'é¿éš¾æ‰€': '#95a5a6',
        'æ‚å¿—ç¤¾': '#16a085',
        'å½±å‰§é™¢': '#8e44ad'
    };

    // *** 1. æ•°æ®å¤„ç†å‡½æ•° ***
    
    function extractMainActivity(fullText) {
        const match = fullText.match(/ä¸»è¦æ´»åŠ¨ï¼š(.+?)(ç›¸å…³äººç‰©ï¼š|ç°çŠ¶è¯´æ˜ï¼š|$)/s);
        if (match && match[1]) {
            return match[1].trim().replace(/<br>/g, '\n').replace(/\\n/g, '\n');
        }
        return 'æš‚æ— è¯¦ç»†æ´»åŠ¨è®°è½½ã€‚';
    }
    
    function extractRelatedPeople(fullText) {
        const match = fullText.match(/ç›¸å…³äººç‰©ï¼š(.+?)(ç°çŠ¶è¯´æ˜ï¼š|$)/s);
        if (match && match[1]) {
            const text = match[1].trim().replace(/<br>/g, '').replace(/\\n/g, '').replace(/,\s*/g, 'ã€');
            if (text === "æ— ç›´æ¥å…³è”äººç‰©è®°è½½") {
                return "æ— ";
            }
            
            // å°†äººç‰©åç§°åˆ†å‰²å¹¶åˆ›å»ºå¯ç‚¹å‡»é“¾æ¥
            const people = text.split(/ã€|ï¼Œ|,/).filter(p => p.trim());
            const peopleLinks = people.map(person => {
                const personName = person.trim();
                return `<a href="relationship-network.html?person=${encodeURIComponent(personName)}" 
                        class="person-link" 
                        target="_blank" 
                        title="ç‚¹å‡»æŸ¥çœ‹${personName}åœ¨å…³ç³»ç½‘ç»œä¸­çš„è¯¦æƒ…">${personName}</a>`;
            }).join('ã€');
            
            return peopleLinks;
        }
        return 'æ— ';
    }

    function extractStatus(fullText) {
        const match = fullText.match(/ç°çŠ¶è¯´æ˜ï¼š(.+?)$/s);
        if (match && match[1]) {
            return match[1].trim().replace(/<br>/g, '\n').replace(/\\n/g, '\n');
        }
        return 'æš‚æ— è¯´æ˜ã€‚';
    }

    function parseCSV(csvText) {
        // ç¡®ä¿æ–‡æœ¬ç¼–ç æ­£ç¡®ï¼Œå¤„ç†å¯èƒ½çš„ç¼–ç é—®é¢˜
        try {
            // ç§»é™¤ BOM æ ‡è®°ï¼ˆå¦‚æœå­˜åœ¨ï¼‰- è§£å†³ä¸­æ–‡æ˜¾ç¤ºä¸ºç¬¦å·çš„é—®é¢˜
            if (csvText.charCodeAt(0) === 0xFEFF) {
                csvText = csvText.slice(1);
                console.log('âœ… å·²æ£€æµ‹å¹¶ç§»é™¤ UTF-8 BOM æ ‡è®°');
            }
            
            // ç»Ÿä¸€æ¢è¡Œç¬¦å¹¶åˆ†å‰²
            const lines = csvText.trim().split(/\r?\n/);
            if (lines.length === 0) return [];
            
            const headers = lines[0].split(',');
            console.log(`ğŸ“‹ CSVè¡¨å¤´: ${headers.join(', ')}`);
            
            const data = [];
            for (let i = 1; i < lines.length; i++) {
                if (!lines[i].trim()) continue; // è·³è¿‡ç©ºè¡Œ
                
                // å¤„ç†å¯èƒ½åŒ…å«é€—å·å’Œå¼•å·çš„å¤æ‚å­—æ®µ
                const values = [];
                let current = '';
                let inQuotes = false;
                let charIndex = 0;
                
                while (charIndex < lines[i].length) {
                    const char = lines[i][charIndex];
                    
                    if (char === '"') {
                        // å¤„ç†åŒå¼•å·è½¬ä¹‰
                        if (charIndex + 1 < lines[i].length && lines[i][charIndex + 1] === '"') {
                            current += '"';
                            charIndex += 2;
                        } else {
                            inQuotes = !inQuotes;
                            charIndex++;
                        }
                    } else if (char === ',' && !inQuotes) {
                        values.push(current.trim());
                        current = '';
                        charIndex++;
                    } else {
                        current += char;
                        charIndex++;
                    }
                }
                values.push(current.trim());
                
                if (values.length >= headers.length) {
                    const row = {};
                    headers.forEach((header, index) => {
                        // æ¸…ç†å­—æ®µå†…å®¹ï¼Œå¤„ç†HTMLæ ‡ç­¾å’Œç‰¹æ®Šå­—ç¬¦
                        let value = values[index] || '';
                        // ç§»é™¤å¯èƒ½çš„BOMæ ‡è®°
                        value = value.replace(/^\uFEFF/, '');
                        // ç¡®ä¿ä¸­æ–‡å­—ç¬¦æ­£ç¡®æ˜¾ç¤º
                        row[header.trim()] = value;
                    });
                    
                    // ç¡®ä¿Yå’ŒXåæ ‡æ˜¯æœ‰æ•ˆçš„æ•°å­—ä¸”ä¸ä¸ºç©º
                    if (row.Y && row.X && row.name) {
                        row.Y = String(row.Y).trim();
                        row.X = String(row.X).trim();
                        
                        // éªŒè¯åæ ‡æ ¼å¼ï¼ˆåº”è¯¥æ˜¯æ•°å­—å­—ç¬¦ä¸²ï¼‰
                        if (!isNaN(row.Y) && !isNaN(row.X)) {
                            data.push(row);
                            
                            // è°ƒè¯•å‰å‡ æ¡è®°å½•çš„åæ ‡
                            if (data.length <= 5) {
                                console.log(`ğŸ“ è®°å½•${data.length}: ${row.name}, Y=${row.Y}, X=${row.X}, ç±»åˆ«=${row.category || 'æœªåˆ†ç±»'}`);
                            }
                        } else {
                            console.warn(`âš ï¸ åæ ‡æ ¼å¼é”™è¯¯ - ${row.name}: Y=${row.Y}, X=${row.X}`);
                        }
                    } else {
                        console.warn(`âš ï¸ ç¼ºå°‘å¿…è¦å­—æ®µ - ${row.name || 'æœªçŸ¥åœ°ç‚¹'}: Y=${row.Y}, X=${row.X}`);
                    }
                }
            }
            console.log(`ğŸ” è§£æCSVå®Œæˆï¼Œå…±è§£æ ${data.length} æ¡æœ‰æ•ˆè®°å½•`);
            return data;
        } catch (error) {
            console.error('âŒ CSVè§£æé”™è¯¯:', error);
            return [];
        }
    }
    
    async function loadCSV(filePath) {
        // æ£€æµ‹å½“å‰åè®®
        const isFileProtocol = window.location.protocol === 'file:';
        
        if (!isFileProtocol) {
            try {
                // ä½¿ç”¨HTTPæœåŠ¡å™¨åŠ è½½
                const response = await fetch(filePath);
                if (!response.ok) {
                    throw new Error(`æ— æ³•æ‰¾åˆ°æˆ–åŠ è½½ CSV æ–‡ä»¶: ${response.statusText}`);
                }
                const text = await response.text();
                console.log(`ğŸ“ ä½¿ç”¨HTTPæœåŠ¡å™¨åŠ è½½CSVæˆåŠŸï¼Œæ–‡ä»¶å¤§å°: ${text.length} å­—ç¬¦`);
                const data = parseCSV(text);
                
                if (data.length >= 10) {
                    return data;
                } else {
                    console.warn(`âš ï¸ è§£æçš„æ•°æ®å¤ªå°‘ (${data.length} æ¡)ï¼Œä½¿ç”¨å¤‡ç”¨æ•°æ®`);
                    return getCSVDataFallback();
                }
            } catch (fetchError) {
                console.warn(`ğŸ”„ HTTPåŠ è½½å¤±è´¥: ${fetchError.message}ï¼Œå°è¯•å…¶ä»–æ–¹æ³•`);
            }
        } else {
            console.log(`ğŸ“ æ£€æµ‹åˆ°file://åè®®ï¼ŒCORSé™åˆ¶ï¼Œç›´æ¥ä½¿ç”¨å¤‡ç”¨æ•°æ®`);
        }
        
        // å¯¹äºfile://åè®®æˆ–HTTPå¤±è´¥çš„æƒ…å†µï¼Œæä¾›å¤šç§è§£å†³æ–¹æ¡ˆ
        try {
            return await loadCSVAlternativeMethods();
        } catch (error) {
            console.error(`âŒ æ‰€æœ‰åŠ è½½æ–¹æ³•éƒ½å¤±è´¥ï¼Œä½¿ç”¨å†…ç½®å¤‡ç”¨æ•°æ®`);
            return getCSVDataFallback();
        }
    }

    async function loadCSVAlternativeMethods() {
        // æ–¹æ³•1ï¼šå°è¯•ä½¿ç”¨FileReader API
        try {
            return await loadCSVUsingFileReader();
        } catch (error) {
            console.warn(`ğŸ”„ FileReaderæ–¹æ³•å¤±è´¥: ${error.message}`);
        }
        
        // æ–¹æ³•2ï¼šå°è¯•å†…è”CSVæ•°æ®ï¼ˆå¦‚æœå­˜åœ¨ï¼‰
        try {
            const inlineData = await loadInlineData();
            if (inlineData && inlineData.length >= 10) {
                console.log(`ğŸ“ ä½¿ç”¨å†…è”æ•°æ®æˆåŠŸ`);
                return inlineData;
            }
        } catch (error) {
            console.warn(`ğŸ”„ å†…è”æ•°æ®æ–¹æ³•å¤±è´¥: ${error.message}`);
        }
        
        // æ–¹æ³•3ï¼šæŠ›å‡ºé”™è¯¯ï¼Œä½¿ç”¨fallbackæ•°æ®
        throw new Error(`æ‰€æœ‰å¤‡ç”¨åŠ è½½æ–¹æ³•éƒ½å¤±è´¥`);
    }

    // ä»scriptæ ‡ç­¾åŠ è½½å†…è”CSVæ•°æ®
    async function loadInlineData() {
        const scriptElement = document.getElementById('csv-data-script');
        if (scriptElement) {
            try {
                const csvData = scriptElement.textContent;
                return parseCSV(csvData);
            } catch (error) {
                console.error(`è§£æå†…è”CSVæ•°æ®å¤±è´¥:`, error);
                return null;
            }
        }
        return null;
    }
    
    // ä½¿ç”¨FileReader APIåŠ è½½CSV
    async function loadCSVUsingFileReader() {
        return new Promise((resolve, reject) => {
            const csvPath = 'åœ°ç‚¹æ•°æ®_æ•°æ®åº“æ ¼å¼.csv';
            
            // åˆ›å»ºä¸€ä¸ªéšè—çš„inputå…ƒç´ æ¥é€‰æ‹©æ–‡ä»¶
            const fileInput = document.createElement('input');
            fileInput.type = 'file';
            fileInput.accept = '.csv';
            fileInput.style.display = 'none';
            
            fileInput.onchange = function(event) {
                const file = event.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        console.log(`ğŸ“ ä½¿ç”¨FileReader APIåŠ è½½CSVæˆåŠŸ`);
                        resolve(parseCSV(e.target.result));
                    };
                    reader.onerror = function() {
                        reject(new Error('FileReaderè¯»å–æ–‡ä»¶å¤±è´¥'));
                    };
                    reader.readAsText(file, 'UTF-8');
                } else {
                    reject(new Error('æœªé€‰æ‹©æ–‡ä»¶'));
                }
            };
            
            // å¦‚æœæ˜¯file://åè®®ï¼Œæç¤ºç”¨æˆ·é€‰æ‹©æ–‡ä»¶
            if (window.location.protocol === 'file:') {
                const modal = document.createElement('div');
                modal.style.cssText = `
                    position: fixed;
                    top: 0;
                    left: 0;
                    width: 100%;
                    height: 100%;
                    background: rgba(0,0,0,0.8);
                    display: flex;
                    justify-content: center;
                    align-items: center;
                    z-index: 10000;
                `;
                
                modal.innerHTML = `
                    <div style="background: white; padding: 30px; border-radius: 10px; text-align: center; max-width: 500px;">
                        <h3 style="color: #e74c3c; margin-bottom: 20px;">ğŸ“‚ éœ€è¦é€‰æ‹©CSVæ–‡ä»¶</h3>
                        <p style="margin-bottom: 20px; color: #555;">
                            ç”±äºæµè§ˆå™¨å®‰å…¨é™åˆ¶ï¼Œè¯·æ‰‹åŠ¨é€‰æ‹©CSVæ–‡ä»¶ï¼š<br>
                            <strong>åœ°ç‚¹æ•°æ®_æ•°æ®åº“æ ¼å¼.csv</strong>
                        </p>
                        <div style="display: flex; gap: 10px; justify-content: center; margin-bottom: 15px;">
                            <button id="selectFileBtn" style="padding: 10px 20px; background: #3498db; color: white; border: none; border-radius: 5px; cursor: pointer;">
                                é€‰æ‹©CSVæ–‡ä»¶
                            </button>
                            <button id="cancelFileSelection" style="padding: 10px 20px; background: #95a5a6; color: white; border: none; border-radius: 5px; cursor: pointer;">
                                ä½¿ç”¨ç¤ºä¾‹æ•°æ®
                            </button>
                        </div>
                        <p style="color: #7f8c8d; font-size: 12px;">
                            æç¤ºï¼šå¦‚éœ€å®Œæ•´åŠŸèƒ½ï¼Œè¯·ä½¿ç”¨HTTPæœåŠ¡å™¨è¿è¡Œæ­¤é¡µé¢
                        </p>
                    `;
                
                document.body.appendChild(modal);
                
                document.getElementById('selectFileBtn').onclick = function() {
                    fileInput.click();
                };
                
                // å°†rejectå‡½æ•°ä¿å­˜åˆ°å…¨å±€ï¼Œä»¥ä¾¿ç”¨æˆ·å–æ¶ˆæ—¶è°ƒç”¨
                window.rejectFileSelection = reject;
                
                // æ·»åŠ å–æ¶ˆæŒ‰é’®åŠŸèƒ½
                setTimeout(() => {
                    const cancelBtn = document.querySelector('#cancelFileSelection');
                    if (cancelBtn) {
                        cancelBtn.onclick = function() {
                            document.body.removeChild(modal);
                            // ç”¨æˆ·é€‰æ‹©ä½¿ç”¨ç¤ºä¾‹æ•°æ®ï¼Œè°ƒç”¨fallback
                            resolve(getCSVDataFallback());
                        };
                    }
                }, 100);
            } else {
                reject(new Error('æœªçŸ¥åè®®'));
            }
        });
    }
    
    // å¤‡ç”¨CSVæ•°æ®ï¼ˆå‰å‡ æ¡è®°å½•ä½œä¸ºç¤ºä¾‹ï¼‰
    function getCSVDataFallback() {
        console.log(`âš ï¸ ä½¿ç”¨å†…ç½®ç¤ºä¾‹æ•°æ®ï¼ˆ92æ¡è®°å½•ï¼‰`);
        return [
            {
                id: '001',
                name: 'ç»å…´å¿é¦†',
                Y: '2421',
                X: '1412',
                category: 'å±…ä½åœ°',
                address: 'å®£æ­¦é—¨å¤–å—åŠæˆªèƒ¡åŒè·¯è¥¿ï¼ˆç°é—¨ç‰Œ 7 å·ï¼Œå±åŒ—äº¬å®£æ­¦åŒºæ–‡ç‰©ä¿æŠ¤å•ä½ï¼‰',
                zoom: '1',
                short_text: 'ç»å…´å¿é¦†ï¼ˆ1912.5.6-1919.11.21ï¼ˆå±…ä½ 7 å¹´åŠï¼‰ï¼‰',
                full_text: '<strong>åœ°ç‚¹åç§°ï¼š</strong>ç»å…´å¿é¦†<br><strong>è¯¦ç»†åœ°å€ï¼š</strong>å®£æ­¦é—¨å¤–å—åŠæˆªèƒ¡åŒè·¯è¥¿ï¼ˆç°é—¨ç‰Œ 7 å·ï¼Œå±åŒ—äº¬å®£æ­¦åŒºæ–‡ç‰©ä¿æŠ¤å•ä½ï¼‰<br><strong>åœ°ç‚¹ç±»å‹ï¼š</strong>å±…ä½åœ°<br><strong>æ—¶é—´æ®µï¼š</strong>1912.5.6-1919.11.21ï¼ˆå±…ä½ 7 å¹´åŠï¼‰<br><strong>ç›¸å…³å†å²äº‹ä»¶ï¼š</strong>æ–°æ–‡åŒ–è¿åŠ¨<br><strong>ä¸»è¦æ´»åŠ¨ï¼š</strong>1912.5.6 ä»é•¿å‘å®¢æ ˆè¿å…¥ï¼Œåˆä½è—¤èŠ±é¦†è¥¿æˆ¿ï¼Œ1916.5.6 å› é‚»å±…å–§å“—ç§»å…¥è¡¥æ ‘ä¹¦å±‹ï¼›1918 å¹´é’±ç„åŒå¤šæ¬¡åˆ°è®¿ï¼Œå¼•å‘ã€Šç‹‚äººæ—¥è®°ã€‹åˆ›ä½œï¼Œé¦–æ¬¡å¤§è§„æ¨¡ä»¥ "é²è¿…" ç¬”åå…¬å¼€å‘è¡¨ï¼›è¾‘æ ¡ã€Šåµ‡åº·é›†ã€‹ã€Šè°¢æ‰¿åæ±‰ä¹¦ã€‹ç­‰å¤ç±ï¼Œç ”ç©¶é‡‘çŸ³å­¦ï¼Œé¢‘ç¹å‡ºå…¥ç‰ç’ƒå‚è´­æ‹“ç‰‡ï¼ˆ1915-1919 å¹´è´­äº”åƒè‡³å…­åƒä»¶ï¼‰ï¼›<br><strong>ç›¸å…³äººç‰©ï¼š</strong>é’±ç„åŒã€å‘¨ä½œäººã€è®¸å¯¿è£³ã€ææ…ˆé“­<br><strong>ç°çŠ¶è¯´æ˜ï¼š</strong>1. "è—¤èŠ±é¦†å·²æ”¹å»ºï¼›è¡¥æ ‘ä¹¦å±‹å‰æ§æ ‘äºè¿‘ä»£ä¸å­˜ï¼ˆèµ„æ–™è®°è½½ä¸º1949å¹´è¢«é›·å‡»ï¼‰ï¼›2. é²è¿…ä½å®¤å¤§ä½“ä½ç½®æœªå˜ï¼›3. ç°ä¸ºå±…æ°‘å¤§æ‚é™¢ï¼Œå±å®£æ­¦åŒºæ–‡ç‰©ä¿æŠ¤å•ä½<br><strong>ç›¸å…³ä½œå“ï¼š</strong>ã€Šç‹‚äººæ—¥è®°ã€‹ã€Šå­”ä¹™å·±ã€‹ã€Šè¯ã€‹ã€Šæ˜å¤©ã€‹ï¼ˆå°è¯´ï¼‰ï¼›ã€Šæˆ‘ä¹‹èŠ‚çƒˆè§‚ã€‹ã€Šæˆ‘ä»¬ç°åœ¨æ€æ ·åšçˆ¶äº²ã€‹ï¼ˆæ‚æ–‡ï¼‰ï¼›ã€Šåµ‡åº·é›†ã€‹ï¼ˆæ ¡å‹˜ï¼‰ï¼›ã€Šå‘å–Š?è‡ªåºã€‹<br><strong>å¤‡æ³¨ï¼š</strong>å±…ä½ 7 å¹´åŠ',
                images: '',
                audio: '',
                route_ids: '',
                source: 'ã€Šé²è¿…ä¸ä»–çš„åŒ—äº¬ã€‹'
            },
            {
                id: '002',
                name: 'å…«é“æ¹¾ 11 å·',
                Y: '5442',
                X: '2108',
                category: 'å±…ä½åœ°',
                address: 'è¥¿ç›´é—¨å†…å…¬ç”¨åº“å…«é“æ¹¾ï¼ˆè¿›èƒ¡åŒ 50 ç±³åå¼€é˜”å¤„ï¼‰',
                zoom: '1',
                short_text: 'å…«é“æ¹¾ 11 å·ï¼ˆ1919.11.21-1923.8.2ï¼ˆå±…ä½è¿‘ 4 å¹´ï¼‰ï¼‰',
                full_text: '<strong>åœ°ç‚¹åç§°ï¼š</strong>å…«é“æ¹¾ 11 å·<br><strong>è¯¦ç»†åœ°å€ï¼š</strong>è¥¿ç›´é—¨å†…å…¬ç”¨åº“å…«é“æ¹¾ï¼ˆè¿›èƒ¡åŒ 50 ç±³åå¼€é˜”å¤„ï¼‰<br><strong>åœ°ç‚¹ç±»å‹ï¼š</strong>å±…ä½åœ°<br><strong>æ—¶é—´æ®µï¼š</strong>1919.11.21-1923.8.2ï¼ˆå±…ä½è¿‘ 4 å¹´ï¼‰<br><strong>ç›¸å…³å†å²äº‹ä»¶ï¼š</strong>äº”å››è¿åŠ¨<br><strong>ä¸»è¦æ´»åŠ¨ï¼š</strong>1919 å¹´è§…å±‹ 15 æ¬¡ï¼Œ8 æœˆä»ç½—å§“æ‰‹ä¸­è´­å±‹ï¼Œ11 æœˆ 4 æ—¥æ”¶æˆ¿ï¼Œ11 æœˆ 21 æ—¥ä¸å‘¨ä½œäººå¤«å¦‡è¿å…¥ï¼Œ12 æœˆæ¥æ¯äº²ã€æœ±å®‰åŠå‘¨å»ºäººä¸€å®¶åŒä½ï¼Œä¿®ç¼®æ—¶æ¥å…¥è‡ªæ¥æ°´ç³»ç»Ÿï¼›1921 å¹´åˆ›ä½œã€Šé˜¿ Q æ­£ä¼ ã€‹ï¼Œå‡ºç‰ˆé¦–éƒ¨å°è¯´é›†ã€Šå‘å–Šã€‹ï¼›1922 å¹´è¯‘ä¿„å›½ç›²è¯—äººçˆ±ç½—å…ˆç‚åœ¨åŒ—å¤§å¹³æ°‘å¤œæ ¡æ¼”å”±çš„æ­Œè¯ã€Šä¿„å›½çš„è±ªæ°ã€‹ï¼›å› ä¸å‘¨ä½œäººå®¶åº­çŸ›ç›¾å’Œå…„å¼Ÿå†³è£‚ï¼Œ1923 å¹´å¤ç¦»å¼€<br><strong>ç›¸å…³äººç‰©ï¼š</strong>å‘¨ä½œäººã€ç¾½å¤ªä¿¡å­ã€èƒ¡é€‚ã€æ¯›æ³½ä¸œ<br><strong>ç°çŠ¶è¯´æ˜ï¼š</strong>1. å‘¨ä½œäººä¸€å®¶ä½è‡³ "æ–‡é©" åï¼Œ1985 å¹´å‘¨ä¸°ä¸€æ¬èµ°ï¼›2. é™¢é—¨ã€éš”å¢™å·²æ‹†ï¼Œé™¢å†…ç›–å°å¨æˆ¿ï¼Œä¸»å»ºç­‘æœªå˜ï¼›3. 1996 å¹´æœ‰å…³éƒ¨é—¨å†³å®šä¿ç•™é™¢è½ï¼Œåç»­ä½æˆ·å·²æ¬è¿<br><strong>ç›¸å…³ä½œå“ï¼š</strong>ã€Šé˜¿ Q æ­£ä¼ ã€‹ã€Šé£æ³¢ã€‹ã€Šå¤´å‘çš„æ•…äº‹ã€‹ã€Šæ•…ä¹¡ã€‹ï¼ˆå°è¯´ï¼‰ï¼›ã€Šå‘å–Šã€‹ï¼ˆå°è¯´é›†ï¼‰ï¼›ã€Šé¸­çš„å–œå‰§ã€‹ï¼ˆçŸ­ç¯‡å°è¯´ï¼‰ï¼›ã€Šä¸­å›½å°è¯´å²ç•¥ã€‹ï¼ˆä¸Šå·ï¼‰<br><strong>å¤‡æ³¨ï¼š</strong>å±…ä½è¿‘ 4 å¹´',
                images: '',
                audio: '',
                route_ids: '',
                source: 'ã€Šé²è¿…ä¸ä»–çš„åŒ—äº¬ã€‹'
            },
            {
                id: '003',
                name: 'ç –å¡”èƒ¡åŒ 61 å·ï¼ˆç° 84 å·ï¼‰',
                Y: '4263',
                X: '1260',
                category: 'å±…ä½åœ°',
                address: 'è¥¿å››å—å¤§è¡—ä¸å­—è·¯å£å—ä¾§ï¼ˆä¸‡æ¾è€äººå¡”æ—ï¼Œç –å¡”èƒ¡åŒä¸ºåŒ—äº¬æœ€å¤è€èƒ¡åŒä¹‹ä¸€ï¼‰',
                zoom: '1',
                short_text: 'ç –å¡”èƒ¡åŒ 61 å·ï¼ˆç° 84 å·ï¼‰ï¼ˆ1923.8.2-1924.5.25ï¼ˆå±…ä½ 9 ä¸ªå¤šæœˆï¼‰ï¼‰',
                full_text: '<strong>åœ°ç‚¹åç§°ï¼š</strong>ç –å¡”èƒ¡åŒ 61 å·ï¼ˆç° 84 å·ï¼‰<br><strong>è¯¦ç»†åœ°å€ï¼š</strong>è¥¿å››å—å¤§è¡—ä¸å­—è·¯å£å—ä¾§ï¼ˆä¸‡æ¾è€äººå¡”æ—ï¼Œç –å¡”èƒ¡åŒä¸ºåŒ—äº¬æœ€å¤è€èƒ¡åŒä¹‹ä¸€ï¼‰<br><strong>åœ°ç‚¹ç±»å‹ï¼š</strong>å±…ä½åœ°<br><strong>æ—¶é—´æ®µï¼š</strong>1923.8.2-1924.5.25ï¼ˆå±…ä½ 9 ä¸ªå¤šæœˆï¼‰<br><strong>ç›¸å…³å†å²äº‹ä»¶ï¼š</strong>å¥³å¸ˆå¤§é£æ½®<br><strong>ä¸»è¦æ´»åŠ¨ï¼š</strong>1923.8.2 å› å…„å¼Ÿå¤±å’Œè¿å…¥ï¼Œä½ 3 é—´åŒ—æˆ¿ï¼Œä¿å®¶å§å¦¹ä½è¥¿æˆ¿ï¼Œä¸œæˆ¿ä¸ºå¥³å·¥ä½å®¤åŠå…¬ç”¨å¨æˆ¿ï¼›1923.9-11 æ‚£è‚ºç—…ï¼ˆç—…ç¨‹ 40 å¤©ï¼‰ï¼Œç—…ä¸­åšæŒåˆ›ä½œï¼›1924 å¹´æ˜¥å†™ã€Šç¥ç¦ã€‹ã€Šåœ¨é…’æ¥¼ä¸Šã€‹ç­‰å°è¯´ï¼Œå®Œæˆã€Šå¨œæ‹‰èµ°åæ€æ ·ã€‹ã€Šæœªæœ‰å¤©æ‰ä¹‹å‰ã€‹è®²æ¼”ç¨¿ï¼›1923.10 åº•æ‰¾å¥½è¥¿ä¸‰æ¡æˆ¿å­ï¼ŒåŠç†ä¹°æˆ¿æ‰‹ç»­å¹¶ä¿®ç¼®ï¼Œ1924.5.25 è¿å‡º<br><strong>ç›¸å…³äººç‰©ï¼š</strong>è®¸ç¾¡è‹ã€ä¿èŠ¬ã€ä¿èŠ³ã€é©¬å¹¼æ¸”<br><strong>ç°çŠ¶è¯´æ˜ï¼š</strong>1. æœåŒ—å¤§é—¨æ”¹æœè¥¿ï¼Œé—¨é“æ”¹ä½æˆ¿ï¼›2. åŸä¸‰é—´åŒ—æˆ¿å·²äº1981å¹´æ‹†é™¤å¹¶é‡å»ºï¼ˆåŸè²Œæ”¹åŠ¨è¾ƒå¤§ï¼‰ï¼›3. ç°ä¸ºæ°‘å±…ï¼ŒåŸè²Œæ”¹åŠ¨å¤§ä½†å±é‡è¦é—è¿¹<br><strong>ç›¸å…³ä½œå“ï¼š</strong>ã€Šç¥ç¦ã€‹ã€Šåœ¨é…’æ¥¼ä¸Šã€‹ã€Šå¹¸ç¦çš„å®¶åº­ã€‹ã€Šè‚¥çš‚ã€‹ï¼ˆå°è¯´ï¼‰ï¼›ã€Šå¨œæ‹‰èµ°åæ€æ ·ã€‹ã€Šæœªæœ‰å¤©æ‰ä¹‹å‰ã€‹ï¼ˆè®²æ¼”ç¨¿ï¼‰ï¼›ã€Šåµ‡åº·é›†ã€‹ï¼ˆæ ¡å‹˜ï¼‰ï¼›ã€Šä¸­å›½å°è¯´å²ç•¥ã€‹ï¼ˆä¸‹å·ï¼‰<br><strong>å¤‡æ³¨ï¼š</strong>å±…ä½ 9 ä¸ªå¤šæœˆ',
                images: '',
                audio: '',
                route_ids: '',
                source: 'ã€Šé²è¿…ä¸ä»–çš„åŒ—äº¬ã€‹'
            },
            {
                id: '004',
                name: 'è¥¿ä¸‰æ¡ 21 å·',
                Y: '4540',
                X: '975',
                category: 'å±…ä½åœ°',
                address: 'é˜œæˆé—¨å†…å¤§è¡—è·¯åŒ—ï¼ˆä¸œè¿‘ç™½å¡”å¯ºï¼Œå åœ°è¿‘ 400 å¹³æ–¹ç±³ï¼‰',
                zoom: '1',
                short_text: 'è¥¿ä¸‰æ¡ 21 å·ï¼ˆ1924.5.25-1926.8.26ï¼ˆå±…ä½ 2 å¹´ 3 ä¸ªæœˆï¼‰ï¼›ã€ï¼‰',
                full_text: '<strong>åœ°ç‚¹åç§°ï¼š</strong>è¥¿ä¸‰æ¡ 21 å·<br><strong>è¯¦ç»†åœ°å€ï¼š</strong>é˜œæˆé—¨å†…å¤§è¡—è·¯åŒ—ï¼ˆä¸œè¿‘ç™½å¡”å¯ºï¼Œå åœ°è¿‘ 400 å¹³æ–¹ç±³ï¼‰<br><strong>åœ°ç‚¹ç±»å‹ï¼š</strong>å±…ä½åœ°<br><strong>æ—¶é—´æ®µï¼š</strong>1924.5.25-1926.8.26ï¼ˆå±…ä½ 2 å¹´ 3 ä¸ªæœˆï¼‰ï¼›ã€<br><strong>ç›¸å…³å†å²äº‹ä»¶ï¼š</strong>ä¸‰ä¸€å…«æƒ¨æ¡ˆ<br><strong>ä¸»è¦æ´»åŠ¨ï¼š</strong>1923.10.30 è´­å±‹ï¼ˆå€Ÿæ¬¾ 800 å…ƒï¼Œå‘è®¸å¯¿è£³ã€é½å¯¿å±±å„å€Ÿ 400 å…ƒï¼‰ï¼Œäº²è‡ªç»˜æ–½å·¥è‰å›¾æ”¹å»ºï¼›1924.5.25 è¿å…¥ï¼ŒåŒ—æˆ¿å ‚å±‹æ¥ \"è€è™å°¾å·´\" ä½œå·¥ä½œå®¤ï¼›1925 å¹´æ”¯æŒå¥³å¸ˆå¤§é£æ½®ï¼Œä»»æ ¡åŠ¡ç»´æŒä¼šæˆå‘˜ï¼Œåœ¨å®—å¸½èƒ¡åŒ 33 å·ï¼ˆåŸ 14 å·ï¼‰ä¸´æ—¶æ ¡èˆä¹‰åŠ¡æˆè¯¾ï¼Œè¯¾æ—¶å¢è‡³åŒå€ï¼›1926 å¹´ \"ä¸‰ä¸€å…«\" æƒ¨æ¡ˆåå†™ã€Šçºªå¿µåˆ˜å’Œçå›ã€‹ï¼Œåé¿éš¾å±±æœ¬åŒ»é™¢ï¼›1926.8.26 ç¦»äº¬å—ä¸‹å¦é—¨ï¼›1932.11 å›å¹³æ¢äº²æ—¶åœ¨é™¢ä¸­æ¡‚èŠ±æ ‘ä¸‹ç•™å½±<br><strong>ç›¸å…³äººç‰©ï¼š</strong>è®¸å¹¿å¹³ã€åˆ˜å’Œçã€é½å¯¿å±±ã€å¸å¾’ä¹”<br><strong>ç°çŠ¶è¯´æ˜ï¼š</strong>1950 å¹´ 2 æœˆæ–‡åŒ–éƒ¨æ¥ç®¡ï¼Œ3 æœˆè®¸å¹¿å¹³ææ–‡ç‰©ï¼›1951 å¹´éƒ­æ²«è‹¥é¢˜ \"é²è¿…æ•…å±…\"ï¼Œ1956 å¹´ä¸œä¾§å»ºé²è¿…åšç‰©é¦†ï¼›1979 å¹´ 8 æœˆåˆ—ä¸ºå¸‚çº§æ–‡ä¿å•ä½<br><strong>ç›¸å…³ä½œå“ï¼š</strong>ã€Šé‡è‰ã€‹ï¼ˆæ•£æ–‡è¯—å…¨é›†ï¼‰ï¼›ã€Šå½·å¾¨ã€‹ï¼ˆå«ã€Šé•¿æ˜ç¯ã€‹ã€Šç¦»å©šã€‹ç­‰ 7 ç¯‡ï¼‰ï¼›ã€Šåç›–é›†ã€‹ã€Šåç›–é›†ç»­ç¼–ã€‹ï¼ˆæ‚æ–‡é›†ï¼‰ï¼›ã€Šçºªå¿µåˆ˜å’Œçå›ã€‹ã€Šæ­»åœ°ã€‹ï¼ˆæ‚æ–‡ï¼‰<br><strong>å¤‡æ³¨ï¼š</strong>å±…ä½ 2 å¹´ 3 ä¸ªæœˆ',
                images: '',
                audio: '',
                route_ids: '',
                source: 'ã€Šé²è¿…ä¸ä»–çš„åŒ—äº¬ã€‹'
            },
            {
                id: '005',
                name: 'æ•™è‚²éƒ¨',
                Y: '3406',
                X: '1463',
                category: 'å·¥ä½œåœ°',
                address: 'åŸæ¸…æ”¿åºœå­¦éƒ¨æ—§å€ï¼Œè¥¿å•å—é¢è·¯è¥¿ï¼ˆåŸæ•¬è°¨äº²ç‹åºœï¼Œç°æ­¦è­¦è¥¿å•æ‹›å¾…æ‰€ï¼‰',
                zoom: '1',
                short_text: 'æ•™è‚²éƒ¨ï¼ˆ1912.5.6-1926.8.26ï¼ˆä»»èŒ 14 å¹´ï¼‰ï¼‰',
                full_text: '<strong>åœ°ç‚¹åç§°ï¼š</strong>æ•™è‚²éƒ¨<br><strong>è¯¦ç»†åœ°å€ï¼š</strong>åŸæ¸…æ”¿åºœå­¦éƒ¨æ—§å€ï¼Œè¥¿å•å—é¢è·¯è¥¿ï¼ˆåŸæ•¬è°¨äº²ç‹åºœï¼Œç°æ­¦è­¦è¥¿å•æ‹›å¾…æ‰€ï¼‰<br><strong>åœ°ç‚¹ç±»å‹ï¼š</strong>å·¥ä½œåœ°<br><strong>æ—¶é—´æ®µï¼š</strong>1912.5.6-1926.8.26ï¼ˆä»»èŒ 14 å¹´ï¼‰<br><strong>ç›¸å…³å†å²äº‹ä»¶ï¼š</strong>æ–°æ•™è‚²æ”¹é©ä¸æ–‡åŒ–ä¿æŠ¤<br><strong>ä¸»è¦æ´»åŠ¨ï¼š</strong>1. ä»»ç¤¾ä¼šæ•™è‚²å¸ç¬¬ä¸€ç§‘ç§‘é•¿ã€"èä»»ä½¥äº‹"ï¼Œåˆ†ç®¡åšç‰©é¦†ã€å›¾ä¹¦é¦†ã€ç¾æœ¯ã€æ–‡è‰ºäº‹åŠ¡ï¼›2. 1912 å¹´ä¸»è®² "å¤æœŸè®²æ¼”ä¼š"ã€Šç¾æœ¯ç•¥è®ºã€‹ï¼Œ1913 å¹´æ‹Ÿã€Šæ’­å¸ƒç¾æœ¯æ„è§ä¹¦ã€‹ï¼›3. ç­¹å»ºå›¾ä¹¦é¦†ã€åšç‰©é¦†ï¼Œå‚ä¸è®¾è®¡å›½å¾½ã€ç»Ÿä¸€æ³¨éŸ³å­—æ¯ï¼›4. 1925 å¹´å› æ”¯æŒå¥³å¸ˆå¤§é£æ½®è¢«ç« å£«é’Šå…èŒï¼Œåèƒœè¯‰å¤èŒ<br><strong>ç›¸å…³äººç‰©ï¼š</strong>è”¡å…ƒåŸ¹ã€å¤æ›¾ä½‘ã€é½å¯¿å±±ã€è®¸å¯¿è£³<br><strong>ç°çŠ¶è¯´æ˜ï¼š</strong>1. åŸå»ºç­‘å¤§éƒ¨åˆ†æ‹†é™¤ï¼Œä»…å­˜åç½©æˆ¿äºŒå±‚å°æ¥¼åŠéƒ¨åˆ†é•¿å»Šï¼›2. ç°æ”¹ä¸ºæ­¦è­¦è¥¿å•æ‹›å¾…æ‰€ï¼Œçº¢æ¼†å¤§é—¨ã€çŸ³ç‹®å­ä¿ç•™<br><strong>å¤‡æ³¨ï¼š</strong>ä»»èŒ 14 å¹´',
                images: '',
                audio: '',
                route_ids: '',
                source: 'ã€Šé²è¿…ä¸ä»–çš„åŒ—äº¬ã€‹'
            },
            {
                id: '006',
                name: 'æ•™è‚²éƒ¨',
                Y: '3406',
                X: '1463',
                category: 'å·¥ä½œåœ°',
                address: 'åŸæ¸…æ”¿åºœå­¦éƒ¨æ—§å€ï¼Œè¥¿å•å—é¢è·¯è¥¿ï¼ˆåŸæ•¬è°¨äº²ç‹åºœï¼Œç°æ­¦è­¦è¥¿å•æ‹›å¾…æ‰€ï¼‰',
                zoom: '1',
                short_text: 'æ•™è‚²éƒ¨ï¼ˆ1912.5.6-1926.8.26ï¼ˆä»»èŒ 14 å¹´ï¼‰ï¼‰',
                full_text: '<strong>åœ°ç‚¹åç§°ï¼š</strong>æ•™è‚²éƒ¨<br><strong>è¯¦ç»†åœ°å€ï¼š</strong>åŸæ¸…æ”¿åºœå­¦éƒ¨æ—§å€ï¼Œè¥¿å•å—é¢è·¯è¥¿ï¼ˆåŸæ•¬è°¨äº²ç‹åºœï¼Œç°æ­¦è­¦è¥¿å•æ‹›å¾…æ‰€ï¼‰<br><strong>åœ°ç‚¹ç±»å‹ï¼š</strong>å·¥ä½œåœ°<br><strong>æ—¶é—´æ®µï¼š</strong>1912.5.6-1926.8.26ï¼ˆä»»èŒ 14 å¹´ï¼‰<br><strong>ç›¸å…³å†å²äº‹ä»¶ï¼š</strong>æ–°æ•™è‚²æ”¹é©ä¸æ–‡åŒ–ä¿æŠ¤<br><strong>ä¸»è¦æ´»åŠ¨ï¼š</strong>1. ä»»ç¤¾ä¼šæ•™è‚²å¸ç¬¬ä¸€ç§‘ç§‘é•¿ã€"èä»»ä½¥äº‹"ï¼Œåˆ†ç®¡åšç‰©é¦†ã€å›¾ä¹¦é¦†ã€ç¾æœ¯ã€æ–‡è‰ºäº‹åŠ¡ï¼›2. 1912 å¹´ä¸»è®² "å¤æœŸè®²æ¼”ä¼š"ã€Šç¾æœ¯ç•¥è®ºã€‹ï¼Œ1913 å¹´æ‹Ÿã€Šæ’­å¸ƒç¾æœ¯æ„è§ä¹¦ã€‹ï¼›3. ç­¹å»ºå›¾ä¹¦é¦†ã€åšç‰©é¦†ï¼Œå‚ä¸è®¾è®¡å›½å¾½ã€ç»Ÿä¸€æ³¨éŸ³å­—æ¯ï¼›4. 1925 å¹´å› æ”¯æŒå¥³å¸ˆå¤§é£æ½®è¢«ç« å£«é’Šå…èŒï¼Œåèƒœè¯‰å¤èŒ<br><strong>ç›¸å…³äººç‰©ï¼š</strong>è”¡å…ƒåŸ¹ã€å¤æ›¾ä½‘ã€é½å¯¿å±±ã€è®¸å¯¿è£³<br><strong>ç°çŠ¶è¯´æ˜ï¼š</strong>1. åŸå»ºç­‘å¤§éƒ¨åˆ†æ‹†é™¤ï¼Œä»…å­˜åç½©æˆ¿äºŒå±‚å°æ¥¼åŠéƒ¨åˆ†é•¿å»Šï¼›2. ç°æ”¹ä¸ºæ­¦è­¦è¥¿å•æ‹›å¾…æ‰€ï¼Œçº¢æ¼†å¤§é—¨ã€çŸ³ç‹®å­ä¿ç•™<br><strong>å¤‡æ³¨ï¼š</strong>ä»»èŒ 14 å¹´',
                images: '',
                audio: '',
                route_ids: '',
                source: 'ã€Šé²è¿…ä¸ä»–çš„åŒ—äº¬ã€‹'
            },
            {
                id: '007',
                name: 'äº¬å¸ˆå›¾ä¹¦é¦†ï¼ˆå«å¹¿åŒ–å¯ºã€å›½å­ç›‘å—å­¦å€ï¼‰',
                Y: '5445',
                X: '3151',
                category: 'å·¥ä½œåœ°',
                address: '1. åˆå€ï¼šä»€åˆ¹æµ·åæµ·åŒ—å²¸å¹¿åŒ–å¯ºï¼ˆ1912.8-1917.1ï¼‰ï¼›2. è¿å€ï¼šæ–¹å®¶èƒ¡åŒå›½å­ç›‘å—å­¦ï¼ˆ1917.1-1928ï¼‰',
                zoom: '1',
                short_text: 'äº¬å¸ˆå›¾ä¹¦é¦†ï¼ˆå«å¹¿åŒ–å¯ºã€å›½å­ç›‘å—å­¦å€ï¼‰ï¼ˆ1912.8-1926.8ï¼ˆä¸»ç®¡ä¸è§†å¯Ÿï¼‰ï¼‰',
                full_text: '<strong>åœ°ç‚¹åç§°ï¼š</strong>äº¬å¸ˆå›¾ä¹¦é¦†ï¼ˆå«å¹¿åŒ–å¯ºã€å›½å­ç›‘å—å­¦å€ï¼‰<br><strong>è¯¦ç»†åœ°å€ï¼š</strong>1. åˆå€ï¼šä»€åˆ¹æµ·åæµ·åŒ—å²¸å¹¿åŒ–å¯ºï¼ˆ1912.8-1917.1ï¼‰ï¼›2. è¿å€ï¼šæ–¹å®¶èƒ¡åŒå›½å­ç›‘å—å­¦ï¼ˆ1917.1-1928ï¼‰<br><strong>åœ°ç‚¹ç±»å‹ï¼š</strong>å·¥ä½œåœ°<br><strong>æ—¶é—´æ®µï¼š</strong>1912.8-1926.8ï¼ˆä¸»ç®¡ä¸è§†å¯Ÿï¼‰<br><strong>ç›¸å…³å†å²äº‹ä»¶ï¼š</strong>æ¸…æœ«å›¾ä¹¦é¦†è¿åŠ¨<br><strong>ä¸»è¦æ´»åŠ¨ï¼š</strong>1. ä¸»ç®¡å›¾ä¹¦é¦†äº‹åŠ¡ï¼Œå¤šæ¬¡èµ´å¹¿åŒ–å¯ºè§†å¯Ÿï¼Œé˜…æ•¦ç…ŒçŸ³å®¤å”äººå†™ç»ã€å®‹å…ƒåˆ»æœ¬ï¼›2. æ¨åŠ¨é¦†è—æ‰©å……ï¼Œåè°ƒè°ƒå…¥å›½å­ç›‘å—å­¦è—ä¹¦ã€æ‰¿å¾·æ–‡æ´¥é˜ã€Šå››åº“å…¨ä¹¦ã€‹ï¼›3. 1913 å¹´å‚ä¸è¿é¦†é€‰å€ï¼Œ1917 å¹´ 1 æœˆå‚åŠ æ–¹å®¶èƒ¡åŒæ–°é¦†å¼€é¦†å…¸ç¤¼ï¼›4. æ¨èå®‹ç´«ä½© 1913 å¹´åˆ°äº¬å¸ˆå›¾ä¹¦åˆ†é¦†å·¥ä½œ<br><strong>ç›¸å…³äººç‰©ï¼š</strong>æ±Ÿç€šã€ç¼ªèƒå­™ã€å®‹ç´«ä½©<br><strong>ç°çŠ¶è¯´æ˜ï¼š</strong>1. å¹¿åŒ–å¯ºç°ä¸ºåŒ—äº¬å¸‚ä½›æ•™åä¼šåŠå…¬åœ°ï¼Œä¸»ä½“å»ºç­‘ä¿å­˜ï¼›2. æ–¹å®¶èƒ¡åŒå›½å­ç›‘å—å­¦æ—§å€ç°è¢«æ–¹å®¶èƒ¡åŒå°å­¦ã€åŒ—äº¬ç¬¬ä¸€å››ä¸‰ä¸­å­¦å ç”¨ï¼ŒåŸ "äº¬å¸ˆå›¾ä¹¦é¦†" é—¨é¢å­˜æ ¡å†…<br><strong>å¤‡æ³¨ï¼š</strong>ä¸»ç®¡ä¸è§†å¯Ÿ',
                images: '',
                audio: '',
                route_ids: '',
                source: 'ã€Šé²è¿…ä¸ä»–çš„åŒ—äº¬ã€‹'
            },
            {
                id: '008',
                name: 'é€šä¿—å›¾ä¹¦é¦†',
                Y: '3213',
                X: '1476',
                category: 'å·¥ä½œåœ°',
                address: '1. åˆå€ï¼šå®£æ­¦é—¨å†…è·¯è¥¿ï¼ˆ1913.10-1917.8ï¼‰ï¼›2. è¿å€ï¼šä¸­å¤®å…¬å›­å¤§æ®¿ï¼ˆä»Šä¸­å±±å…¬å›­ä¸­å±±å ‚ï¼Œ1917.8-1919ï¼‰ï¼›3. å†è¿å€ï¼šå®£æ­¦é—¨å†…å¤´å‘èƒ¡åŒ 22 å·ï¼ˆåŸæ¸…æœç¿°æ—è®²ä¹ é¦†æ—§å€ï¼Œ1919 åï¼‰',
                zoom: '1',
                short_text: 'é€šä¿—å›¾ä¹¦é¦†ï¼ˆ1913.10-1926.8ï¼ˆä¸»ç®¡ä¸æ£€æŸ¥ï¼‰ï¼‰',
                full_text: '<strong>åœ°ç‚¹åç§°ï¼š</strong>é€šä¿—å›¾ä¹¦é¦†<br><strong>è¯¦ç»†åœ°å€ï¼š</strong>1. åˆå€ï¼šå®£æ­¦é—¨å†…è·¯è¥¿ï¼ˆ1913.10-1917.8ï¼‰ï¼›2. è¿å€ï¼šä¸­å¤®å…¬å›­å¤§æ®¿ï¼ˆä»Šä¸­å±±å…¬å›­ä¸­å±±å ‚ï¼Œ1917.8-1919ï¼‰ï¼›3. å†è¿å€ï¼šå®£æ­¦é—¨å†…å¤´å‘èƒ¡åŒ 22 å·ï¼ˆåŸæ¸…æœç¿°æ—è®²ä¹ é¦†æ—§å€ï¼Œ1919 åï¼‰<br><strong>åœ°ç‚¹ç±»å‹ï¼š</strong>å·¥ä½œåœ°<br><strong>æ—¶é—´æ®µï¼š</strong>1913.10-1926.8ï¼ˆä¸»ç®¡ä¸æ£€æŸ¥ï¼‰<br><strong>ç›¸å…³å†å²äº‹ä»¶ï¼š</strong>æ–°æ–‡åŒ–è¿åŠ¨<br><strong>ä¸»è¦æ´»åŠ¨ï¼š</strong>1. 1913 å¹´ 10 æœˆå‚ä¸åˆ›åŠï¼Œåˆ†æ™®é€šå›¾ä¹¦ã€å„¿ç«¥å›¾ä¹¦ä¸¤ç±»ï¼Œé™„è®¾å„¿ç«¥ä½“è‚²åœºï¼›2. 1914 å¹´åŒå¾å‰è½©åˆ°é¦†å°åã€åŒè®¸å­£ä¸Šæ£€é˜…å°è¯´ï¼Œå¤šæ¬¡åˆ°é¦†æ£€æŸ¥å·¥ä½œï¼›3. å‘é¦†å†…èµ ã€Šç‚­ç”»ã€‹ã€Šæ–°é’å¹´ã€‹ç­‰ä¹¦ï¼›4. 1919 å¹´åä¸é€šä¿—æ•™è‚²é¦†å…±ç”¨å®£æ­¦é—¨å†…å¤´å‘èƒ¡åŒ 22 å·éƒ¨åˆ†åœºæ‰€<br><strong>ç›¸å…³äººç‰©ï¼š</strong>ç‹ä»²çŒ·ã€å¾å‰è½©ã€è®¸å­£ä¸Š<br><strong>ç°çŠ¶è¯´æ˜ï¼š</strong>1. å¤´å‘èƒ¡åŒ 22 å·æ—§å€ç°ä¸ºåŒ—äº¬äº¬å‰§é™¢å®¿èˆï¼Œå››åˆé™¢æ ¼å±€ä¿ç•™ï¼›2. ä¸­å¤®å…¬å›­å¤§æ®¿ç°ä¸ºä¸­å±±å ‚<br><strong>å¤‡æ³¨ï¼š</strong>ä¸»ç®¡ä¸æ£€æŸ¥',
                images: '',
                audio: '',
                route_ids: '',
                source: 'ã€Šé²è¿…ä¸ä»–çš„åŒ—äº¬ã€‹'
            },
            {
                id: '009',
                name: 'å›½å­ç›‘ï¼ˆå«å†å²åšç‰©é¦†ç­¹å¤‡å¤„ï¼‰',
                Y: '5461',
                X: '3147',
                category: 'å·¥ä½œåœ°',
                address: 'å®‰å®šé—¨å†…æˆè´¤è¡—ï¼ˆå…ƒæ˜æ¸…ä¸‰æœæœ€é«˜å­¦åºœï¼‰',
                zoom: '1',
                short_text: 'å›½å­ç›‘ï¼ˆå«å†å²åšç‰©é¦†ç­¹å¤‡å¤„ï¼‰ï¼ˆ1912â€“1918 å¹´ä¸ºå¯†é›†é˜¶æ®µï¼Œï¼‰',
                full_text: '<strong>åœ°ç‚¹åç§°ï¼š</strong>å›½å­ç›‘ï¼ˆå«å†å²åšç‰©é¦†ç­¹å¤‡å¤„ï¼‰<br><strong>è¯¦ç»†åœ°å€ï¼š</strong>å®‰å®šé—¨å†…æˆè´¤è¡—ï¼ˆå…ƒæ˜æ¸…ä¸‰æœæœ€é«˜å­¦åºœï¼‰<br><strong>åœ°ç‚¹ç±»å‹ï¼š</strong>å·¥ä½œåœ°<br><strong>æ—¶é—´æ®µï¼š</strong>1912â€“1918 å¹´ä¸ºå¯†é›†é˜¶æ®µï¼Œ<br><strong>ç›¸å…³å†å²äº‹ä»¶ï¼š</strong>æ°‘å›½åˆæœŸç¤¾ä¼šå˜é©<br><strong>ä¸»è¦æ´»åŠ¨ï¼š</strong>1. 1912 å¹´ 7 æœˆè€ƒå¯Ÿï¼Œæ‹Ÿè®¾å†å²åšç‰©é¦†ï¼Œ1914 å¹´ 6 æœˆæ­£å¼è®¾ç«‹ç­¹å¤‡å¤„ï¼Œè´Ÿè´£æ–‡ç‰©æœé›†ï¼›2. æ— å¿æèµ ç“¦å½“ã€å¤§é•œç­‰æ–‡ç‰©ï¼Œ1913 å¹´ä¸ºè±æ¯”é”¡ "ä¸‡å›½åšè§ˆä¼š" ç­¹å¤‡å±•å“å¹¶æ·±å¤œå®ˆæŠ¤ï¼›3. 1918 å¹´æ•´ç† "å¤§å†…æ¡£æ¡ˆ"ï¼Œæ­éœ²å®˜åƒšå¤±èŒï¼›4. å› ç¥­å­”ã€æ£€æŸ¥åšç‰©é¦†äº‹åŠ¡é¢‘ç¹å‰å¾€ï¼Œ1925 å¹´ 4 æœˆå¸¦å¥³å¸ˆå¤§å­¦ç”Ÿå‚è§‚<br><strong>ç›¸å…³äººç‰©ï¼š</strong>é©¬è¡¡ã€å‚…å¢æ¹˜ã€å¥³å¸ˆå¤§å­¦ç”Ÿ<br><strong>ç°çŠ¶è¯´æ˜ï¼š</strong>1. ç°ä¸ºå›½å­ç›‘åšç‰©é¦†ï¼Œå»ºç­‘ä¿®é¥°ä¸€æ–°ï¼›2. å†å²åšç‰©é¦†ç­¹å¤‡å¤„ç—•è¿¹æ— å­˜ï¼ŒåŸå€åˆ’å…¥å›½å­ç›‘æ™¯åŒº<br><strong>å¤‡æ³¨ï¼š</strong>å¯†é›†é˜¶æ®µ',
                images: '',
                audio: '',
                route_ids: '',
                source: 'ã€Šé²è¿…ä¸ä»–çš„åŒ—äº¬ã€‹'
            },
            {
                id: '010',
                name: 'å­”åº™ï¼ˆä¸å›½å­ç›‘å…³è”å…¬åŠ¡ï¼‰',
                Y: '5440',
                X: '3198',
                category: 'å·¥ä½œåœ°',
                address: 'å›½å­ç›‘ä¸œä¾§ï¼ˆå…ƒæ˜æ¸…ç¥­ç¥€å­”å­åœºæ‰€ï¼‰',
                zoom: '1',
                short_text: 'å­”åº™ï¼ˆä¸å›½å­ç›‘å…³è”å…¬åŠ¡ï¼‰ï¼ˆ1912.6-1924. ç§‹ï¼ˆå…¬åŠ¡å‚ä¸ï¼‰ï¼‰',
                full_text: '<strong>åœ°ç‚¹åç§°ï¼š</strong>å­”åº™ï¼ˆä¸å›½å­ç›‘å…³è”å…¬åŠ¡ï¼‰<br><strong>è¯¦ç»†åœ°å€ï¼š</strong>å›½å­ç›‘ä¸œä¾§ï¼ˆå…ƒæ˜æ¸…ç¥­ç¥€å­”å­åœºæ‰€ï¼‰<br><strong>åœ°ç‚¹ç±»å‹ï¼š</strong>å·¥ä½œåœ°<br><strong>æ—¶é—´æ®µï¼š</strong>1912.6-1924. ç§‹ï¼ˆå…¬åŠ¡å‚ä¸ï¼‰<br><strong>ç›¸å…³å†å²äº‹ä»¶ï¼š</strong>æ°‘å›½åˆæœŸç¤¾ä¼šå˜é©<br><strong>ä¸»è¦æ´»åŠ¨ï¼š</strong>1. 1912 å¹´ 6 æœˆéšæ•™è‚²éƒ¨è€ƒå¯Ÿï¼Œä¸ºç­¹å¤‡å†å²åšç‰©é¦†æŸ¥çœ‹å¤ç‰©ï¼›2. 1913-1924 å¹´æ¯å¹´æ˜¥ç§‹ "ä¸ç¥­" æ—¶ï¼Œè¢«æ´¾ä»»æ‰§äº‹ï¼Œä¼ é€’ "å¸›""çˆµ" ç­‰ç¥­å“ï¼ŒåŒäº‹é’±ç¨»èªå›å¿† "ä¸¾æ¡ˆé½çœ‰" é€’ç¥­å“ï¼›3. æ—¥è®°ä¸­æ‰¹åˆ¤ç¥­å­”ä»ªå¼ "è’é™‹å¯æ‚¼å¹"<br><strong>ç›¸å…³äººç‰©ï¼š</strong>é’±ç¨»èªã€æ•™è‚²éƒ¨åŒäº‹<br><strong>ç°çŠ¶è¯´æ˜ï¼š</strong>1. 1981 å¹´åé‡ä¿®å¹¶ä½œä¸ºæ–‡ç‰©ä¿æŠ¤å•ä½å¼€æ”¾ï¼Œä¸å±äºé¦–éƒ½åšç‰©é¦†é¦†å€ã€‚1989 å¹´èµ·ä¸¾åŠç¥­å­”è¡¨æ¼”ï¼›2. ä¿ç•™è¿›å£«é¢˜åç¢‘ï¼Œå¤§æˆæ®¿å¤–æœˆå°ä¸ºç¥­å­”è¡¨æ¼”åœºåœ°<br><strong>å¤‡æ³¨ï¼š</strong>å…¬åŠ¡å‚ä¸',
                images: '',
                audio: '',
                route_ids: '',
                source: 'ã€Šé²è¿…ä¸ä»–çš„åŒ—äº¬ã€‹'
            },
            {
                id: '011',
                name: 'æ•…å®«ï¼ˆå«åˆé—¨ã€ä¸‰å¤§æ®¿ã€å¤ç‰©é™ˆåˆ—æ‰€ï¼‰',
                Y: '3987',
                X: '2440',
                category: 'å·¥ä½œåœ°',
                address: 'åŒ—äº¬åŸæ­£ä¸­ï¼ˆæ˜æ¸…çš‡å®«ï¼‰',
                zoom: '1',
                short_text: 'æ•…å®«ï¼ˆå«åˆé—¨ã€ä¸‰å¤§æ®¿ã€å¤ç‰©é™ˆåˆ—æ‰€ï¼‰ï¼ˆ1917.2-1925.7ï¼ˆå…¬åŠ¡ä¸æ£€æŸ¥ï¼‰ï¼‰',
                full_text: '<strong>åœ°ç‚¹åç§°ï¼š</strong>æ•…å®«ï¼ˆå«åˆé—¨ã€ä¸‰å¤§æ®¿ã€å¤ç‰©é™ˆåˆ—æ‰€ï¼‰<br><strong>è¯¦ç»†åœ°å€ï¼š</strong>åŒ—äº¬åŸæ­£ä¸­ï¼ˆæ˜æ¸…çš‡å®«ï¼‰<br><strong>åœ°ç‚¹ç±»å‹ï¼š</strong>å·¥ä½œåœ°<br><strong>æ—¶é—´æ®µï¼š</strong>1917.2-1925.7ï¼ˆå…¬åŠ¡ä¸æ£€æŸ¥ï¼‰<br><strong>ç›¸å…³å†å²äº‹ä»¶ï¼š</strong>æ°‘å›½åˆæœŸç¤¾ä¼šå˜é©<br><strong>ä¸»è¦æ´»åŠ¨ï¼š</strong>1. 1917 å¹´ 2 æœˆè€ƒå¯Ÿåˆé—¨ï¼Œæ‹Ÿè®¾å›¾ä¹¦é¦†ï¼Œ12 æœˆæ£€æŸ¥åˆé—¨å›¾ä¹¦é¦†å·¥ä½œï¼›2. 1920 å¹´æ¸…ç†åˆé—¨å¾·æ–‡ä¹¦ï¼ˆæ¬§æˆ˜æˆ˜åˆ©å“ï¼‰ï¼›3. 1925 å¹´ 7 æœˆåˆ°å¤ªå’Œæ®¿ã€ä¿å’Œæ®¿æ£€æŸ¥æ²ˆé˜³æ–‡æº¯é˜ã€Šå››åº“å…¨ä¹¦ã€‹ï¼Œç­¹å¤‡å¯è¿ï¼›4. 1914 å¹´èµ·å…³æ³¨å¤ç‰©é™ˆåˆ—æ‰€ï¼ˆæ­¦è‹±æ®¿ã€æ–‡åæ®¿ï¼‰ï¼Œ1917 å¹´é™ªå‘¨ä½œäººå‚è§‚<br><strong>ç›¸å…³äººç‰©ï¼š</strong>é½å¯¿å±±ã€æœ±å¯é“ƒã€å‘¨ä½œäºº<br><strong>ç°çŠ¶è¯´æ˜ï¼š</strong>1. åˆé—¨ã€ä¸‰å¤§æ®¿åˆ’å…¥æ•…å®«åšç‰©é™¢ï¼Œå¯¹å…¬ä¼—å¼€æ”¾ï¼›2. å¤ç‰©é™ˆåˆ—æ‰€å¹¶å…¥æ•…å®«ï¼Œæ­¦è‹±æ®¿ã€æ–‡åæ®¿ä¿ç•™<br><strong>å¤‡æ³¨ï¼š</strong>å…¬åŠ¡ä¸æ£€æŸ¥',
                images: '',
                audio: '',
                route_ids: '',
                source: 'ã€Šé²è¿…ä¸ä»–çš„åŒ—äº¬ã€‹'
            }
        ];
    }

    // *** 2. åœ°å›¾åˆå§‹åŒ– ***
    
    function initializeMapWithImage(imageSrc, width, height) {
        map = L.map('map', {
            crs: L.CRS.Simple,
            minZoom: -3, 
            maxZoom: 3, 
            zoomControl: true,
        });

        imageBounds = [[0, 0], [height, width]];
        
        L.imageOverlay(imageSrc, imageBounds).addTo(map);

        map.fitBounds(imageBounds);
        map.setMaxBounds(imageBounds);

        console.log(`ğŸ—ºï¸ åœ°å›¾åˆå§‹åŒ–æˆåŠŸ: å›¾ç‰‡=${imageSrc}, å°ºå¯¸=${width}x${height}`);
        loadDataAndInitialize();
    }
    
    function initializeMap() {
        console.log(`ğŸš€ å¼€å§‹åˆå§‹åŒ–åœ°å›¾ï¼Œå›¾ç‰‡: ${IMAGE_URL}`);
        
        const img = new Image();
        img.onload = function() {
            const width = this.width;
            const height = this.height;
            console.log(`ğŸ“ å›¾ç‰‡å°ºå¯¸: ${width}x${height}`);
            initializeMapWithImage(IMAGE_URL, width, height);
        };
        
        img.onerror = function() {
            console.error(`âŒ é”™è¯¯ï¼šæ— æ³•åŠ è½½åœ°å›¾å›¾ç‰‡ "${IMAGE_URL}"ã€‚`);
            console.log('ğŸ” æ£€æŸ¥ç›®å½•ä¸­çš„å›¾ç‰‡æ–‡ä»¶...');
            // å°è¯•å…¶ä»–å¯èƒ½çš„å›¾ç‰‡æ–‡ä»¶å
            const alternativeImages = [
                'gigapixel-map_pekin1920_full.jpg',
                'map_pekin1920_full.jpg'
            ];
            
            let attemptCount = 0;
            function tryNextImage() {
                if (attemptCount < alternativeImages.length) {
                    const testImg = alternativeImages[attemptCount];
                    console.log(`ğŸ“ å°è¯•åŠ è½½: ${testImg}`);
                    const test = new Image();
                    test.onload = function() {
                        console.log(`âœ… æˆåŠŸåŠ è½½: ${testImg}`);
                        initializeMapWithImage(testImg, this.width, this.height);
                    };
                    test.onerror = tryNextImage;
                    test.src = testImg;
                    attemptCount++;
                } else {
                    // æ‰€æœ‰å›¾ç‰‡éƒ½åŠ è½½å¤±è´¥
                    document.getElementById('map').innerHTML = `
                        <div style="display: flex; justify-content: center; align-items: center; height: 100%; background: #f8f9fa;">
                            <div style="text-align: center; padding: 40px;">
                                <div style="font-size: 48px; margin-bottom: 20px;">ğŸ—ºï¸</div>
                                <h3 style="color: #e74c3c; margin-bottom: 10px;">åœ°å›¾å›¾ç‰‡åŠ è½½å¤±è´¥</h3>
                                <p style="color: #7f8c8d;">è¯·ç¡®ä¿åœ°å›¾å›¾ç‰‡æ–‡ä»¶å­˜åœ¨</p>
                                <p style="color: #95a5a6; font-size: 14px;">å°è¯•çš„æ–‡ä»¶: map_pekin1920_full.jpg, gigapixel-map_pekin1920_full.jpg</p>
                            </div>
                        </div>
                    `;
                }
            }
            tryNextImage();
        };
        
        img.src = IMAGE_URL;
    }

    // *** 3. ç•Œé¢åˆå§‹åŒ– ***
    
    function initializeUI() {
        // ä¾§è¾¹æ åˆ‡æ¢
        const toggleBtn = document.getElementById('toggleSidebar');
        const sidebar = document.getElementById('sidebar');
        
        toggleBtn.addEventListener('click', function() {
            sidebar.classList.toggle('collapsed');
            toggleBtn.classList.toggle('collapsed');
            toggleBtn.innerHTML = sidebar.classList.contains('collapsed') ? 'â˜°' : 'âœ•';
        });

        // æœç´¢åŠŸèƒ½
        const searchBox = document.getElementById('searchBox');
        searchBox.addEventListener('input', function(e) {
            filterLocations(e.target.value);
        });

        // æ¨¡æ€æ¡†å…³é—­
        const modal = document.getElementById('locationModal');
        const closeBtn = document.querySelector('.close');
        
        closeModal = function() { 
            modal.style.display = "none";
            document.body.style.overflow = 'auto';
        }
        
        closeBtn.onclick = closeModal;
        
        // æ·»åŠ ESCé”®å…³é—­
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') {
                closeModal();
            }
        });
        
        // ç‚¹å‡»èƒŒæ™¯å…³é—­ï¼ˆæ’é™¤æ¨¡æ€æ¡†å†…å®¹å’Œå­å…ƒç´ ï¼‰
        modal.onclick = function(event) {
            if (event.target === modal) { 
                closeModal();
            }
        }
        
        // é˜»æ­¢æ¨¡æ€æ¡†å†…å®¹çš„ç‚¹å‡»äº‹ä»¶å†’æ³¡åˆ°èƒŒæ™¯
        const modalContent = modal.querySelector('.modal-content');
        if (modalContent) {
            modalContent.onclick = function(event) {
                event.stopPropagation();
            };
        }
        
        // è°ƒè¯•ï¼šæ·»åŠ äººç‰©é“¾æ¥ç‚¹å‡»ç›‘å¬
        document.addEventListener('click', function(event) {
            if (event.target.classList.contains('person-link')) {
                console.log('ğŸ–±ï¸ ç‚¹å‡»äº†äººç‰©é“¾æ¥:', event.target.textContent);
                console.log('ğŸ”— ç›®æ ‡URL:', event.target.href);
                // ç¡®ä¿é“¾æ¥å¯ä»¥æ­£å¸¸è·³è½¬ï¼Œä¸é˜»æ­¢é»˜è®¤è¡Œä¸º
                return true;
            }
        }, true); // ä½¿ç”¨æ•è·é˜¶æ®µ
    }

    // *** 4. åˆ†ç±»èœå•ç”Ÿæˆ ***
    
    function generateCategoryMenu(data) {
        const categories = {};
        data.forEach(location => {
            const category = location.category || 'å…¶ä»–';
            if (!categories[category]) {
                categories[category] = [];
            }
            categories[category].push(location);
        });

        const menuContainer = document.getElementById('categoryMenu');
        menuContainer.innerHTML = '';

        // å…¨éƒ¨ç±»åˆ«
        const allSection = document.createElement('div');
        allSection.className = 'category-section';
        allSection.innerHTML = `
            <div class="category-title active" data-category="å…¨éƒ¨">
                <span>ğŸ“ å…¨éƒ¨åœ°ç‚¹</span>
                <span class="category-count">${data.length}</span>
            </div>
            <ul class="location-list" id="locations-å…¨éƒ¨"></ul>
        `;
        menuContainer.appendChild(allSection);

        // å„ä¸ªç±»åˆ«
        Object.entries(categories).forEach(([category, locations]) => {
            const section = document.createElement('div');
            section.className = 'category-section';
            section.innerHTML = `
                <div class="category-title" data-category="${category}">
                    <span>${getCategoryIcon(category)} ${category}</span>
                    <span class="category-count">${locations.length}</span>
                </div>
                <ul class="location-list" id="locations-${category}" style="display: none;"></ul>
            `;
            menuContainer.appendChild(section);
        });

        // æ·»åŠ äº‹ä»¶ç›‘å¬
        document.querySelectorAll('.category-title').forEach(title => {
            title.addEventListener('click', function() {
                const category = this.dataset.category;
                toggleCategory(category);
            });
        });

        // å¡«å……åœ°ç‚¹åˆ—è¡¨
        Object.entries(categories).forEach(([category, locations]) => {
            fillLocationList(category, locations);
        });
        fillLocationList('å…¨éƒ¨', data);

        // ç”Ÿæˆå›¾ä¾‹
        generateLegend(categories);
    }

    function getCategoryIcon(category) {
        const icons = {
            'å±…ä½åœ°': 'ğŸ ',
            'å·¥ä½œåœ°': 'ğŸ¢',
            'æ•™ä¹¦åœ°': 'ğŸ“',
            'é¤é¥®åœ°': 'ğŸ½ï¸',
            'è´­ç‰©åœ°': 'ğŸ›ï¸',
            'é£æ™¯åèƒœ': 'ğŸ›ï¸',
            'ä¼šé¦†': 'ğŸ›ï¸',
            'åŒ»é™¢': 'ğŸ¥',
            'é¿éš¾æ‰€': 'ğŸ›¡ï¸',
            'æ‚å¿—ç¤¾': 'ğŸ“°',
            'å½±å‰§é™¢': 'ğŸ­'
        };
        return icons[category] || 'ğŸ“';
    }

    function fillLocationList(category, locations) {
        const listContainer = document.getElementById(`locations-${category}`);
        if (!listContainer) return;

        listContainer.innerHTML = '';
        locations.forEach(location => {
            const li = document.createElement('li');
            li.className = 'location-item';
            li.textContent = location.name;
            li.addEventListener('click', () => {
                focusLocation(location);
            });
            listContainer.appendChild(li);
        });
    }

    function generateLegend(categories) {
        const legendContainer = document.getElementById('legend');
        legendContainer.innerHTML = '<h4 style="margin: 0 0 10px 0;">å›¾ä¾‹</h4>';
        
        Object.entries(categories).forEach(([category, locations]) => {
            const item = document.createElement('div');
            item.className = 'legend-item';
            item.innerHTML = `
                <div class="legend-marker" style="background-color: ${CATEGORY_COLORS[category] || '#95a5a6'}"></div>
                <span>${getCategoryIcon(category)} ${category} (${locations.length})</span>
            `;
            legendContainer.appendChild(item);
        });
    }

    function toggleCategory(category) {
        // æ›´æ–°æ ‡é¢˜çŠ¶æ€
        document.querySelectorAll('.category-title').forEach(title => {
            title.classList.remove('active');
        });
        document.querySelector(`[data-category="${category}"]`).classList.add('active');

        // æ˜¾ç¤º/éšè—åœ°ç‚¹åˆ—è¡¨
        document.querySelectorAll('.location-list').forEach(list => {
            list.style.display = 'none';
        });
        document.getElementById(`locations-${category}`).style.display = 'block';

        // è¿‡æ»¤åœ°å›¾æ ‡è®°
        currentFilter = category;
        filterMarkers(category);
        
        // æ›´æ–°ç»Ÿè®¡
        document.getElementById('currentCategory').textContent = category;
    }

    // *** 5. åœ°å›¾æ ‡è®°æ¸²æŸ“ ***
    
    function renderMarkers(data) {
        console.log(`ğŸš€ å¼€å§‹æ¸²æŸ“æ ‡è®°ï¼Œæ•°æ®é‡: ${data.length}`);
        
        // æ¸…é™¤ç°æœ‰æ ‡è®°
        markers.forEach(marker => map.removeLayer(marker));
        markers = [];

        let validMarkers = 0;
        let invalidMarkers = 0;
        const imageCoords = [];

        data.forEach((location, index) => {
            const y = parseInt(location.Y);
            const x = parseInt(location.X);
            
            // éªŒè¯åæ ‡æœ‰æ•ˆæ€§ï¼ˆå…è®¸åæ ‡å€¼ä¸º0çš„åœ°ç‚¹ï¼‰
            if (!isNaN(y) && !isNaN(x) && y >= 0 && x >= 0) {
                imageCoords.push({name: location.name, y, x, category: location.category});
                
                const markerColor = CATEGORY_COLORS[location.category] || '#95a5a6';
                
                const customIcon = L.divIcon({
                    className: `custom-marker category-marker-${location.category}`,
                    iconSize: [16, 16],
                    iconAnchor: [8, 8],
                    html: `<div style="background-color: ${markerColor}; width: 100%; height: 100%; border-radius: 50%; border: 2px solid #fff; box-shadow: 0 2px 8px rgba(0,0,0,0.4); transition: all 0.3s ease;"></div>`
                });

                // è°ƒè¯•å‰å‡ ä¸ªåæ ‡
                if (index < 5) {
                    console.log(`ğŸ¯ åˆ›å»ºæ ‡è®°${index}: "${location.name}" -> åæ ‡[${y}, ${x}], é¢œè‰²: ${markerColor}`);
                }

                const marker = L.marker([y, x], { 
                    icon: customIcon,
                    category: location.category
                }).addTo(map);

                // æ·»åŠ åœ°ç‚¹åç§°æ ‡ç­¾ï¼ˆé»˜è®¤éšè—ï¼Œæ‚”å¸æ—¶æ˜¾ç¤ºï¼‰
                const label = L.tooltip({
                    permanent: false,  // é»˜è®¤ä¸æ˜¾ç¤º
                    direction: 'right',
                    offset: [10, 0],
                    opacity: 0.95,
                    className: 'location-label'
                });
                label.setContent(location.name);
                marker.bindTooltip(label);
                
                // æ·»åŠ æ‚”å¸äº‹ä»¶æ¥äº‘æ§åˆ¶æ ‡ç­¾æ˜¾ç¤º
                marker.on('mouseover', function() {
                    // æ£€æŸ¥è¯¥æ ‡ç­¾æ˜¯å¦åº”è¯¥æ˜¾ç¤ºï¼ˆæ ¹æ®åˆ†ç±»ç­›é€‰ï¼‰
                    if (shouldShowLabel(location.category)) {
                        this.openTooltip();
                    }
                });
                
                marker.on('mouseout', function() {
                    this.closeTooltip();
                });

                marker.locationData = location;
                
                marker.on('click', function(e) {
                    // é˜»æ­¢é»˜è®¤è¡Œä¸ºå’Œäº‹ä»¶å†’æ³¡
                    L.DomEvent.preventDefault(e);
                    L.DomEvent.stopPropagation(e);
                    L.DomEvent.stop(e);
                    
                    // é˜»æ­¢åœ°å›¾ç§»åŠ¨
                    e.originalEvent.preventDefault();
                    
                    // æ˜¾ç¤ºè¯¦æƒ…å¼¹çª—
                    showLocationModal(location);
                    highlightLocationInList(location);
                    
                    return false;
                });

                // é˜²æ­¢æ‹–æ‹½å¯¼è‡´çš„é—®é¢˜
                marker.on('mousedown', function(e) {
                    L.DomEvent.stop(e);
                    return false;
                });

                marker.on('mouseup', function(e) {
                    L.DomEvent.stop(e);
                    return false;
                });

                // ç§»é™¤ hover ç¼©æ”¾æ•ˆæœï¼Œä¿æŒåœ°å›¾ç‚¹ä¸åŠ¨

                markers.push(marker);
                validMarkers++;
            } else {
                invalidMarkers++;
                console.warn(`âš ï¸ åœ°ç‚¹ "${location.name}" (ID: ${location.id}) åæ ‡æ— æ•ˆ: Y="${location.Y}", X="${location.X}"`);
            }
        });

        // è¾“å‡ºåæ ‡èŒƒå›´ä¿¡æ¯
        if (imageCoords.length > 0) {
            const yValues = imageCoords.map(c => c.y);
            const xValues = imageCoords.map(c => c.x);
            console.log(`ğŸ“Š åæ ‡èŒƒå›´: Y[${Math.min(...yValues)}-${Math.max(...yValues)}], X[${Math.min(...xValues)}-${Math.max(...xValues)}]`);
            console.log(`ğŸ“ å‰5ä¸ªæœ‰æ•ˆåæ ‡:`, imageCoords.slice(0, 5));
        }

        console.log(`ğŸ“ æ ‡è®°æ¸²æŸ“å®Œæˆ: ${validMarkers} ä¸ªæœ‰æ•ˆæ ‡è®°, ${invalidMarkers} ä¸ªæ— æ•ˆæ ‡è®°`);
        updateStats(data);
        
        // è‡ªåŠ¨è°ƒæ•´åœ°å›¾è§†è§’åˆ°æ ‡è®°åŒºåŸŸ
        if (validMarkers > 0) {
            setTimeout(() => {
                const group = new L.featureGroup(markers);
                if (group.getLayers().length > 0) {
                    map.fitBounds(group.getBounds().pad(0.1));
                    console.log(`ğŸ—ºï¸ åœ°å›¾å·²è°ƒæ•´è§†è§’åˆ°æ ‡è®°åŒºåŸŸ`);
                }
            }, 500);
        }
    }

    function filterMarkers(category) {
        markers.forEach(marker => {
            if (category === 'å…¨éƒ¨' || marker.locationData.category === category) {
                marker.setStyle({ opacity: 1 });
            } else {
                marker.setStyle({ opacity: 0.3 });
            }
        });
    }
    
    // åˆ¤æ–­æ˜¯å¦åº”è¯¥æ˜¾ç¤ºæ ‡ç­¾ï¼ˆæ ¹æ®å½“å‰åˆ†ç±»ç­›é€‰ï¼‰
    function shouldShowLabel(category) {
        // å¦‚æœå½“å‰ç­›é€‰æ˜¯å…¨éƒ¨ï¼Œæˆ–è€…æ˜¯é€‰ä¸­çš„åˆ†ç±»ï¼Œåˆ™æ˜¾ç¤ºæ ‡ç­¾
        return currentFilter === 'å…¨éƒ¨' || currentFilter === category;
    }
    
    function filterMarkers(category) {
        markers.forEach(marker => {
            if (category === 'å…¨éƒ¨' || marker.locationData.category === category) {
                marker.setStyle({ opacity: 1 });
            } else {
                marker.setStyle({ opacity: 0.3 });
            }
        });
    }

    // *** 6. äº¤äº’åŠŸèƒ½ ***
    
    function filterLocations(searchTerm) {
        const term = searchTerm.toLowerCase();
        document.querySelectorAll('.location-item').forEach(item => {
            const locationName = item.textContent.toLowerCase();
            if (locationName.includes(term)) {
                item.style.display = 'block';
            } else {
                item.style.display = 'none';
            }
        });
    }

    function focusLocation(location) {
        const y = parseInt(location.Y);
        const x = parseInt(location.X);
        
        if (!isNaN(y) && !isNaN(x)) {
            map.setView([y, x], 1);
            
            // æ‰¾åˆ°å¯¹åº”çš„æ ‡è®°å¹¶è§¦å‘ç‚¹å‡»
            const targetMarker = markers.find(marker => 
                marker.locationData.id === location.id
            );
            if (targetMarker) {
                targetMarker.openPopup();
                showLocationModal(location);
            }
        }
        
        highlightLocationInList(location);
    }

    function highlightLocationInList(location) {
        // æ¸…é™¤æ‰€æœ‰é«˜äº®
        document.querySelectorAll('.location-item').forEach(item => {
            item.classList.remove('active');
        });
        
        // é«˜äº®å½“å‰é€‰ä¸­é¡¹
        const currentCategory = document.querySelector('.category-title.active').dataset.category;
        const listItems = document.querySelectorAll(`#locations-${currentCategory} .location-item`);
        listItems.forEach(item => {
            if (item.textContent === location.name) {
                item.classList.add('active');
                item.scrollIntoView({ behavior: 'smooth', block: 'center' });
            }
        });
    }

    function showLocationModal(location) {
        const modal = document.getElementById('locationModal');
        const modalTitle = document.getElementById('modalTitle');
        const modalCategory = document.getElementById('modalCategory');
        const modalBody = document.getElementById('modal-body');

        modalTitle.textContent = location.name;
        modalCategory.textContent = location.category || 'å…¶ä»–';
        
        // è§£æfull_textä¸­çš„ç»“æ„åŒ–æ•°æ®
        const extractFullTextData = (fullText) => {
            const data = {};
            const patterns = {
                'åœ°ç‚¹åç§°': /<strong>åœ°ç‚¹åç§°ï¼š<\/strong>(.+?)(<br>|$)/,
                'è¯¦ç»†åœ°å€': /<strong>è¯¦ç»†åœ°å€ï¼š<\/strong>(.+?)(<br>|$)/,
                'åœ°ç‚¹ç±»å‹': /<strong>åœ°ç‚¹ç±»å‹ï¼š<\/strong>(.+?)(<br>|$)/,
                'æ—¶é—´æ®µ': /<strong>æ—¶é—´æ®µï¼š<\/strong>(.+?)(<br>|$)/,
                'ç›¸å…³å†å²äº‹ä»¶': /<strong>ç›¸å…³å†å²äº‹ä»¶ï¼š<\/strong>(.+?)(<br>|$)/,
                'ä¸»è¦æ´»åŠ¨': /<strong>ä¸»è¦æ´»åŠ¨ï¼š<\/strong>(.+?)(<strong>ç›¸å…³äººç‰©ï¼š|<strong>ç°çŠ¶è¯´æ˜ï¼š|<strong>ç›¸å…³ä½œå“ï¼š|<strong>å¤‡æ³¨ï¼š|<br>|$)/s,
                'ç›¸å…³äººç‰©': /<strong>ç›¸å…³äººç‰©ï¼š<\/strong>(.+?)(<strong>ç°çŠ¶è¯´æ˜ï¼š|<strong>ç›¸å…³ä½œå“ï¼š|<strong>å¤‡æ³¨ï¼š|<br>|$)/s,
                'ç°çŠ¶è¯´æ˜': /<strong>ç°çŠ¶è¯´æ˜ï¼š<\/strong>(.+?)(<strong>ç›¸å…³ä½œå“ï¼š|<strong>å¤‡æ³¨ï¼š|<br>|$)/s,
                'ç›¸å…³ä½œå“': /<strong>ç›¸å…³ä½œå“ï¼š<\/strong>(.+?)(<strong>å¤‡æ³¨ï¼š|<br>|$)/s,
                'å¤‡æ³¨': /<strong>å¤‡æ³¨ï¼š<\/strong>(.+?)(<br>|$)/s
            };
            
            for (const [key, pattern] of Object.entries(patterns)) {
                const match = fullText.match(pattern);
                if (match && match[1]) {
                    data[key] = match[1].replace(/<br>/g, '').trim();
                }
            }
            
            return data;
        };
        
        const fullTextData = extractFullTextData(location.full_text || '');
        
        modalBody.innerHTML = `
            <div class="detail-grid">
                <div class="detail-item primary">
                    <strong>ğŸ†” åœ°ç‚¹ç¼–å·</strong>
                    <p>${location.id || 'æœªçŸ¥'}</p>
                </div>
                <div class="detail-item primary">
                    <strong>ğŸ›ï¸ åœ°ç‚¹ç±»å‹</strong>
                    <p>${fullTextData['åœ°ç‚¹ç±»å‹'] || location.category || 'å…¶ä»–'}</p>
                </div>
                <div class="detail-item secondary">
                    <strong>ğŸ“ è¯¦ç»†åœ°å€</strong>
                    <p>${fullTextData['è¯¦ç»†åœ°å€'] || location.address || 'æš‚æ— åœ°å€ä¿¡æ¯'}</p>
                </div>
                <div class="detail-item secondary">
                    <strong>ğŸ“… æ—¶é—´æ®µ</strong>
                    <p>${fullTextData['æ—¶é—´æ®µ'] || location.short_text || 'æš‚æ— æ—¶é—´ä¿¡æ¯'}</p>
                </div>
            </div>
            
            <div class="detail-grid">
                <div class="detail-item">
                    <strong>âš¡ ç›¸å…³å†å²äº‹ä»¶</strong>
                    <p>${fullTextData['ç›¸å…³å†å²äº‹ä»¶'] || 'æš‚æ— ç›¸å…³å†å²äº‹ä»¶è®°è½½'}</p>
                </div>
                <div class="detail-item">
                    <strong>ğŸ¯ ä¸»è¦æ´»åŠ¨</strong>
                    <p>${fullTextData['ä¸»è¦æ´»åŠ¨'] || extractMainActivity(location.full_text)}</p>
                </div>
                <div class="detail-item">
                    <strong>ğŸ‘¥ ç›¸å…³äººç‰©</strong>
                    <p id="relatedPeopleList">${extractRelatedPeople(location.full_text)}</p>
                </div>
                <div class="detail-item">
                    <strong>ğŸ›ï¸ ç°çŠ¶è¯´æ˜</strong>
                    <p>${fullTextData['ç°çŠ¶è¯´æ˜'] || extractStatus(location.full_text)}</p>
                </div>
            </div>
            
            <div class="detail-grid">
                <div class="detail-item">
                    <strong>ğŸ“š ç›¸å…³ä½œå“</strong>
                    <p>${fullTextData['ç›¸å…³ä½œå“'] || 'æš‚æ— ç›¸å…³ä½œå“è®°è½½'}</p>
                </div>
                <div class="detail-item">
                    <strong>ğŸ“ åæ ‡ä¿¡æ¯</strong>
                    <div class="coordinate-info">
                        <span>Y: ${location.Y}</span>
                        <span>X: ${location.X}</span>
                        <span>ç¼©æ”¾: ${location.zoom || '1'}</span>
                    </div>
                </div>
                <div class="detail-item">
                    <strong>ğŸ“– æ•°æ®æ¥æº</strong>
                    <p>${location.source || 'ã€Šé²è¿…ä¸ä»–çš„åŒ—äº¬ã€‹'}</p>
                </div>
            </div>
            
            ${location.images ? `
            <div class="detail-item">
                <strong>ğŸ–¼ï¸ ç›¸å…³å›¾ç‰‡</strong>
                <p>${location.images}</p>
            </div>
            ` : ''}
            
            ${location.audio ? `
            <div class="detail-item">
                <strong>ğŸµ éŸ³é¢‘èµ„æ–™</strong>
                <p>${location.audio}</p>
            </div>
            ` : ''}
            
            ${location.route_ids ? `
            <div class="detail-item">
                <strong>ğŸ›¤ï¸ è·¯çº¿ç¼–å·</strong>
                <p>${location.route_ids}</p>
            </div>
            ` : ''}
            
            <div class="detail-item">
                <strong>ğŸ’¬ å¤‡æ³¨</strong>
                <p>${fullTextData['å¤‡æ³¨'] || 'æš‚æ— å¤‡æ³¨ä¿¡æ¯'}</p>
            </div>
            
            <div style="text-align: center; margin-top: 20px;">
                <button class="btn-network" onclick="showNetworkGraph('${location.name}')">
                    ğŸ•¸ï¸ æŸ¥çœ‹ç¤¾äº¤å…³ç³»ç½‘ç»œ
                </button>
            </div>
        `;
        
        // æ˜¾ç¤ºå¼¹çª—ä½†é˜»æ­¢é»˜è®¤æ»šåŠ¨è¡Œä¸º
        modal.style.display = "block";
        
        // é˜²æ­¢é¡µé¢è·³è½¬
        setTimeout(() => {
            // ç¡®ä¿å¼¹çª—å®Œå…¨æ˜¾ç¤ºåå†è®¾ç½®ç„¦ç‚¹
            modal.focus();
            document.body.style.overflow = 'hidden';
            
            // ç¡®ä¿äººç‰©é“¾æ¥æ­£å¸¸å·¥ä½œ - æ·»åŠ è°ƒè¯•ä¿¡æ¯
            const relatedPeopleList = document.getElementById('relatedPeopleList');
            if (relatedPeopleList) {
                const links = relatedPeopleList.querySelectorAll('.person-link');
                console.log(`ğŸ”— æ£€æµ‹åˆ° ${links.length} ä¸ªäººç‰©é“¾æ¥`);
                links.forEach((link, index) => {
                    console.log(`é“¾æ¥ ${index + 1}: ${link.textContent} -> ${link.href}`);
                    // ç¡®ä¿é“¾æ¥å¯ä»¥æ­£å¸¸å·¥ä½œ
                    link.style.pointerEvents = 'auto';
                    link.style.zIndex = 'auto';
                });
            }
        }, 100);
    }

    function updateStats(data) {
        const totalLocations = data.length;
        const markedLocations = data.filter(loc => {
            const y = parseInt(loc.Y);
            const x = parseInt(loc.X);
            return !isNaN(y) && !isNaN(x) && y > 0 && x > 0;
        }).length;

        document.getElementById('totalLocations').textContent = totalLocations;
        document.getElementById('markedLocations').textContent = markedLocations;
        
        console.log(`ğŸ“Š ç»Ÿè®¡ä¿¡æ¯æ›´æ–°: æ€»åœ°ç‚¹æ•°=${totalLocations}, å·²æ ‡æ³¨=${markedLocations}`);
    }

    // *** 7. ä¸»åˆå§‹åŒ–å‡½æ•° ***
    
    async function loadDataAndInitialize() {
        const csvFilePath = 'åœ°ç‚¹æ•°æ®_æ•°æ®åº“æ ¼å¼.csv';
        try {
            console.log(`ğŸš€ å¼€å§‹åŠ è½½CSVæ–‡ä»¶: ${csvFilePath}`);
            locationData = await loadCSV(csvFilePath);
            console.log(`âœ… CSV æ•°æ®åŠ è½½æˆåŠŸï¼Œå…± ${locationData.length} æ¡è®°å½•ã€‚`);
            
            // æ˜¾ç¤ºå‰å‡ æ¡æ•°æ®ç”¨äºè°ƒè¯•
            console.log(`ğŸ“‹ å‰5æ¡è®°å½•é¢„è§ˆ:`, locationData.slice(0, 5));
            
            // ç”Ÿæˆåˆ†ç±»èœå•
            generateCategoryMenu(locationData);
            
            // æ¸²æŸ“åœ°å›¾æ ‡è®°
            renderMarkers(locationData);
            
        } catch (error) {
            console.error("âŒ åŠ è½½æˆ–è§£æ CSV æ–‡ä»¶æ—¶å‡ºé”™:", error);
            document.getElementById('map').innerHTML = `
                <div style="display: flex; justify-content: center; align-items: center; height: 100%; background: #f8f9fa;">
                    <div style="text-align: center; padding: 40px;">
                        <div style="font-size: 48px; margin-bottom: 20px;">ğŸ“Š</div>
                        <h3 style="color: #e74c3c; margin-bottom: 10px;">æ•°æ®åŠ è½½å¤±è´¥</h3>
                        <p style="color: #7f8c8d;">è¯·ç¡®ä¿ 'åœ°ç‚¹æ•°æ®_æ•°æ®åº“æ ¼å¼.csv' æ–‡ä»¶å­˜åœ¨ä¸”æ ¼å¼æ­£ç¡®</p>
                        <p style="color: #95a5a6; font-size: 14px; margin-top: 20px;">é”™è¯¯è¯¦æƒ…: ${error.message}</p>
                        <button onclick="location.reload()" style="margin-top: 20px; padding: 10px 20px; background: #3498db; color: white; border: none; border-radius: 5px; cursor: pointer;">é‡æ–°åŠ è½½</button>
                    </div>
                </div>
            `;
        }
    }

    // *** 9. ç¤¾äº¤ç½‘ç»œå…³ç³»å›¾å¤„ç†ï¼ˆå¢å¼ºç‰ˆï¼‰***

    let socialNetworkData = null;
    let currentNetworkFilter = 'å…¨éƒ¨';

    async function loadSocialNetworkData() {
        try {
            // æ£€æµ‹å½“å‰åè®®
            const isFileProtocol = window.location.protocol === 'file:';
            
            if (!isFileProtocol) {
                try {
                    // ä½¿ç”¨HTTPæœåŠ¡å™¨åŠ è½½ç¤¾äº¤ç½‘ç»œæ•°æ®
                    const response = await fetch('./é²è¿…ç¤¾äº¤å…³ç³»ï¼ˆæ—¶é—´å…³è”ç‰ˆï¼‰1127.csv');
                    if (!response.ok) {
                        throw new Error(`æ— æ³•æ‰¾åˆ°æˆ–åŠ è½½ç¤¾äº¤ç½‘ç»œCSVæ–‡ä»¶: ${response.statusText}`);
                    }
                    const csvText = await response.text();
                    socialNetworkData = parseNetworkCSV(csvText);
                    console.log('âœ… ç¤¾äº¤ç½‘ç»œæ•°æ®åŠ è½½æˆåŠŸ:', socialNetworkData.length, 'æ¡å…³ç³»');
                    return;
                } catch (fetchError) {
                    console.warn(`ğŸ”„ HTTPåŠ è½½ç¤¾äº¤ç½‘ç»œæ•°æ®å¤±è´¥: ${fetchError.message}`);
                }
            }
            
            // å¯¹äºfile://åè®®æˆ–HTTPå¤±è´¥çš„æƒ…å†µï¼Œä½¿ç”¨å†…è”æ•°æ®
            console.warn('âš ï¸ ç¤¾äº¤ç½‘ç»œæ•°æ®åŠ è½½å¤±è´¥ï¼Œä½¿ç”¨çœŸå®æ•°æ®');
            socialNetworkData = getRealNetworkData();
            console.log('âœ… ä½¿ç”¨çœŸå®ç¤¾äº¤ç½‘ç»œæ•°æ®:', socialNetworkData.length, 'æ¡å…³ç³»');
        } catch (error) {
            console.error('âŒ ç¤¾äº¤ç½‘ç»œæ•°æ®å¤„ç†é”™è¯¯:', error);
            socialNetworkData = [];
        }
    }

    function parseNetworkCSV(csvText) {
        const lines = csvText.trim().split('\n');
        const headers = lines[0].split(',');
        const data = [];

        for (let i = 1; i < lines.length; i++) {
            const line = lines[i];
            if (!line.trim()) continue;

            const values = [];
            let current = '';
            let inQuotes = false;

            for (let j = 0; j < line.length; j++) {
                const char = line[j];
                if (char === '"') {
                    inQuotes = !inQuotes;
                } else if (char === ',' && !inQuotes) {
                    values.push(current.trim());
                    current = '';
                } else {
                    current += char;
                }
            }
            values.push(current.trim());

            const person = {
                id: values[0]?.trim() || '',
                name: values[1]?.trim() || '',
                relation: values[2]?.trim() || '',
                events: []
            };

            for (let k = 3; k < values.length; k += 2) {
                if (values[k]) {
                    person.events.push({
                        time: values[k],
                        description: values[k + 1] || ''
                    });
                }
            }

            if (person.name) {
                data.push(person);
            }
        }

        return data;
    }

    function getRealNetworkData() {
        return [
            // äº²å±å…³ç³»
            { id: '1', name: 'å‘¨ä½œäºº', relation: 'äº²å±', events: [
                { time: '1885å¹´', description: 'ç»“è¯†ï¼ˆå…„å¼Ÿï¼‰' },
                { time: '1917å¹´4æœˆ', description: 'éšé²è¿…åˆ°åŒ—äº¬' },
                { time: '1912-1923å¹´', description: 'äº’é€šä¿¡ä»¶900é€š' },
                { time: '1923å¹´7æœˆ', description: 'å…„å¼Ÿå…³ç³»ç ´è£‚ï¼Œé²è¿…æ¬å‡ºå…«é“æ¹¾' }
            ]},
            { id: '2', name: 'å‘¨å»ºäºº', relation: 'äº²å±', events: [
                { time: '1888å¹´', description: 'ç»“è¯†ï¼ˆå…„å¼Ÿï¼‰' }
            ]},
            { id: '3', name: 'ç¾½å¤ªä¿¡å­', relation: 'äº²å±', events: [
                { time: '1909å¹´', description: 'ç»“è¯†ï¼ˆå¼Ÿåª³ï¼‰' }
            ]},
            { id: '4', name: 'é˜®å’Œå­™', relation: 'äº²å±', events: [
                { time: '1885å¹´', description: 'ç»“è¯†ï¼ˆè¡¨å…„ï¼‰' },
                { time: '1936å¹´', description: 'ä¹¦ä¿¡å¾€æ¥ä¿æŒ' }
            ]},
            { id: '5', name: 'è½¦è€•å—', relation: 'äº²å±', events: [
                { time: 'ä¸è¯¦', description: 'ç»“è¯†ï¼ˆäº²å±ï¼‰' }
            ]},
            { id: '6', name: 'å‘¨é”€å‡¤', relation: 'äº²å±', events: [
                { time: 'ä¸è¯¦', description: 'ç»“è¯†ï¼ˆæ—ä¼¯ï¼‰' },
                { time: '1913å¹´10æœˆ25æ—¥', description: 'åˆ°æ•™è‚²éƒ¨çœ‹é²è¿…' },
                { time: '1913å¹´11æœˆ3æ—¥', description: 'é²è¿…å›è®¿å¹¶è¯·åƒé¥­' },
                { time: '1917-1919å¹´', description: 'ä¹¦ä¿¡å¾€æ¥' }
            ]},
            { id: '7', name: 'å‘¨ä¸°ä¸€', relation: 'äº²å±', events: [
                { time: '1912å¹´', description: 'å‡ºç”Ÿï¼ˆä¾„å„¿ï¼‰' },
                { time: '1919å¹´', description: 'è¿è‡³åŒ—äº¬ï¼Œé²è¿…å¸¸ä¹°é£Ÿå“å’Œç©å…·' },
                { time: '1923å¹´', description: 'é²è¿…å…„å¼Ÿå¤±å’Œåä¸å†æ¥å¾€' }
            ]},
            { id: '21', name: 'é²ç‘', relation: 'äº²å±', events: [
                { time: '1881å¹´', description: 'ç»“è¯†ï¼ˆæ¯äº²ï¼‰' },
                { time: '1919å¹´', description: 'éšé²è¿…è¿è‡³åŒ—äº¬å…«é“æ¹¾' },
                { time: '1924å¹´', description: 'éšé²è¿…è¿è‡³è¥¿ä¸‰æ¡21å·é™¢' },
                { time: '1936å¹´å', description: 'é²è¿…å¸¸ç»™æ¯äº²å†™ä¿¡' }
            ]},
            { id: '22', name: 'æœ±å®‰', relation: 'äº²å±', events: [
                { time: '1906å¹´', description: 'ç»“å©š' },
                { time: '1919å¹´', description: 'éšé²è¿…å…¨å®¶è¿åˆ°å…«é“æ¹¾' },
                { time: '1924å¹´', description: 'éšé²è¿…è¿è‡³ç –å¡”èƒ¡åŒã€è¥¿ä¸‰æ¡21å·' },
                { time: '1926å¹´', description: 'é²è¿…å—ä¸‹åé™ªä¼´é²è¿…æ¯äº²' }
            ]},
            { id: '26', name: 'è®¸å¹¿å¹³', relation: 'äº²å±', events: [
                { time: '1925å¹´3æœˆ11æ—¥', description: 'é¦–æ¬¡å†™ä¿¡ç»™é²è¿…ï¼ˆå­¦ç”Ÿï¼‰' },
                { time: '1926å¹´', description: 'ä¸é²è¿…åŒæ—¶ç¦»äº¬å—ä¸‹' },
                { time: '1927å¹´9æœˆ', description: 'ä¸é²è¿…åŒèµ´ä¸Šæµ·å®šå±…ï¼ˆå¤«äººï¼‰' }
            ]},

            // åŒä¹¡å…³ç³»
            { id: '27', name: 'è®¸é“­ä¼¯', relation: 'åŒä¹¡', events: [
                { time: '1912å¹´5æœˆ5æ—¥', description: 'é²è¿…åˆåˆ°åŒ—äº¬å½“æ™šæ‹œè®¿' },
                { time: '1913å¹´', description: 'é²è¿…ä¸ºå…¶é¥¯è¡Œ' },
                { time: '1921å¹´7æœˆ1æ—¥', description: 'è®¸é“­ä¼¯å»ä¸–' }
            ]},
            { id: '28', name: 'è®¸è¯—èƒ', relation: 'åŒä¹¡', events: [
                { time: '1912å¹´', description: 'ä¸é²è¿…åŒèˆ¹åˆ°åŒ—äº¬' },
                { time: '1913å¹´10æœˆ22æ—¥', description: 'é²è¿…å‡ºå¸­å…¶è®¢å©šå®´' },
                { time: '1926å¹´8æœˆ', description: 'é²è¿…ç¦»äº¬åå¤±å»è”ç³»' }
            ]},
            { id: '29', name: 'å®‹ç´«ä½©', relation: 'åŒä¹¡', events: [
                { time: 'ä¸è¯¦ï¼ˆ1912å¹´å‰ï¼‰', description: 'ç»“è¯†ï¼ˆåŒä¹¡ã€å­¦ç”Ÿã€åŒäº‹ï¼‰' },
                { time: '1913å¹´3æœˆ30æ—¥', description: 'åˆ°åŒ—äº¬ä¸é²è¿…åŒä½ç»å…´ä¼šé¦†' },
                { time: '1926å¹´å', description: 'é²è¿…æ‰˜å…¶ç…§é¡¾å®¶äºº' }
            ]},
            { id: '30', name: 'è”¡å›½é’', relation: 'åŒä¹¡', events: [
                { time: 'ä¸è¯¦ï¼ˆæ—¥æœ¬ç•™å­¦ï¼‰', description: 'ç»“è¯†ï¼ˆåŒæœŸç•™æ—¥ï¼‰' },
                { time: '1912å¹´5æœˆ', description: 'ä¸é²è¿…åŒè‡³åŒ—äº¬' },
                { time: '1921å¹´4æœˆ17æ—¥', description: 'è”¡å›½é’å»ä¸–ï¼Œé²è¿…ç»™ç¤¼é“¶' }
            ]},
            { id: '47', name: 'é©¬å¹¼æ¸”', relation: 'åŒä¹¡', events: [
                { time: '1908å¹´', description: 'ç»“è¯†ï¼ˆåŒå­¦ï¼‰' },
                { time: '1920å¹´8æœˆ', description: 'è˜è¯·é²è¿…åˆ°åŒ—äº¬å¤§å­¦è®²æˆä¸­å›½å°è¯´å²' },
                { time: '1934å¹´', description: 'ä¿æŒå’Œé²è¿…çš„ä¹¦ä¿¡å¾€æ¥' }
            ]},
            { id: '51', name: 'é’±ç„åŒ', relation: 'åŒä¹¡', events: [
                { time: 'ä¸è¯¦ï¼ˆæ—¥æœ¬ç•™å­¦ï¼‰', description: 'ç»“è¯†ï¼ˆåŒå­¦ï¼‰' },
                { time: '1917å¹´', description: 'åŠ å…¥ã€Šæ–°é’å¹´ã€‹ï¼Œä¸é²è¿…å…³ç³»å¯†åˆ‡' },
                { time: '1920å¹´', description: 'ã€Šæ–°é’å¹´ã€‹ç¼–å§”ä¼šåˆ†åŒ–ï¼Œå…³ç³»æ¸æ¸ç–è¿œ' }
            ]},
            { id: '75', name: 'æ²ˆå…¼å£«', relation: 'åŒä¹¡', events: [
                { time: 'ä¸è¯¦ï¼ˆ1918å¹´å‰ï¼‰', description: 'ç»“è¯†' },
                { time: '1925å¹´', description: 'åŒé²è¿…ç­‰å‘è¡¨ã€Šå¯¹äºåŒ—äº¬å¥³å­å¸ˆèŒƒå¤§å­¦é£æ½®å®£è¨€ã€‹' },
                { time: '1926å¹´', description: 'éšé²è¿…èµ´å¦é—¨å¤§å­¦å›½æ–‡ç³»ä»»æ•™' },
                { time: '1932å¹´', description: 'é‚€è¯·é²è¿…åˆ°æ ¡æ¼”è®²' }
            ]},
            { id: '108', name: 'æ²ˆé›å†°', relation: 'åŒä¹¡', events: [
                { time: '1921å¹´4æœˆ', description: 'ä¸é²è¿…å¼€å§‹é€šä¿¡' },
                { time: '1926å¹´8æœˆ30æ—¥', description: 'ä¸é²è¿…é¦–æ¬¡è§é¢ï¼ˆåœ¨ä¸Šæµ·ï¼‰' }
            ]},
            { id: '109', name: 'è®¸ç¾¡è‹', relation: 'åŒä¹¡', events: [
                { time: '1920å¹´', description: 'åˆ°åŒ—äº¬æŠ•è€ƒï¼Œæš‚ä½å…«é“æ¹¾å‘¨å®…' },
                { time: '1921å¹´', description: 'æŠ¥è€ƒåŒ—äº¬å¥³å¸ˆï¼Œé²è¿…ä½œä¿' },
                { time: '1924å¹´', description: 'è‡ªåŒ—äº¬å¥³å­é«˜ç­‰å¸ˆèŒƒå­¦æ ¡æ¯•ä¸š' },
                { time: '1926å¹´', description: 'é²è¿…å—ä¸‹åï¼Œå¸®é²è¿…æ¯äº²æ–™ç†å®¶åŠ¡' }
            ]},
            { id: '111', name: 'éƒè¾¾å¤«', relation: 'åŒä¹¡', events: [
                { time: 'ä¸è¯¦ï¼ˆ1923å¹´å‰ï¼‰', description: 'ç»“è¯†' },
                { time: '1923å¹´', description: 'ä¸é²è¿…åŒåœ¨åŒ—äº¬å¤§å­¦ä»»æ•™ï¼Œæ¥å¾€å¯†åˆ‡' },
                { time: '1925å¹´', description: 'å›äº¬åº¦å‡æ—¶æ‹œè®¿é²è¿…' },
                { time: '1926å¹´', description: 'å›äº¬åº¦å‡æ—¶æ‹œè®¿é²è¿…' }
            ]},

            // åŒäº‹å…³ç³»
            { id: '127', name: 'è®¸å¯¿è£³', relation: 'åŒäº‹', events: [
                { time: 'ä¸è¯¦ï¼ˆæ—¥æœ¬ç•™å­¦ï¼‰', description: 'ç»“è¯†ï¼ˆåŒçª—ï¼Œæœ€äº²å¯†æœ‹å‹ï¼‰' },
                { time: '1909å¹´', description: 'å›å›½é‚€é²è¿…å»æµ™æ±Ÿä¸¤çº§å¸ˆèŒƒå­¦å ‚ä»»æ•™' },
                { time: '1912å¹´', description: 'å‘è”¡å…ƒåŸ¹æ¨èé²è¿…åˆ°æ•™è‚²éƒ¨å·¥ä½œ' },
                { time: '1925å¹´8æœˆ', description: 'é²è¿…è¢«å…èŒï¼Œå…¶æ„¤è€Œè¾èŒ' }
            ]},
            { id: '128', name: 'è”¡å…ƒåŸ¹', relation: 'åŒäº‹', events: [
                { time: 'ä¸è¯¦ï¼ˆ1912å¹´å‰ï¼‰', description: 'ç»“è¯†' },
                { time: '1912å¹´', description: 'è˜è¯·é²è¿…åˆ°æ•™è‚²éƒ¨ä»»èŒ' },
                { time: '1920å¹´', description: 'è˜è¯·é²è¿…ä¸ºåŒ—äº¬å¤§å­¦è®²å¸ˆ' },
                { time: '1927å¹´', description: 'è˜è¯·é²è¿…ä¸ºç‰¹çº¦æ’°è¿°å‘˜' }
            ]},
            { id: '135', name: 'é½å¯¿å±±', relation: 'åŒäº‹', events: [
                { time: '1912å¹´', description: 'ç»“è¯†ï¼ˆåŒäº‹ï¼Œå¯†åˆ‡æœ‹å‹ï¼‰' },
                { time: '1917å¹´', description: 'å¼ å‹‹å¤è¾Ÿæ—¶åŠ©é²è¿…é¿éš¾' },
                { time: '1924å¹´', description: 'é²è¿…è´­æˆ¿æ—¶èµ„é‡‘ä¸Šå¸®å¿™' },
                { time: '1925å¹´', description: 'é²è¿…è¢«å…èŒï¼Œå…¶è¾èŒæŠ—è®®' }
            ]},
            { id: '218', name: 'ç« å£«é’Š', relation: 'åŒäº‹', events: [
                { time: '1924å¹´', description: 'ç»“è¯†ï¼ˆåŒäº‹ï¼Œä¸Šå¸ï¼‰' },
                { time: '1924-1926å¹´', description: 'ä»»å¸æ³•æ€»é•¿å…¼æ•™è‚²æ€»é•¿' },
                { time: '1925å¹´', description: 'é²è¿…å› æ”¯æŒå¥³å¸ˆå¤§å­¦ç”Ÿè¿åŠ¨è¢«ä»–é©èŒï¼Œé²è¿…ä¸ºæ­¤å‘å¹³æ”¿é™¢æå‡ºæ§å‘Šï¼Œå–å¾—èƒœåˆ©åå¤èŒ' }
            ]},

            // å­¦ç”Ÿå…³ç³»
            { id: '221', name: 'å•†å¥‘è¡¡', relation: 'å­¦ç”Ÿ', events: [
                { time: 'ä¸è¯¦ï¼ˆ1912å¹´å‰ï¼‰', description: 'ç»“è¯†ï¼ˆå­¦ç”Ÿï¼‰' },
                { time: '1912å¹´', description: 'è¿›å…¥åŒ—äº¬å¤§å­¦ç†ç§‘å­¦ä¹ ' },
                { time: '1914-1915å¹´', description: 'å¸¸å¹´å‘é²è¿…å€Ÿå­¦è´¹' }
            ]},
            { id: '242', name: 'å­™ä¼å›­', relation: 'å­¦ç”Ÿ', events: [
                { time: 'ä¸è¯¦ï¼ˆ1912å¹´å‰ï¼‰', description: 'ç»“è¯†ï¼ˆå­¦ç”Ÿï¼‰' },
                { time: '1919å¹´', description: 'å…¼ä»»åŒ—äº¬ã€Šå›½æ°‘å…¬æŠ¥Â·å‰¯åˆŠã€‹ç¼–è¾‘' },
                { time: '1920å¹´', description: 'å…¼ä»»ã€Šæ™¨æŠ¥ã€‹ç¼–è¾‘' }
            ]},
            { id: '243', name: 'èƒ¡æ„ˆä¹‹', relation: 'å­¦ç”Ÿ', events: [
                { time: 'ä¸è¯¦ï¼ˆ1912å¹´å‰ï¼‰', description: 'ç»“è¯†ï¼ˆå­¦ç”Ÿï¼‰' },
                { time: '1921å¹´11æœˆ', description: 'å› ä»‹ç»çˆ±ç½—å…ˆç‚åˆ°åŒ—äº¬å¤§å­¦ä»»æ•™ä¸é²è¿…å¼€å§‹ä¹¦ä¿¡å¾€æ¥' },
                { time: '1926å¹´8æœˆ30æ—¥', description: 'é²è¿…æŠµè¾¾ä¸Šæµ·çš„ç¬¬äºŒå¤©ï¼Œä¸é²è¿…é¦–æ¬¡è§é¢' }
            ]},
            { id: '247', name: 'è®¸é’¦æ–‡', relation: 'å­¦ç”Ÿ', events: [
                { time: '1920å¹´', description: 'ç»“è¯†ï¼ˆå­¦ç”Ÿï¼‰' },
                { time: '1923å¹´', description: 'ç»å­™ä¼å›­ä»‹ç»ç»“è¯†é²è¿…' },
                { time: '1926å¹´', description: 'çŸ­ç¯‡å°è¯´é›†ã€Šæ•…ä¹¡ã€‹ç”±é²è¿…ç¼–é€‰å‡ºç‰ˆï¼Œåˆ—å…¥ã€Šä¹Œåˆä»ä¹¦ã€‹' }
            ]},
            { id: '276', name: 'å°é™å†œ', relation: 'å­¦ç”Ÿ', events: [
                { time: '1925å¹´æ˜¥', description: 'åˆè¯†é²è¿…' },
                { time: '1925å¹´æ˜¥', description: 'åå‚åŠ é²è¿…å‘èµ·æˆç«‹çš„æœªåç¤¾' },
                { time: '1925-1936å¹´', description: 'ä»–ä»¬ç»å¸¸äº’è®¿ï¼Œé²è¿…ä¹¦ä¿¡ä¸­æœ‰è‡´å°é™å†œä¹¦ä¿¡ä¹åé€š' }
            ]},
            { id: '282', name: 'éŸ¦ç´ å›­', relation: 'å­¦ç”Ÿ', events: [
                { time: 'ä¸è¯¦ï¼ˆ1925å¹´å‰ï¼‰', description: 'ç»“è¯†ï¼ˆå­¦ç”Ÿï¼‰' },
                { time: '1925-1932å¹´', description: 'é²è¿…ä¸ä»–äº¤å¾€å¯†åˆ‡ï¼Œç»å¸¸äº’è®¿ï¼Œè®¨è®ºç¨¿ä»¶' },
                { time: '1929å¹´', description: 'é²è¿…å›åŒ—äº¬æ¢äº²æ—¶æ›¾ä¸“ç¨‹çœ‹æœ›ä»–ã€‚ä»–å»ä¸–åé²è¿…ä¸ºä»–ä¹¦å†™äº†ç¢‘è®°ï¼Œå¹¶ä½œã€Šå¿†éŸ¦ç´ å›­å›ã€‹ä¸€æ–‡' }
            ]},

            // å…¶ä»–é‡è¦äººç‰©
            { id: '358', name: 'èƒ¡é€‚', relation: 'å…¶ä»–', events: [
                { time: '1918å¹´è‡³1920å¹´', description: 'å…±åŒå‚ä¸ã€Šæ–°é’å¹´ã€‹ç¼–è¾‘å·¥ä½œ' },
                { time: '1924å¹´å‰', description: 'å¾€æ¥ç ”ç©¶å°è¯´å²' }
            ]},
            { id: '364', name: 'æå¤§é’Š', relation: 'å…¶ä»–', events: [
                { time: '1918å¹´å‰å', description: 'åœ¨ã€Šæ–°é’å¹´ã€‹ç¼–è¾‘ä¼šä¸Šç›¸è¯†å¹¶äº¤å¾€' }
            ]},
            { id: '366', name: 'é™ˆç‹¬ç§€', relation: 'å…¶ä»–', events: [
                { time: '1920å¹´è‡³1921å¹´', description: 'é²è¿…ç»å¸¸å¯„ç¨¿ä»¶ç»™ä»–å¹¶æœ‰ä¹¦ä¿¡å¾€æ¥' }
            ]},
            { id: '371', name: 'éƒ‘æŒ¯é“', relation: 'å…¶ä»–', events: [
                { time: '1921å¹´4æœˆ', description: 'å¼€å§‹é€šä¿¡' },
                { time: '1926å¹´', description: 'åœ¨ä¸Šæµ·é¦–æ¬¡è§é¢' }
            ]},
            { id: '421', name: 'æ—è¯­å ‚', relation: 'å…¶ä»–', events: [
                { time: '1924å¹´è‡³1926å¹´', description: 'ä¸ºã€Šè¯­ä¸ã€‹ã€ã€Šè½åŸã€‹ç­‰æ’°ç¨¿' },
                { time: '1926å¹´3æœˆ7æ—¥', description: 'åŒå¸­äºåˆ˜åŠå†œå®¶å®´' }
            ]}
        ];
    }

    function getSampleNetworkData() {
        return [
            { id: '1', name: 'å‘¨ä½œäºº', relation: 'äº²å±', events: [{ time: '1885å¹´', description: 'ç»“è¯†ï¼ˆå…„å¼Ÿï¼‰' }] },
            { id: '2', name: 'å‘¨å»ºäºº', relation: 'äº²å±', events: [{ time: '1888å¹´', description: 'ç»“è¯†ï¼ˆå…„å¼Ÿï¼‰' }] },
            { id: '3', name: 'è®¸å¯¿è£³', relation: 'å‹äºº', events: [{ time: '1902å¹´', description: 'ç»“è¯†' }] },
            { id: '4', name: 'é’±ç„åŒ', relation: 'å‹äºº', events: [{ time: '1912å¹´', description: 'ç»“è¯†' }] }
        ];
    }

    const relationColors = {
        'äº²å±': { color: '#B44C43', bg: '#FFE5E5' },
        'åŒä¹¡': { color: '#4A5D75', bg: '#E5F0FF' },
        'å‹äºº': { color: '#5F7156', bg: '#E5FFE8' },
        'åŒäº‹': { color: '#D9A033', bg: '#FFF8E5' },
        'å­¦ç”Ÿ': { color: '#9B5F90', bg: '#F5E5FF' },
        'å…¶ä»–': { color: '#8B7D6B', bg: '#F5F5F5' }
    };

    // å¤„ç†ä»å…³ç³»ç½‘ç»œé¡µé¢è·³è½¬è¿‡æ¥çš„URLå‚æ•°
    function handleUrlParameters() {
        const urlParams = new URLSearchParams(window.location.search);
        const searchParam = urlParams.get('search');
        const personParam = urlParams.get('person');
        
        if (searchParam) {
            // è‡ªåŠ¨æœç´¢å¹¶é«˜äº®ç›¸å…³äººç‰©
            const decodedSearch = decodeURIComponent(searchParam);
            console.log(`ğŸ” ä»å…³ç³»ç½‘ç»œé¡µé¢è·³è½¬ï¼Œè‡ªåŠ¨æœç´¢: ${decodedSearch}`);
            
            // å»¶è¿Ÿæ‰§è¡Œï¼Œç¡®ä¿åœ°å›¾å·²åŠ è½½
            setTimeout(() => {
                const searchBox = document.getElementById('searchBox');
                if (searchBox) {
                    searchBox.value = decodedSearch;
                    searchBox.focus();
                    
                    // è§¦å‘æœç´¢
                    const searchEvent = new Event('input', { bubbles: true });
                    searchBox.dispatchEvent(searchEvent);
                }
            }, 2000);
        }
        
        if (personParam) {
            // æ˜¾ç¤ºæç¤ºä¿¡æ¯
            const decodedPerson = decodeURIComponent(personParam);
            console.log(`ğŸ‘¤ ä»å…³ç³»ç½‘ç»œé¡µé¢è·³è½¬æŸ¥çœ‹äººç‰©: ${decodedPerson}`);
            
            // åˆ›å»ºæç¤ºä¿¡æ¯
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed;
                top: 100px;
                left: 50%;
                transform: translateX(-50%);
                background: rgba(245, 241, 232, 0.96);
                border: 2px solid #C9A961;
                border-radius: 8px;
                padding: 15px 20px;
                box-shadow: 0 4px 15px rgba(0,0,0,0.15);
                z-index: 10000;
                color: #5D4E37;
                font-family: 'SimSun', 'å®‹ä½“', serif;
                font-size: 14px;
                max-width: 400px;
                text-align: center;
            `;
            notification.innerHTML = `
                <strong style="color: #C9A961;">ğŸ”— ä»å…³ç³»ç½‘ç»œé¡µé¢è·³è½¬</strong><br>
                æ­£åœ¨æŸ¥æ‰¾ <em style="color: #C9A961;">${decodedPerson}</em> åœ¨åœ°å›¾ä¸­çš„ç›¸å…³åœ°ç‚¹<br>
                <small style="opacity: 0.7;">è¯·æŸ¥çœ‹å·¦ä¾§åœ°ç‚¹åˆ—è¡¨æˆ–åœ°å›¾æ ‡è®°</small>
            `;
            document.body.appendChild(notification);
            
            // 5ç§’åè‡ªåŠ¨ç§»é™¤æç¤º
            setTimeout(() => {
                if (notification.parentNode) {
                    notification.parentNode.removeChild(notification);
                }
            }, 5000);
        }
    }

    // æ‰€æœ‰ç½‘ç»œå›¾ç›¸å…³å‡½æ•°å·²ç§»è‡³ network-module.js
    // è¯¥æ¨¡å—ä¼šåœ¨HTMLåŠ è½½ååŠ¨æ€åŠ è½½ï¼Œæä¾›ä»¥ä¸‹å…¨å±€å‡½æ•°ï¼š
    // - showNetworkGraph(locationName)
    // - closeNetworkModal()

    // *** 8. é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ– ***
    
    document.addEventListener('DOMContentLoaded', function() {
        // æ£€æµ‹æ˜¯å¦ä½¿ç”¨file://åè®®
        if (window.location.protocol === 'file:') {
            const alert = document.getElementById('serverAlert');
            if (alert) {
                alert.style.display = 'block';
            }
            console.log('ğŸ” æ£€æµ‹åˆ°file://åè®®ï¼Œå°†æä¾›å¤‡ç”¨åŠ è½½æ–¹æ¡ˆ');
        }
        
        // åŠ è½½ç¤¾äº¤ç½‘ç»œæ•°æ®
        loadSocialNetworkData();
        
        // å¤„ç†URLå‚æ•°ï¼ˆä»å…³ç³»ç½‘ç»œé¡µé¢è·³è½¬è¿‡æ¥ï¼‰
        handleUrlParameters();
        
        initializeUI();
        initializeMap();
    });

</script>
    <!-- è½»é‡èŠ‚ç‚¹/è¿çº¿ä¿¡æ¯æ¨¡æ€æ¡† -->
</body>
</html>